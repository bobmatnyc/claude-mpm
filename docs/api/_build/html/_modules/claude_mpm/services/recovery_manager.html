

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../../">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>claude_mpm.services.recovery_manager &mdash; Claude MPM API Reference 3.8.2 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../../../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../../../_static/custom.css?v=dbb19ff3" />
      <link rel="stylesheet" type="text/css" href="../../../_static/custom.css?v=dbb19ff3" />

  
      <script src="../../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../../_static/documentation_options.js?v=070f1fcc"></script>
      <script src="../../../_static/doctools.js?v=9bcbadda"></script>
      <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: #2980B9" >

          
          
          <a href="../../../index.html" class="icon icon-home">
            Claude MPM API Reference
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Core API</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../core/index.html">Core API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../services/index.html">Services API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../agents/index.html">Agents API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../hooks/index.html">Hooks API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../cli/index.html">CLI API</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../modules.html">claude_mpm</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../genindex.html">Index</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../py-modindex.html">Module Index</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../search.html">Search Page</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu"  style="background: #2980B9" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">Claude MPM API Reference</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../index.html">Module code</a></li>
          <li class="breadcrumb-item"><a href="../services.html">claude_mpm.services</a></li>
      <li class="breadcrumb-item active">claude_mpm.services.recovery_manager</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for claude_mpm.services.recovery_manager</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;Automatic recovery manager for claude-mpm Socket.IO server.</span>

<span class="sd">This module provides comprehensive recovery mechanisms including:</span>
<span class="sd">- Circuit breaker pattern to prevent restart loops</span>
<span class="sd">- Configurable recovery strategies</span>
<span class="sd">- Graceful restart and recovery procedures</span>
<span class="sd">- Recovery event logging and notifications</span>
<span class="sd">- Integration with health monitoring system</span>

<span class="sd">Design Principles:</span>
<span class="sd">- Prevention of restart loops through circuit breaker</span>
<span class="sd">- Graduated recovery responses based on failure severity</span>
<span class="sd">- Comprehensive logging for recovery events</span>
<span class="sd">- Configurable recovery policies and thresholds</span>
<span class="sd">- Integration with existing service lifecycle</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">asyncio</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">logging</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">time</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">signal</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">threading</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">abc</span><span class="w"> </span><span class="kn">import</span> <span class="n">ABC</span><span class="p">,</span> <span class="n">abstractmethod</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">collections</span><span class="w"> </span><span class="kn">import</span> <span class="n">deque</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">dataclasses</span><span class="w"> </span><span class="kn">import</span> <span class="n">dataclass</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">datetime</span><span class="w"> </span><span class="kn">import</span> <span class="n">datetime</span><span class="p">,</span> <span class="n">timezone</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">enum</span><span class="w"> </span><span class="kn">import</span> <span class="n">Enum</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Any</span><span class="p">,</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">List</span><span class="p">,</span> <span class="n">Optional</span><span class="p">,</span> <span class="n">Callable</span><span class="p">,</span> <span class="n">Union</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">json</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">claude_mpm.core.constants</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
    <span class="n">RetryConfig</span><span class="p">,</span>
    <span class="n">TimeoutConfig</span><span class="p">,</span>
    <span class="n">PerformanceConfig</span>
<span class="p">)</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">.health_monitor</span><span class="w"> </span><span class="kn">import</span> <span class="n">HealthStatus</span><span class="p">,</span> <span class="n">HealthCheckResult</span>


<div class="viewcode-block" id="RecoveryAction">
<a class="viewcode-back" href="../../../services/infrastructure.html#claude_mpm.services.recovery_manager.RecoveryAction">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">RecoveryAction</span><span class="p">(</span><span class="n">Enum</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Types of recovery actions that can be performed.&quot;&quot;&quot;</span>
    <span class="n">NONE</span> <span class="o">=</span> <span class="s2">&quot;none&quot;</span>
    <span class="n">LOG_WARNING</span> <span class="o">=</span> <span class="s2">&quot;log_warning&quot;</span>
    <span class="n">CLEAR_CONNECTIONS</span> <span class="o">=</span> <span class="s2">&quot;clear_connections&quot;</span>
    <span class="n">RESTART_SERVICE</span> <span class="o">=</span> <span class="s2">&quot;restart_service&quot;</span>
    <span class="n">EMERGENCY_STOP</span> <span class="o">=</span> <span class="s2">&quot;emergency_stop&quot;</span></div>



<div class="viewcode-block" id="CircuitState">
<a class="viewcode-back" href="../../../services/infrastructure.html#claude_mpm.services.recovery_manager.CircuitState">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">CircuitState</span><span class="p">(</span><span class="n">Enum</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Circuit breaker states.&quot;&quot;&quot;</span>
    <span class="n">CLOSED</span> <span class="o">=</span> <span class="s2">&quot;closed&quot;</span>      <span class="c1"># Normal operation</span>
    <span class="n">OPEN</span> <span class="o">=</span> <span class="s2">&quot;open&quot;</span>          <span class="c1"># Recovery blocked due to failures</span>
    <span class="n">HALF_OPEN</span> <span class="o">=</span> <span class="s2">&quot;half_open&quot;</span>  <span class="c1"># Testing if recovery is working</span></div>



<div class="viewcode-block" id="RecoveryEvent">
<a class="viewcode-back" href="../../../services/infrastructure.html#claude_mpm.services.recovery_manager.RecoveryEvent">[docs]</a>
<span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">RecoveryEvent</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Recovery event record.&quot;&quot;&quot;</span>
    <span class="n">timestamp</span><span class="p">:</span> <span class="nb">float</span>
    <span class="n">action</span><span class="p">:</span> <span class="n">RecoveryAction</span>
    <span class="n">trigger</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">health_status</span><span class="p">:</span> <span class="n">HealthStatus</span>
    <span class="n">success</span><span class="p">:</span> <span class="nb">bool</span>
    <span class="n">duration_ms</span><span class="p">:</span> <span class="nb">float</span>
    <span class="n">error_message</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    
<div class="viewcode-block" id="RecoveryEvent.to_dict">
<a class="viewcode-back" href="../../../services/infrastructure.html#claude_mpm.services.recovery_manager.RecoveryEvent.to_dict">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">to_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Convert recovery event to dictionary.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="s1">&#39;timestamp&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">timestamp</span><span class="p">,</span>
            <span class="s1">&#39;timestamp_iso&#39;</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">fromtimestamp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">timestamp</span><span class="p">,</span> <span class="n">timezone</span><span class="o">.</span><span class="n">utc</span><span class="p">)</span><span class="o">.</span><span class="n">isoformat</span><span class="p">(),</span>
            <span class="s1">&#39;action&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">action</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
            <span class="s1">&#39;trigger&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">trigger</span><span class="p">,</span>
            <span class="s1">&#39;health_status&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">health_status</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
            <span class="s1">&#39;success&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">success</span><span class="p">,</span>
            <span class="s1">&#39;duration_ms&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">duration_ms</span><span class="p">,</span>
            <span class="s1">&#39;error_message&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">error_message</span>
        <span class="p">}</span></div>
</div>



<div class="viewcode-block" id="RecoveryStrategy">
<a class="viewcode-back" href="../../../services/infrastructure.html#claude_mpm.services.recovery_manager.RecoveryStrategy">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">RecoveryStrategy</span><span class="p">(</span><span class="n">ABC</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Abstract base class for recovery strategies.&quot;&quot;&quot;</span>
    
<div class="viewcode-block" id="RecoveryStrategy.should_recover">
<a class="viewcode-back" href="../../../services/infrastructure.html#claude_mpm.services.recovery_manager.RecoveryStrategy.should_recover">[docs]</a>
    <span class="nd">@abstractmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">should_recover</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">health_result</span><span class="p">:</span> <span class="n">HealthCheckResult</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Determine if recovery should be triggered based on health result.&quot;&quot;&quot;</span>
        <span class="k">pass</span></div>

    
<div class="viewcode-block" id="RecoveryStrategy.get_recovery_action">
<a class="viewcode-back" href="../../../services/infrastructure.html#claude_mpm.services.recovery_manager.RecoveryStrategy.get_recovery_action">[docs]</a>
    <span class="nd">@abstractmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_recovery_action</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">health_result</span><span class="p">:</span> <span class="n">HealthCheckResult</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">RecoveryAction</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Determine the appropriate recovery action.&quot;&quot;&quot;</span>
        <span class="k">pass</span></div>

    
<div class="viewcode-block" id="RecoveryStrategy.get_name">
<a class="viewcode-back" href="../../../services/infrastructure.html#claude_mpm.services.recovery_manager.RecoveryStrategy.get_name">[docs]</a>
    <span class="nd">@abstractmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_name</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the name of this recovery strategy.&quot;&quot;&quot;</span>
        <span class="k">pass</span></div>
</div>



<div class="viewcode-block" id="GradedRecoveryStrategy">
<a class="viewcode-back" href="../../../services/infrastructure.html#claude_mpm.services.recovery_manager.GradedRecoveryStrategy">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">GradedRecoveryStrategy</span><span class="p">(</span><span class="n">RecoveryStrategy</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Recovery strategy with graduated response based on health status and history.</span>
<span class="sd">    </span>
<span class="sd">    Recovery actions are escalated based on:</span>
<span class="sd">    - Current health status severity</span>
<span class="sd">    - Number of recent failures</span>
<span class="sd">    - Time since last recovery attempt</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
<div class="viewcode-block" id="GradedRecoveryStrategy.__init__">
<a class="viewcode-back" href="../../../services/infrastructure.html#claude_mpm.services.recovery_manager.GradedRecoveryStrategy.__init__">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize graded recovery strategy.</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            config: Configuration dictionary for recovery thresholds</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">config</span> <span class="o">=</span> <span class="n">config</span> <span class="ow">or</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">.GradedRecoveryStrategy&quot;</span><span class="p">)</span>
        
        <span class="c1"># Configuration with defaults</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">warning_threshold</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;warning_threshold&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">critical_threshold</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;critical_threshold&#39;</span><span class="p">,</span> <span class="n">RetryConfig</span><span class="o">.</span><span class="n">CRITICAL_THRESHOLD</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">failure_window_seconds</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;failure_window_seconds&#39;</span><span class="p">,</span> <span class="n">RetryConfig</span><span class="o">.</span><span class="n">FAILURE_WINDOW</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">min_recovery_interval</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;min_recovery_interval&#39;</span><span class="p">,</span> <span class="n">RetryConfig</span><span class="o">.</span><span class="n">MIN_RECOVERY_INTERVAL</span><span class="p">)</span>
        
        <span class="c1"># Track recent failures</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">recent_failures</span><span class="p">:</span> <span class="n">deque</span> <span class="o">=</span> <span class="n">deque</span><span class="p">(</span><span class="n">maxlen</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">last_recovery_time</span> <span class="o">=</span> <span class="mi">0</span></div>

    
<div class="viewcode-block" id="GradedRecoveryStrategy.get_name">
<a class="viewcode-back" href="../../../services/infrastructure.html#claude_mpm.services.recovery_manager.GradedRecoveryStrategy.get_name">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_name</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;graded_recovery&quot;</span></div>

    
<div class="viewcode-block" id="GradedRecoveryStrategy.should_recover">
<a class="viewcode-back" href="../../../services/infrastructure.html#claude_mpm.services.recovery_manager.GradedRecoveryStrategy.should_recover">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">should_recover</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">health_result</span><span class="p">:</span> <span class="n">HealthCheckResult</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Determine if recovery should be triggered.&quot;&quot;&quot;</span>
        <span class="n">current_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        
        <span class="c1"># Don&#39;t trigger recovery too frequently</span>
        <span class="k">if</span> <span class="n">current_time</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_recovery_time</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">min_recovery_interval</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Recovery suppressed due to min interval&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">False</span>
        
        <span class="c1"># Check current health status</span>
        <span class="k">if</span> <span class="n">health_result</span><span class="o">.</span><span class="n">overall_status</span> <span class="ow">in</span> <span class="p">[</span><span class="n">HealthStatus</span><span class="o">.</span><span class="n">CRITICAL</span><span class="p">]:</span>
            <span class="k">return</span> <span class="kc">True</span>
        
        <span class="k">if</span> <span class="n">health_result</span><span class="o">.</span><span class="n">overall_status</span> <span class="o">==</span> <span class="n">HealthStatus</span><span class="o">.</span><span class="n">WARNING</span><span class="p">:</span>
            <span class="c1"># Count recent warnings in time window</span>
            <span class="n">cutoff_time</span> <span class="o">=</span> <span class="n">current_time</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">failure_window_seconds</span>
            <span class="n">recent_warnings</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">event</span> <span class="k">for</span> <span class="n">event</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">recent_failures</span>
                <span class="k">if</span> <span class="n">event</span> <span class="o">&gt;=</span> <span class="n">cutoff_time</span>
            <span class="p">]</span>
            
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">recent_warnings</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">warning_threshold</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">True</span>
        
        <span class="k">return</span> <span class="kc">False</span></div>

    
<div class="viewcode-block" id="GradedRecoveryStrategy.get_recovery_action">
<a class="viewcode-back" href="../../../services/infrastructure.html#claude_mpm.services.recovery_manager.GradedRecoveryStrategy.get_recovery_action">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_recovery_action</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">health_result</span><span class="p">:</span> <span class="n">HealthCheckResult</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">RecoveryAction</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Determine the appropriate recovery action based on health status.&quot;&quot;&quot;</span>
        <span class="n">current_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        
        <span class="c1"># Count recent failures</span>
        <span class="n">cutoff_time</span> <span class="o">=</span> <span class="n">current_time</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">failure_window_seconds</span>
        <span class="n">recent_failures</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">event</span> <span class="k">for</span> <span class="n">event</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">recent_failures</span>
            <span class="k">if</span> <span class="n">event</span> <span class="o">&gt;=</span> <span class="n">cutoff_time</span>
        <span class="p">]</span>
        
        <span class="n">failure_count</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">recent_failures</span><span class="p">)</span>
        
        <span class="c1"># Record this failure</span>
        <span class="k">if</span> <span class="n">health_result</span><span class="o">.</span><span class="n">overall_status</span> <span class="ow">in</span> <span class="p">[</span><span class="n">HealthStatus</span><span class="o">.</span><span class="n">WARNING</span><span class="p">,</span> <span class="n">HealthStatus</span><span class="o">.</span><span class="n">CRITICAL</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">recent_failures</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">current_time</span><span class="p">)</span>
        
        <span class="c1"># Determine action based on status and failure history</span>
        <span class="k">if</span> <span class="n">health_result</span><span class="o">.</span><span class="n">overall_status</span> <span class="o">==</span> <span class="n">HealthStatus</span><span class="o">.</span><span class="n">CRITICAL</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">failure_count</span> <span class="o">&gt;=</span> <span class="mi">3</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">RecoveryAction</span><span class="o">.</span><span class="n">EMERGENCY_STOP</span>
            <span class="k">elif</span> <span class="n">failure_count</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">RecoveryAction</span><span class="o">.</span><span class="n">RESTART_SERVICE</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">RecoveryAction</span><span class="o">.</span><span class="n">CLEAR_CONNECTIONS</span>
        
        <span class="k">elif</span> <span class="n">health_result</span><span class="o">.</span><span class="n">overall_status</span> <span class="o">==</span> <span class="n">HealthStatus</span><span class="o">.</span><span class="n">WARNING</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">failure_count</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">warning_threshold</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">RecoveryAction</span><span class="o">.</span><span class="n">CLEAR_CONNECTIONS</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">RecoveryAction</span><span class="o">.</span><span class="n">LOG_WARNING</span>
        
        <span class="k">return</span> <span class="n">RecoveryAction</span><span class="o">.</span><span class="n">NONE</span></div>
</div>



<div class="viewcode-block" id="CircuitBreaker">
<a class="viewcode-back" href="../../../services/infrastructure.html#claude_mpm.services.recovery_manager.CircuitBreaker">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">CircuitBreaker</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Circuit breaker to prevent recovery loops and cascading failures.</span>
<span class="sd">    </span>
<span class="sd">    Implements the circuit breaker pattern to:</span>
<span class="sd">    - Prevent excessive recovery attempts</span>
<span class="sd">    - Allow time for systems to stabilize</span>
<span class="sd">    - Gradually re-enable recovery after failures</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
<div class="viewcode-block" id="CircuitBreaker.__init__">
<a class="viewcode-back" href="../../../services/infrastructure.html#claude_mpm.services.recovery_manager.CircuitBreaker.__init__">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">failure_threshold</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">RetryConfig</span><span class="o">.</span><span class="n">FAILURE_THRESHOLD</span><span class="p">,</span> 
                 <span class="n">timeout_seconds</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">RetryConfig</span><span class="o">.</span><span class="n">CIRCUIT_TIMEOUT</span><span class="p">,</span> 
                 <span class="n">success_threshold</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">RetryConfig</span><span class="o">.</span><span class="n">SUCCESS_THRESHOLD</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize circuit breaker.</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            failure_threshold: Number of failures before opening circuit</span>
<span class="sd">            timeout_seconds: Time to wait in OPEN state before trying HALF_OPEN</span>
<span class="sd">            success_threshold: Number of successes needed in HALF_OPEN to close circuit</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">failure_threshold</span> <span class="o">=</span> <span class="n">failure_threshold</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">timeout_seconds</span> <span class="o">=</span> <span class="n">timeout_seconds</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">success_threshold</span> <span class="o">=</span> <span class="n">success_threshold</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="n">CircuitState</span><span class="o">.</span><span class="n">CLOSED</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">failure_count</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">success_count</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">last_failure_time</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">state_change_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">.CircuitBreaker&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Circuit breaker initialized: failure_threshold=</span><span class="si">{</span><span class="n">failure_threshold</span><span class="si">}</span><span class="s2">, &quot;</span>
                        <span class="sa">f</span><span class="s2">&quot;timeout=</span><span class="si">{</span><span class="n">timeout_seconds</span><span class="si">}</span><span class="s2">s, success_threshold=</span><span class="si">{</span><span class="n">success_threshold</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span></div>

    
<div class="viewcode-block" id="CircuitBreaker.can_proceed">
<a class="viewcode-back" href="../../../services/infrastructure.html#claude_mpm.services.recovery_manager.CircuitBreaker.can_proceed">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">can_proceed</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Check if recovery operations can proceed.&quot;&quot;&quot;</span>
        <span class="n">current_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span> <span class="o">==</span> <span class="n">CircuitState</span><span class="o">.</span><span class="n">CLOSED</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span>
        
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span> <span class="o">==</span> <span class="n">CircuitState</span><span class="o">.</span><span class="n">OPEN</span><span class="p">:</span>
            <span class="c1"># Check if timeout has elapsed</span>
            <span class="k">if</span> <span class="n">current_time</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_failure_time</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">timeout_seconds</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_transition_to_half_open</span><span class="p">()</span>
                <span class="k">return</span> <span class="kc">True</span>
            <span class="k">return</span> <span class="kc">False</span>
        
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span> <span class="o">==</span> <span class="n">CircuitState</span><span class="o">.</span><span class="n">HALF_OPEN</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span>
        
        <span class="k">return</span> <span class="kc">False</span></div>

    
<div class="viewcode-block" id="CircuitBreaker.record_success">
<a class="viewcode-back" href="../../../services/infrastructure.html#claude_mpm.services.recovery_manager.CircuitBreaker.record_success">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">record_success</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Record a successful recovery operation.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span> <span class="o">==</span> <span class="n">CircuitState</span><span class="o">.</span><span class="n">CLOSED</span><span class="p">:</span>
            <span class="c1"># Reset failure count on success in normal state</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">failure_count</span> <span class="o">=</span> <span class="mi">0</span>
        
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span> <span class="o">==</span> <span class="n">CircuitState</span><span class="o">.</span><span class="n">HALF_OPEN</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">success_count</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Circuit breaker success count: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">success_count</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">success_threshold</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">success_count</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">success_threshold</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_transition_to_closed</span><span class="p">()</span></div>

    
<div class="viewcode-block" id="CircuitBreaker.record_failure">
<a class="viewcode-back" href="../../../services/infrastructure.html#claude_mpm.services.recovery_manager.CircuitBreaker.record_failure">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">record_failure</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Record a failed recovery operation.&quot;&quot;&quot;</span>
        <span class="n">current_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">last_failure_time</span> <span class="o">=</span> <span class="n">current_time</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span> <span class="o">==</span> <span class="n">CircuitState</span><span class="o">.</span><span class="n">CLOSED</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">failure_count</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Circuit breaker failure count: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">failure_count</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">failure_threshold</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">failure_count</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">failure_threshold</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_transition_to_open</span><span class="p">()</span>
        
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span> <span class="o">==</span> <span class="n">CircuitState</span><span class="o">.</span><span class="n">HALF_OPEN</span><span class="p">:</span>
            <span class="c1"># Failure in half-open state goes back to open</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_transition_to_open</span><span class="p">()</span></div>

    
    <span class="k">def</span><span class="w"> </span><span class="nf">_transition_to_open</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Transition circuit to OPEN state.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="n">CircuitState</span><span class="o">.</span><span class="n">OPEN</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">state_change_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">success_count</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Circuit breaker OPENED due to </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">failure_count</span><span class="si">}</span><span class="s2"> failures. &quot;</span>
                           <span class="sa">f</span><span class="s2">&quot;Recovery blocked for </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">timeout_seconds</span><span class="si">}</span><span class="s2"> seconds.&quot;</span><span class="p">)</span>
    
    <span class="k">def</span><span class="w"> </span><span class="nf">_transition_to_half_open</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Transition circuit to HALF_OPEN state.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="n">CircuitState</span><span class="o">.</span><span class="n">HALF_OPEN</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">state_change_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">success_count</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Circuit breaker transitioned to HALF_OPEN. Testing recovery...&quot;</span><span class="p">)</span>
    
    <span class="k">def</span><span class="w"> </span><span class="nf">_transition_to_closed</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Transition circuit to CLOSED state.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="n">CircuitState</span><span class="o">.</span><span class="n">CLOSED</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">state_change_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">failure_count</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">success_count</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Circuit breaker CLOSED. Normal recovery operations resumed.&quot;</span><span class="p">)</span>
    
<div class="viewcode-block" id="CircuitBreaker.get_status">
<a class="viewcode-back" href="../../../services/infrastructure.html#claude_mpm.services.recovery_manager.CircuitBreaker.get_status">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_status</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get current circuit breaker status.&quot;&quot;&quot;</span>
        <span class="n">current_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="s1">&#39;state&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
            <span class="s1">&#39;failure_count&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">failure_count</span><span class="p">,</span>
            <span class="s1">&#39;success_count&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">success_count</span><span class="p">,</span>
            <span class="s1">&#39;last_failure_time&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_failure_time</span><span class="p">,</span>
            <span class="s1">&#39;state_change_time&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">state_change_time</span><span class="p">,</span>
            <span class="s1">&#39;time_in_current_state&#39;</span><span class="p">:</span> <span class="n">current_time</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">state_change_time</span><span class="p">,</span>
            <span class="s1">&#39;can_proceed&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">can_proceed</span><span class="p">(),</span>
            <span class="s1">&#39;config&#39;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s1">&#39;failure_threshold&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">failure_threshold</span><span class="p">,</span>
                <span class="s1">&#39;timeout_seconds&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">timeout_seconds</span><span class="p">,</span>
                <span class="s1">&#39;success_threshold&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">success_threshold</span>
            <span class="p">}</span>
        <span class="p">}</span></div>
</div>



<div class="viewcode-block" id="RecoveryManager">
<a class="viewcode-back" href="../../../services/infrastructure.html#claude_mpm.services.recovery_manager.RecoveryManager">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">RecoveryManager</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Advanced recovery manager with circuit breaker and configurable strategies.</span>
<span class="sd">    </span>
<span class="sd">    Provides comprehensive recovery capabilities including:</span>
<span class="sd">    - Health-based recovery triggering</span>
<span class="sd">    - Circuit breaker protection</span>
<span class="sd">    - Multiple recovery strategies</span>
<span class="sd">    - Recovery event logging and history</span>
<span class="sd">    - Integration with service lifecycle</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
<div class="viewcode-block" id="RecoveryManager.__init__">
<a class="viewcode-back" href="../../../services/infrastructure.html#claude_mpm.services.recovery_manager.RecoveryManager.__init__">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> 
                 <span class="n">server_instance</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize recovery manager.</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            config: Configuration dictionary for recovery settings</span>
<span class="sd">            server_instance: Reference to the Socket.IO server instance</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">config</span> <span class="o">=</span> <span class="n">config</span> <span class="ow">or</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">server_instance</span> <span class="o">=</span> <span class="n">server_instance</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">.RecoveryManager&quot;</span><span class="p">)</span>
        
        <span class="c1"># Configuration with defaults</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">enabled</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;enabled&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">check_interval</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;check_interval&#39;</span><span class="p">,</span> <span class="mi">60</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_recovery_attempts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;max_recovery_attempts&#39;</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">recovery_timeout</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;recovery_timeout&#39;</span><span class="p">,</span> <span class="mi">30</span><span class="p">)</span>
        
        <span class="c1"># Initialize circuit breaker</span>
        <span class="n">circuit_config</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;circuit_breaker&#39;</span><span class="p">,</span> <span class="p">{})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">circuit_breaker</span> <span class="o">=</span> <span class="n">CircuitBreaker</span><span class="p">(</span>
            <span class="n">failure_threshold</span><span class="o">=</span><span class="n">circuit_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;failure_threshold&#39;</span><span class="p">,</span> <span class="n">RetryConfig</span><span class="o">.</span><span class="n">FAILURE_THRESHOLD</span><span class="p">),</span>
            <span class="n">timeout_seconds</span><span class="o">=</span><span class="n">circuit_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;timeout_seconds&#39;</span><span class="p">,</span> <span class="n">RetryConfig</span><span class="o">.</span><span class="n">CIRCUIT_TIMEOUT</span><span class="p">),</span>
            <span class="n">success_threshold</span><span class="o">=</span><span class="n">circuit_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;success_threshold&#39;</span><span class="p">,</span> <span class="n">RetryConfig</span><span class="o">.</span><span class="n">SUCCESS_THRESHOLD</span><span class="p">)</span>
        <span class="p">)</span>
        
        <span class="c1"># Initialize recovery strategy</span>
        <span class="n">strategy_config</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;strategy&#39;</span><span class="p">,</span> <span class="p">{})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">recovery_strategy</span> <span class="o">=</span> <span class="n">GradedRecoveryStrategy</span><span class="p">(</span><span class="n">strategy_config</span><span class="p">)</span>
        
        <span class="c1"># Recovery event history</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">recovery_history</span><span class="p">:</span> <span class="n">deque</span> <span class="o">=</span> <span class="n">deque</span><span class="p">(</span><span class="n">maxlen</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
        
        <span class="c1"># Recovery state</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">recovery_in_progress</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">last_recovery_time</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">recovery_count</span> <span class="o">=</span> <span class="mi">0</span>
        
        <span class="c1"># Recovery callbacks</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">recovery_callbacks</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Callable</span><span class="p">[[</span><span class="n">RecoveryEvent</span><span class="p">],</span> <span class="kc">None</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[]</span>
        
        <span class="c1"># Statistics</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">recovery_stats</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;total_recoveries&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
            <span class="s1">&#39;successful_recoveries&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
            <span class="s1">&#39;failed_recoveries&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
            <span class="s1">&#39;actions_performed&#39;</span><span class="p">:</span> <span class="p">{</span><span class="n">action</span><span class="o">.</span><span class="n">value</span><span class="p">:</span> <span class="mi">0</span> <span class="k">for</span> <span class="n">action</span> <span class="ow">in</span> <span class="n">RecoveryAction</span><span class="p">},</span>
            <span class="s1">&#39;average_recovery_duration_ms&#39;</span><span class="p">:</span> <span class="mi">0</span>
        <span class="p">}</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Recovery manager initialized with strategy: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">recovery_strategy</span><span class="o">.</span><span class="n">get_name</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span></div>

    
<div class="viewcode-block" id="RecoveryManager.add_recovery_callback">
<a class="viewcode-back" href="../../../services/infrastructure.html#claude_mpm.services.recovery_manager.RecoveryManager.add_recovery_callback">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">add_recovery_callback</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">callback</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">RecoveryEvent</span><span class="p">],</span> <span class="kc">None</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Add a callback to be notified of recovery events.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">recovery_callbacks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">callback</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Added recovery callback: </span><span class="si">{</span><span class="n">callback</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span></div>

    
<div class="viewcode-block" id="RecoveryManager.handle_health_result">
<a class="viewcode-back" href="../../../services/infrastructure.html#claude_mpm.services.recovery_manager.RecoveryManager.handle_health_result">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">handle_health_result</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">health_result</span><span class="p">:</span> <span class="n">HealthCheckResult</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">RecoveryEvent</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Handle health check result and trigger recovery if needed.</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            health_result: Health check result to evaluate</span>
<span class="sd">            </span>
<span class="sd">        Returns:</span>
<span class="sd">            RecoveryEvent if recovery was triggered, None otherwise</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">enabled</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">recovery_in_progress</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Recovery already in progress, skipping&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>
        
        <span class="c1"># Check if recovery should be triggered</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">recovery_strategy</span><span class="o">.</span><span class="n">should_recover</span><span class="p">(</span><span class="n">health_result</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">None</span>
        
        <span class="c1"># Check circuit breaker</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">circuit_breaker</span><span class="o">.</span><span class="n">can_proceed</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Recovery suppressed by circuit breaker&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>
        
        <span class="c1"># Determine recovery action</span>
        <span class="n">action</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">recovery_strategy</span><span class="o">.</span><span class="n">get_recovery_action</span><span class="p">(</span><span class="n">health_result</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">action</span> <span class="o">==</span> <span class="n">RecoveryAction</span><span class="o">.</span><span class="n">NONE</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        
        <span class="c1"># Trigger recovery</span>
        <span class="k">return</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">create_task</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_perform_recovery</span><span class="p">(</span><span class="n">action</span><span class="p">,</span> <span class="n">health_result</span><span class="p">,</span> <span class="s2">&quot;health_check&quot;</span><span class="p">))</span></div>

    
    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">_perform_recovery</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">action</span><span class="p">:</span> <span class="n">RecoveryAction</span><span class="p">,</span> 
                               <span class="n">health_result</span><span class="p">:</span> <span class="n">HealthCheckResult</span><span class="p">,</span> 
                               <span class="n">trigger</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">RecoveryEvent</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Perform recovery action and record the event.</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            action: Recovery action to perform</span>
<span class="sd">            health_result: Health result that triggered recovery</span>
<span class="sd">            trigger: Description of what triggered the recovery</span>
<span class="sd">            </span>
<span class="sd">        Returns:</span>
<span class="sd">            RecoveryEvent record of the recovery attempt</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">recovery_in_progress</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Recovery already in progress&quot;</span><span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">recovery_in_progress</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="n">success</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">error_message</span> <span class="o">=</span> <span class="kc">None</span>
        
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Starting recovery action: </span><span class="si">{</span><span class="n">action</span><span class="o">.</span><span class="n">value</span><span class="si">}</span><span class="s2"> (trigger: </span><span class="si">{</span><span class="n">trigger</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
            
            <span class="k">if</span> <span class="n">action</span> <span class="o">==</span> <span class="n">RecoveryAction</span><span class="o">.</span><span class="n">LOG_WARNING</span><span class="p">:</span>
                <span class="n">success</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_log_warning</span><span class="p">(</span><span class="n">health_result</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">action</span> <span class="o">==</span> <span class="n">RecoveryAction</span><span class="o">.</span><span class="n">CLEAR_CONNECTIONS</span><span class="p">:</span>
                <span class="n">success</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_clear_connections</span><span class="p">()</span>
            <span class="k">elif</span> <span class="n">action</span> <span class="o">==</span> <span class="n">RecoveryAction</span><span class="o">.</span><span class="n">RESTART_SERVICE</span><span class="p">:</span>
                <span class="n">success</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_restart_service</span><span class="p">()</span>
            <span class="k">elif</span> <span class="n">action</span> <span class="o">==</span> <span class="n">RecoveryAction</span><span class="o">.</span><span class="n">EMERGENCY_STOP</span><span class="p">:</span>
                <span class="n">success</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_emergency_stop</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">error_message</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Unknown recovery action: </span><span class="si">{</span><span class="n">action</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">error_message</span><span class="p">)</span>
            
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">error_message</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Recovery action failed: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">error_message</span><span class="p">)</span>
            <span class="n">success</span> <span class="o">=</span> <span class="kc">False</span>
        
        <span class="k">finally</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">recovery_in_progress</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="n">duration_ms</span> <span class="o">=</span> <span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span><span class="p">)</span> <span class="o">*</span> <span class="n">PerformanceConfig</span><span class="o">.</span><span class="n">SECONDS_TO_MS</span>
            
            <span class="c1"># Create recovery event</span>
            <span class="n">event</span> <span class="o">=</span> <span class="n">RecoveryEvent</span><span class="p">(</span>
                <span class="n">timestamp</span><span class="o">=</span><span class="n">start_time</span><span class="p">,</span>
                <span class="n">action</span><span class="o">=</span><span class="n">action</span><span class="p">,</span>
                <span class="n">trigger</span><span class="o">=</span><span class="n">trigger</span><span class="p">,</span>
                <span class="n">health_status</span><span class="o">=</span><span class="n">health_result</span><span class="o">.</span><span class="n">overall_status</span><span class="p">,</span>
                <span class="n">success</span><span class="o">=</span><span class="n">success</span><span class="p">,</span>
                <span class="n">duration_ms</span><span class="o">=</span><span class="n">duration_ms</span><span class="p">,</span>
                <span class="n">error_message</span><span class="o">=</span><span class="n">error_message</span>
            <span class="p">)</span>
            
            <span class="c1"># Update statistics</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_update_recovery_stats</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
            
            <span class="c1"># Record in circuit breaker</span>
            <span class="k">if</span> <span class="n">success</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">circuit_breaker</span><span class="o">.</span><span class="n">record_success</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">circuit_breaker</span><span class="o">.</span><span class="n">record_failure</span><span class="p">()</span>
            
            <span class="c1"># Store event</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">recovery_history</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">last_recovery_time</span> <span class="o">=</span> <span class="n">start_time</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">recovery_count</span> <span class="o">+=</span> <span class="mi">1</span>
            
            <span class="c1"># Notify callbacks</span>
            <span class="k">for</span> <span class="n">callback</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">recovery_callbacks</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">callback</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Recovery callback </span><span class="si">{</span><span class="n">callback</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2"> failed: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            
            <span class="n">result_msg</span> <span class="o">=</span> <span class="s2">&quot;succeeded&quot;</span> <span class="k">if</span> <span class="n">success</span> <span class="k">else</span> <span class="s2">&quot;failed&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Recovery action </span><span class="si">{</span><span class="n">action</span><span class="o">.</span><span class="n">value</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">result_msg</span><span class="si">}</span><span class="s2"> in </span><span class="si">{</span><span class="n">duration_ms</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">ms&quot;</span><span class="p">)</span>
            
            <span class="k">return</span> <span class="n">event</span>
    
    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">_log_warning</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">health_result</span><span class="p">:</span> <span class="n">HealthCheckResult</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Log a warning about health issues.&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">warning_metrics</span> <span class="o">=</span> <span class="p">[</span><span class="n">m</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">health_result</span><span class="o">.</span><span class="n">metrics</span> <span class="k">if</span> <span class="n">m</span><span class="o">.</span><span class="n">status</span> <span class="o">==</span> <span class="n">HealthStatus</span><span class="o">.</span><span class="n">WARNING</span><span class="p">]</span>
            <span class="n">critical_metrics</span> <span class="o">=</span> <span class="p">[</span><span class="n">m</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">health_result</span><span class="o">.</span><span class="n">metrics</span> <span class="k">if</span> <span class="n">m</span><span class="o">.</span><span class="n">status</span> <span class="o">==</span> <span class="n">HealthStatus</span><span class="o">.</span><span class="n">CRITICAL</span><span class="p">]</span>
            
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Health warning detected: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">warning_metrics</span><span class="p">)</span><span class="si">}</span><span class="s2"> warning metrics, &quot;</span>
                              <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">critical_metrics</span><span class="p">)</span><span class="si">}</span><span class="s2"> critical metrics&quot;</span><span class="p">)</span>
            
            <span class="k">for</span> <span class="n">metric</span> <span class="ow">in</span> <span class="n">warning_metrics</span> <span class="o">+</span> <span class="n">critical_metrics</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">metric</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">metric</span><span class="o">.</span><span class="n">value</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="n">metric</span><span class="o">.</span><span class="n">status</span><span class="o">.</span><span class="n">value</span><span class="si">}</span><span class="s2">) - </span><span class="si">{</span><span class="n">metric</span><span class="o">.</span><span class="n">message</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to log warning: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">False</span>
    
    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">_clear_connections</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Clear all client connections to reset connection state.&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">server_instance</span> <span class="ow">or</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">server_instance</span><span class="p">,</span> <span class="s1">&#39;sio&#39;</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;No server instance available for connection clearing&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="kc">False</span>
            
            <span class="n">sio</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">server_instance</span><span class="o">.</span><span class="n">sio</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">sio</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Socket.IO instance not available&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="kc">False</span>
            
            <span class="c1"># Get current clients</span>
            <span class="n">clients</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">server_instance</span><span class="o">.</span><span class="n">clients</span><span class="p">)</span> <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">server_instance</span><span class="p">,</span> <span class="s1">&#39;clients&#39;</span><span class="p">)</span> <span class="k">else</span> <span class="p">[]</span>
            
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Clearing </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">clients</span><span class="p">)</span><span class="si">}</span><span class="s2"> client connections&quot;</span><span class="p">)</span>
            
            <span class="c1"># Disconnect all clients</span>
            <span class="k">for</span> <span class="n">client_id</span> <span class="ow">in</span> <span class="n">clients</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="k">await</span> <span class="n">sio</span><span class="o">.</span><span class="n">disconnect</span><span class="p">(</span><span class="n">client_id</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to disconnect client </span><span class="si">{</span><span class="n">client_id</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            
            <span class="c1"># Clear client tracking</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">server_instance</span><span class="p">,</span> <span class="s1">&#39;clients&#39;</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">server_instance</span><span class="o">.</span><span class="n">clients</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">server_instance</span><span class="p">,</span> <span class="s1">&#39;client_versions&#39;</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">server_instance</span><span class="o">.</span><span class="n">client_versions</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
            
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Client connections cleared successfully&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">True</span>
            
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to clear connections: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">False</span>
    
    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">_restart_service</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Restart the Socket.IO service.&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">server_instance</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;No server instance available for restart&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="kc">False</span>
            
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Attempting graceful service restart&quot;</span><span class="p">)</span>
            
            <span class="c1"># Save current configuration</span>
            <span class="n">host</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">server_instance</span><span class="p">,</span> <span class="s1">&#39;host&#39;</span><span class="p">,</span> <span class="s1">&#39;localhost&#39;</span><span class="p">)</span>
            <span class="n">port</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">server_instance</span><span class="p">,</span> <span class="s1">&#39;port&#39;</span><span class="p">,</span> <span class="mi">8765</span><span class="p">)</span>
            
            <span class="c1"># Stop current server</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">server_instance</span><span class="o">.</span><span class="n">_shutdown_async</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Server shutdown completed&quot;</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error during shutdown: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            
            <span class="c1"># Wait a moment for cleanup</span>
            <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            
            <span class="c1"># Restart server</span>
            <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">server_instance</span><span class="o">.</span><span class="n">start_async</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Server restart completed successfully&quot;</span><span class="p">)</span>
            
            <span class="k">return</span> <span class="kc">True</span>
            
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to restart service: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">False</span>
    
    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">_emergency_stop</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Perform emergency stop of the service.&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="s2">&quot;Performing emergency stop due to critical health issues&quot;</span><span class="p">)</span>
            
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">server_instance</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="c1"># Force immediate shutdown</span>
                    <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">server_instance</span><span class="o">.</span><span class="n">_shutdown_async</span><span class="p">()</span>
                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error during emergency shutdown: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            
            <span class="c1"># Send termination signal to process</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">os</span><span class="o">.</span><span class="n">kill</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getpid</span><span class="p">(),</span> <span class="n">signal</span><span class="o">.</span><span class="n">SIGTERM</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to send termination signal: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="kc">False</span>
            
            <span class="k">return</span> <span class="kc">True</span>
            
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Emergency stop failed: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">False</span>
    
    <span class="k">def</span><span class="w"> </span><span class="nf">_update_recovery_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">:</span> <span class="n">RecoveryEvent</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Update recovery statistics with new event.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">recovery_stats</span><span class="p">[</span><span class="s1">&#39;total_recoveries&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
        
        <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">success</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">recovery_stats</span><span class="p">[</span><span class="s1">&#39;successful_recoveries&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">recovery_stats</span><span class="p">[</span><span class="s1">&#39;failed_recoveries&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">recovery_stats</span><span class="p">[</span><span class="s1">&#39;actions_performed&#39;</span><span class="p">][</span><span class="n">event</span><span class="o">.</span><span class="n">action</span><span class="o">.</span><span class="n">value</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
        
        <span class="c1"># Update average duration</span>
        <span class="n">total_recoveries</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">recovery_stats</span><span class="p">[</span><span class="s1">&#39;total_recoveries&#39;</span><span class="p">]</span>
        <span class="n">current_avg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">recovery_stats</span><span class="p">[</span><span class="s1">&#39;average_recovery_duration_ms&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">recovery_stats</span><span class="p">[</span><span class="s1">&#39;average_recovery_duration_ms&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
            <span class="p">(</span><span class="n">current_avg</span> <span class="o">*</span> <span class="p">(</span><span class="n">total_recoveries</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">event</span><span class="o">.</span><span class="n">duration_ms</span><span class="p">)</span> <span class="o">/</span> <span class="n">total_recoveries</span>
        <span class="p">)</span>
    
<div class="viewcode-block" id="RecoveryManager.get_recovery_status">
<a class="viewcode-back" href="../../../services/infrastructure.html#claude_mpm.services.recovery_manager.RecoveryManager.get_recovery_status">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_recovery_status</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get comprehensive recovery manager status.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="s1">&#39;enabled&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">enabled</span><span class="p">,</span>
            <span class="s1">&#39;recovery_in_progress&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">recovery_in_progress</span><span class="p">,</span>
            <span class="s1">&#39;last_recovery_time&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_recovery_time</span><span class="p">,</span>
            <span class="s1">&#39;recovery_count&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">recovery_count</span><span class="p">,</span>
            <span class="s1">&#39;strategy&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">recovery_strategy</span><span class="o">.</span><span class="n">get_name</span><span class="p">(),</span>
            <span class="s1">&#39;circuit_breaker&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">circuit_breaker</span><span class="o">.</span><span class="n">get_status</span><span class="p">(),</span>
            <span class="s1">&#39;recovery_stats&#39;</span><span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">recovery_stats</span><span class="p">),</span>
            <span class="s1">&#39;recent_recoveries&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">event</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span> <span class="k">for</span> <span class="n">event</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">recovery_history</span><span class="p">)[</span><span class="o">-</span><span class="mi">10</span><span class="p">:]],</span>
            <span class="s1">&#39;config&#39;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s1">&#39;check_interval&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_interval</span><span class="p">,</span>
                <span class="s1">&#39;max_recovery_attempts&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_recovery_attempts</span><span class="p">,</span>
                <span class="s1">&#39;recovery_timeout&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">recovery_timeout</span>
            <span class="p">}</span>
        <span class="p">}</span></div>

    
<div class="viewcode-block" id="RecoveryManager.get_recovery_history">
<a class="viewcode-back" href="../../../services/infrastructure.html#claude_mpm.services.recovery_manager.RecoveryManager.get_recovery_history">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_recovery_history</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">limit</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">RecoveryEvent</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get recovery event history.</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            limit: Maximum number of events to return</span>
<span class="sd">            </span>
<span class="sd">        Returns:</span>
<span class="sd">            List of recovery events, newest first</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">history</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">recovery_history</span><span class="p">)</span>
        <span class="n">history</span><span class="o">.</span><span class="n">reverse</span><span class="p">()</span>  <span class="c1"># Newest first</span>
        
        <span class="k">if</span> <span class="n">limit</span><span class="p">:</span>
            <span class="n">history</span> <span class="o">=</span> <span class="n">history</span><span class="p">[:</span><span class="n">limit</span><span class="p">]</span>
        
        <span class="k">return</span> <span class="n">history</span></div>

    
<div class="viewcode-block" id="RecoveryManager.is_enabled">
<a class="viewcode-back" href="../../../services/infrastructure.html#claude_mpm.services.recovery_manager.RecoveryManager.is_enabled">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">is_enabled</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Check if recovery manager is enabled.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">enabled</span></div>

    
<div class="viewcode-block" id="RecoveryManager.enable">
<a class="viewcode-back" href="../../../services/infrastructure.html#claude_mpm.services.recovery_manager.RecoveryManager.enable">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">enable</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Enable recovery manager.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">enabled</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Recovery manager enabled&quot;</span><span class="p">)</span></div>

    
<div class="viewcode-block" id="RecoveryManager.disable">
<a class="viewcode-back" href="../../../services/infrastructure.html#claude_mpm.services.recovery_manager.RecoveryManager.disable">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">disable</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Disable recovery manager.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">enabled</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Recovery manager disabled&quot;</span><span class="p">)</span></div>
</div>

</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025, Claude MPM Team.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>