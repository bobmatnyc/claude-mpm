

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../../../">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>claude_mpm.services.project.registry &mdash; Claude MPM API Reference 3.8.2 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../../../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../../../../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../../../../_static/custom.css?v=dbb19ff3" />
      <link rel="stylesheet" type="text/css" href="../../../../_static/custom.css?v=dbb19ff3" />

  
      <script src="../../../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../../../_static/documentation_options.js?v=070f1fcc"></script>
      <script src="../../../../_static/doctools.js?v=9bcbadda"></script>
      <script src="../../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: #2980B9" >

          
          
          <a href="../../../../index.html" class="icon icon-home">
            Claude MPM API Reference
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Core API</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../core/index.html">Core API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../services/index.html">Services API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../agents/index.html">Agents API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../hooks/index.html">Hooks API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../cli/index.html">CLI API</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../modules.html">claude_mpm</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../genindex.html">Index</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../py-modindex.html">Module Index</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../search.html">Search Page</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu"  style="background: #2980B9" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../index.html">Claude MPM API Reference</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../../index.html">Module code</a></li>
          <li class="breadcrumb-item"><a href="../../services.html">claude_mpm.services</a></li>
      <li class="breadcrumb-item active">claude_mpm.services.project.registry</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for claude_mpm.services.project.registry</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Project Registry Service.</span>

<span class="sd">WHY: This service manages a persistent registry of claude-mpm projects to enable</span>
<span class="sd">project identification, tracking, and metadata management. The registry stores</span>
<span class="sd">comprehensive project information including git status, environment details,</span>
<span class="sd">runtime information, and project characteristics.</span>

<span class="sd">DESIGN DECISION: Uses YAML for human-readable registry files stored in the</span>
<span class="sd">user&#39;s home directory (~/.claude-mpm/registry/). Each project</span>
<span class="sd">gets a unique UUID-based registry file to avoid conflicts and enable easy project</span>
<span class="sd">identification. Registry is user-specific for better isolation and persistence.</span>

<span class="sd">The registry captures both static project information (paths, git info) and</span>
<span class="sd">dynamic runtime information (startup times, process IDs, command line args)</span>
<span class="sd">to provide complete project lifecycle tracking.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">sys</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">uuid</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">subprocess</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">platform</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">shutil</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">datetime</span><span class="w"> </span><span class="kn">import</span> <span class="n">datetime</span><span class="p">,</span> <span class="n">timezone</span><span class="p">,</span> <span class="n">timedelta</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">Any</span><span class="p">,</span> <span class="n">Optional</span><span class="p">,</span> <span class="n">List</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">yaml</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">claude_mpm.core.logger</span><span class="w"> </span><span class="kn">import</span> <span class="n">get_logger</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">claude_mpm.deployment_paths</span><span class="w"> </span><span class="kn">import</span> <span class="n">get_project_root</span>


<div class="viewcode-block" id="ProjectRegistryError">
<a class="viewcode-back" href="../../../../claude_mpm.services.project.registry.html#claude_mpm.services.project.ProjectRegistryError">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">ProjectRegistryError</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Base exception for project registry operations.&quot;&quot;&quot;</span>
    <span class="k">pass</span></div>



<div class="viewcode-block" id="ProjectRegistry">
<a class="viewcode-back" href="../../../../claude_mpm.services.project.registry.html#claude_mpm.services.project.ProjectRegistry">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">ProjectRegistry</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Manages the project registry for claude-mpm installations.</span>
<span class="sd">    </span>
<span class="sd">    WHY: The project registry provides persistent project tracking across sessions,</span>
<span class="sd">    enabling project identification, metadata collection, and usage analytics.</span>
<span class="sd">    This is crucial for multi-project environments where users switch between</span>
<span class="sd">    different codebases.</span>
<span class="sd">    </span>
<span class="sd">    DESIGN DECISION: Registry files are stored in ~/.claude-mpm/registry/</span>
<span class="sd">    with UUID-based filenames to ensure uniqueness and avoid conflicts. The registry</span>
<span class="sd">    uses YAML for human readability and ease of manual inspection/editing.</span>
<span class="sd">    Registry is stored in the user&#39;s home directory for persistence across projects.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
<div class="viewcode-block" id="ProjectRegistry.__init__">
<a class="viewcode-back" href="../../../../claude_mpm.services.project.registry.html#claude_mpm.services.project.ProjectRegistry.__init__">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialize the project registry.</span>
<span class="sd">        </span>
<span class="sd">        WHY: Sets up the registry directory and logger. The registry directory</span>
<span class="sd">        is created in the user&#39;s home directory to keep registry data user-specific</span>
<span class="sd">        and persistent across different projects and sessions.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span> <span class="o">=</span> <span class="n">get_logger</span><span class="p">(</span><span class="s2">&quot;project_registry&quot;</span><span class="p">)</span>
        <span class="c1"># Use user&#39;s home directory for registry to avoid project-specific contamination</span>
        <span class="c1"># This ensures registry persists across all projects for the user</span>
        <span class="n">user_home</span> <span class="o">=</span> <span class="n">Path</span><span class="o">.</span><span class="n">home</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">registry_dir</span> <span class="o">=</span> <span class="n">user_home</span> <span class="o">/</span> <span class="s2">&quot;.claude-mpm&quot;</span> <span class="o">/</span> <span class="s2">&quot;registry&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">current_project_path</span> <span class="o">=</span> <span class="n">Path</span><span class="o">.</span><span class="n">cwd</span><span class="p">()</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span>
        
        <span class="c1"># Ensure registry directory exists</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">registry_dir</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to create registry directory: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">ProjectRegistryError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Cannot create registry directory: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span></div>

    
<div class="viewcode-block" id="ProjectRegistry.get_or_create_project_entry">
<a class="viewcode-back" href="../../../../claude_mpm.services.project.registry.html#claude_mpm.services.project.ProjectRegistry.get_or_create_project_entry">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_or_create_project_entry</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get existing project registry entry or create a new one.</span>
<span class="sd">        </span>
<span class="sd">        WHY: This is the main entry point for project registration. It handles</span>
<span class="sd">        both new project registration and existing project updates, ensuring</span>
<span class="sd">        that every claude-mpm session is properly tracked.</span>
<span class="sd">        </span>
<span class="sd">        DESIGN DECISION: Matching is done by normalized absolute path to handle</span>
<span class="sd">        symbolic links and different path representations consistently.</span>
<span class="sd">        </span>
<span class="sd">        Returns:</span>
<span class="sd">            Dictionary containing the project registry data</span>
<span class="sd">            </span>
<span class="sd">        Raises:</span>
<span class="sd">            ProjectRegistryError: If registry operations fail</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Look for existing registry entry</span>
            <span class="n">existing_entry</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_find_existing_entry</span><span class="p">()</span>
            
            <span class="k">if</span> <span class="n">existing_entry</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Found existing project entry: </span><span class="si">{</span><span class="n">existing_entry</span><span class="p">[</span><span class="s1">&#39;project_id&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="c1"># Update existing entry with current session info</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_update_existing_entry</span><span class="p">(</span><span class="n">existing_entry</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Creating new project registry entry&quot;</span><span class="p">)</span>
                <span class="c1"># Create new entry</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_new_entry</span><span class="p">()</span>
                
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to get or create project entry: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">ProjectRegistryError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Registry operation failed: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span></div>

    
    <span class="k">def</span><span class="w"> </span><span class="nf">_find_existing_entry</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Search for existing registry entry matching current project path.</span>
<span class="sd">        </span>
<span class="sd">        WHY: We need to match projects by their absolute path to avoid creating</span>
<span class="sd">        duplicate entries when the same project is accessed from different</span>
<span class="sd">        working directories or via different path representations.</span>
<span class="sd">        </span>
<span class="sd">        Returns:</span>
<span class="sd">            Existing registry data if found, None otherwise</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Normalize current path for consistent matching</span>
            <span class="n">current_path_str</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current_project_path</span><span class="p">)</span>
            
            <span class="c1"># Search all registry files</span>
            <span class="k">for</span> <span class="n">registry_file</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">registry_dir</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s2">&quot;*.yaml&quot;</span><span class="p">):</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">registry_file</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                        <span class="n">data</span> <span class="o">=</span> <span class="n">yaml</span><span class="o">.</span><span class="n">safe_load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span> <span class="ow">or</span> <span class="p">{}</span>
                    
                    <span class="c1"># Check if project_path matches</span>
                    <span class="k">if</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;project_path&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="n">current_path_str</span><span class="p">:</span>
                        <span class="n">data</span><span class="p">[</span><span class="s1">&#39;_registry_file&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">registry_file</span>  <span class="c1"># Add file reference</span>
                        <span class="k">return</span> <span class="n">data</span>
                        
                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to read registry file </span><span class="si">{</span><span class="n">registry_file</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="k">continue</span>
            
            <span class="k">return</span> <span class="kc">None</span>
            
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error searching for existing entry: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>
    
    <span class="k">def</span><span class="w"> </span><span class="nf">_create_new_entry</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create a new project registry entry.</span>
<span class="sd">        </span>
<span class="sd">        WHY: New projects need to be registered with comprehensive metadata</span>
<span class="sd">        including project information, environment details, and initial runtime</span>
<span class="sd">        data. This creates a complete snapshot of the project at first access.</span>
<span class="sd">        </span>
<span class="sd">        Returns:</span>
<span class="sd">            Newly created registry data</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">project_id</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">())</span>
        <span class="n">registry_file</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">registry_dir</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">project_id</span><span class="si">}</span><span class="s2">.yaml&quot;</span>
        
        <span class="c1"># Build comprehensive project data</span>
        <span class="n">project_data</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;project_id&#39;</span><span class="p">:</span> <span class="n">project_id</span><span class="p">,</span>
            <span class="s1">&#39;project_path&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current_project_path</span><span class="p">),</span>
            <span class="s1">&#39;project_name&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_project_path</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
            <span class="s1">&#39;metadata&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_build_metadata</span><span class="p">(</span><span class="n">is_new</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
            <span class="s1">&#39;runtime&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_build_runtime_info</span><span class="p">(),</span>
            <span class="s1">&#39;environment&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_build_environment_info</span><span class="p">(),</span>
            <span class="s1">&#39;git&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_build_git_info</span><span class="p">(),</span>
            <span class="s1">&#39;session&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_build_session_info</span><span class="p">(),</span>
            <span class="s1">&#39;project_info&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_build_project_info</span><span class="p">()</span>
        <span class="p">}</span>
        
        <span class="c1"># Save to registry file</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_save_registry_data</span><span class="p">(</span><span class="n">registry_file</span><span class="p">,</span> <span class="n">project_data</span><span class="p">)</span>
        <span class="n">project_data</span><span class="p">[</span><span class="s1">&#39;_registry_file&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">registry_file</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Created new project registry entry: </span><span class="si">{</span><span class="n">project_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">project_data</span>
    
    <span class="k">def</span><span class="w"> </span><span class="nf">_update_existing_entry</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">existing_data</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Update existing project registry entry with current session information.</span>
<span class="sd">        </span>
<span class="sd">        WHY: Existing projects need their metadata updated to reflect current</span>
<span class="sd">        access patterns, runtime information, and any changes in project state.</span>
<span class="sd">        This maintains accurate usage tracking and project state history.</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            existing_data: The existing registry data to update</span>
<span class="sd">            </span>
<span class="sd">        Returns:</span>
<span class="sd">            Updated registry data</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">registry_file</span> <span class="o">=</span> <span class="n">existing_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;_registry_file&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">registry_file</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ProjectRegistryError</span><span class="p">(</span><span class="s2">&quot;Registry file reference missing from existing data&quot;</span><span class="p">)</span>
        
        <span class="c1"># Update timestamps and counters</span>
        <span class="n">metadata</span> <span class="o">=</span> <span class="n">existing_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;metadata&#39;</span><span class="p">,</span> <span class="p">{})</span>
        <span class="n">access_count</span> <span class="o">=</span> <span class="n">metadata</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;access_count&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="n">now</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(</span><span class="n">timezone</span><span class="o">.</span><span class="n">utc</span><span class="p">)</span><span class="o">.</span><span class="n">isoformat</span><span class="p">()</span>
        
        <span class="n">existing_data</span><span class="p">[</span><span class="s1">&#39;metadata&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">({</span>
            <span class="s1">&#39;updated_at&#39;</span><span class="p">:</span> <span class="n">now</span><span class="p">,</span>
            <span class="s1">&#39;last_accessed&#39;</span><span class="p">:</span> <span class="n">now</span><span class="p">,</span>
            <span class="s1">&#39;access_count&#39;</span><span class="p">:</span> <span class="n">access_count</span>
        <span class="p">})</span>
        
        <span class="c1"># Update runtime information</span>
        <span class="n">existing_data</span><span class="p">[</span><span class="s1">&#39;runtime&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_build_runtime_info</span><span class="p">()</span>
        
        <span class="c1"># Update session information</span>
        <span class="n">existing_data</span><span class="p">[</span><span class="s1">&#39;session&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_build_session_info</span><span class="p">()</span>
        
        <span class="c1"># Update git information (may have changed)</span>
        <span class="n">existing_data</span><span class="p">[</span><span class="s1">&#39;git&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_build_git_info</span><span class="p">()</span>
        
        <span class="c1"># Update project info (may have changed)</span>
        <span class="n">existing_data</span><span class="p">[</span><span class="s1">&#39;project_info&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_build_project_info</span><span class="p">()</span>
        
        <span class="c1"># Save updated data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_save_registry_data</span><span class="p">(</span><span class="n">registry_file</span><span class="p">,</span> <span class="n">existing_data</span><span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Updated project registry entry (access #</span><span class="si">{</span><span class="n">access_count</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">existing_data</span>
    
    <span class="k">def</span><span class="w"> </span><span class="nf">_build_metadata</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">is_new</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Build metadata section for registry entry.</span>
<span class="sd">        </span>
<span class="sd">        WHY: Metadata tracks creation, modification, and access patterns for</span>
<span class="sd">        analytics and project lifecycle management.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">now</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(</span><span class="n">timezone</span><span class="o">.</span><span class="n">utc</span><span class="p">)</span><span class="o">.</span><span class="n">isoformat</span><span class="p">()</span>
        
        <span class="n">metadata</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;updated_at&#39;</span><span class="p">:</span> <span class="n">now</span><span class="p">,</span>
            <span class="s1">&#39;last_accessed&#39;</span><span class="p">:</span> <span class="n">now</span><span class="p">,</span>
            <span class="s1">&#39;access_count&#39;</span><span class="p">:</span> <span class="mi">1</span>
        <span class="p">}</span>
        
        <span class="k">if</span> <span class="n">is_new</span><span class="p">:</span>
            <span class="n">metadata</span><span class="p">[</span><span class="s1">&#39;created_at&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">now</span>
        
        <span class="k">return</span> <span class="n">metadata</span>
    
    <span class="k">def</span><span class="w"> </span><span class="nf">_build_runtime_info</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Build runtime information section.</span>
<span class="sd">        </span>
<span class="sd">        WHY: Runtime information helps track session lifecycle, process management,</span>
<span class="sd">        and system state. This is valuable for debugging session issues and</span>
<span class="sd">        understanding usage patterns.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Get claude-mpm version</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="kn">from</span><span class="w"> </span><span class="nn">claude_mpm</span><span class="w"> </span><span class="kn">import</span> <span class="n">__version__</span> <span class="k">as</span> <span class="n">claude_mpm_version</span>
        <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
            <span class="n">claude_mpm_version</span> <span class="o">=</span> <span class="s2">&quot;unknown&quot;</span>
        
        <span class="k">return</span> <span class="p">{</span>
            <span class="s1">&#39;startup_time&#39;</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(</span><span class="n">timezone</span><span class="o">.</span><span class="n">utc</span><span class="p">)</span><span class="o">.</span><span class="n">isoformat</span><span class="p">(),</span>
            <span class="s1">&#39;pid&#39;</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">getpid</span><span class="p">(),</span>
            <span class="s1">&#39;python_version&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">sys</span><span class="o">.</span><span class="n">version_info</span><span class="o">.</span><span class="n">major</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="n">sys</span><span class="o">.</span><span class="n">version_info</span><span class="o">.</span><span class="n">minor</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="n">sys</span><span class="o">.</span><span class="n">version_info</span><span class="o">.</span><span class="n">micro</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="s1">&#39;claude_mpm_version&#39;</span><span class="p">:</span> <span class="n">claude_mpm_version</span><span class="p">,</span>
            <span class="s1">&#39;command_line&#39;</span><span class="p">:</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">),</span>
            <span class="s1">&#39;launch_method&#39;</span><span class="p">:</span> <span class="s1">&#39;subprocess&#39;</span>  <span class="c1"># Default, could be detected based on parent process</span>
        <span class="p">}</span>
    
    <span class="k">def</span><span class="w"> </span><span class="nf">_build_environment_info</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Build environment information section.</span>
<span class="sd">        </span>
<span class="sd">        WHY: Environment information helps with debugging, platform-specific</span>
<span class="sd">        behavior analysis, and provides context for project usage patterns</span>
<span class="sd">        across different systems and user setups.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="s1">&#39;user&#39;</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s1">&#39;USER&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s1">&#39;USERNAME&#39;</span><span class="p">,</span> <span class="s1">&#39;unknown&#39;</span><span class="p">),</span>
            <span class="s1">&#39;hostname&#39;</span><span class="p">:</span> <span class="n">platform</span><span class="o">.</span><span class="n">node</span><span class="p">(),</span>
            <span class="s1">&#39;os&#39;</span><span class="p">:</span> <span class="n">platform</span><span class="o">.</span><span class="n">system</span><span class="p">(),</span>
            <span class="s1">&#39;os_version&#39;</span><span class="p">:</span> <span class="n">platform</span><span class="o">.</span><span class="n">release</span><span class="p">(),</span>
            <span class="s1">&#39;shell&#39;</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s1">&#39;SHELL&#39;</span><span class="p">,</span> <span class="s1">&#39;unknown&#39;</span><span class="p">),</span>
            <span class="s1">&#39;terminal&#39;</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s1">&#39;TERM&#39;</span><span class="p">,</span> <span class="s1">&#39;unknown&#39;</span><span class="p">),</span>
            <span class="s1">&#39;cwd&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">Path</span><span class="o">.</span><span class="n">cwd</span><span class="p">())</span>
        <span class="p">}</span>
    
    <span class="k">def</span><span class="w"> </span><span class="nf">_build_git_info</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Build git repository information.</span>
<span class="sd">        </span>
<span class="sd">        WHY: Git information is crucial for project identification and tracking</span>
<span class="sd">        changes across different branches and commits. This helps understand</span>
<span class="sd">        project state and enables better project management features.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">git_info</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;is_repo&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
            <span class="s1">&#39;branch&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
            <span class="s1">&#39;remote_url&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
            <span class="s1">&#39;last_commit&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
            <span class="s1">&#39;has_uncommitted&#39;</span><span class="p">:</span> <span class="kc">False</span>
        <span class="p">}</span>
        
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Check if we&#39;re in a git repository</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span>
                <span class="p">[</span><span class="s1">&#39;git&#39;</span><span class="p">,</span> <span class="s1">&#39;rev-parse&#39;</span><span class="p">,</span> <span class="s1">&#39;--git-dir&#39;</span><span class="p">],</span>
                <span class="n">cwd</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">current_project_path</span><span class="p">,</span>
                <span class="n">capture_output</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">text</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">timeout</span><span class="o">=</span><span class="mi">5</span>
            <span class="p">)</span>
            
            <span class="k">if</span> <span class="n">result</span><span class="o">.</span><span class="n">returncode</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">git_info</span><span class="p">[</span><span class="s1">&#39;is_repo&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
                
                <span class="c1"># Get current branch</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">result</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span>
                        <span class="p">[</span><span class="s1">&#39;git&#39;</span><span class="p">,</span> <span class="s1">&#39;branch&#39;</span><span class="p">,</span> <span class="s1">&#39;--show-current&#39;</span><span class="p">],</span>
                        <span class="n">cwd</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">current_project_path</span><span class="p">,</span>
                        <span class="n">capture_output</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                        <span class="n">text</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                        <span class="n">timeout</span><span class="o">=</span><span class="mi">5</span>
                    <span class="p">)</span>
                    <span class="k">if</span> <span class="n">result</span><span class="o">.</span><span class="n">returncode</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">git_info</span><span class="p">[</span><span class="s1">&#39;branch&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                    <span class="k">pass</span>
                
                <span class="c1"># Get remote URL</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">result</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span>
                        <span class="p">[</span><span class="s1">&#39;git&#39;</span><span class="p">,</span> <span class="s1">&#39;remote&#39;</span><span class="p">,</span> <span class="s1">&#39;get-url&#39;</span><span class="p">,</span> <span class="s1">&#39;origin&#39;</span><span class="p">],</span>
                        <span class="n">cwd</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">current_project_path</span><span class="p">,</span>
                        <span class="n">capture_output</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                        <span class="n">text</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                        <span class="n">timeout</span><span class="o">=</span><span class="mi">5</span>
                    <span class="p">)</span>
                    <span class="k">if</span> <span class="n">result</span><span class="o">.</span><span class="n">returncode</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">git_info</span><span class="p">[</span><span class="s1">&#39;remote_url&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                    <span class="k">pass</span>
                
                <span class="c1"># Get last commit</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">result</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span>
                        <span class="p">[</span><span class="s1">&#39;git&#39;</span><span class="p">,</span> <span class="s1">&#39;rev-parse&#39;</span><span class="p">,</span> <span class="s1">&#39;HEAD&#39;</span><span class="p">],</span>
                        <span class="n">cwd</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">current_project_path</span><span class="p">,</span>
                        <span class="n">capture_output</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                        <span class="n">text</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                        <span class="n">timeout</span><span class="o">=</span><span class="mi">5</span>
                    <span class="p">)</span>
                    <span class="k">if</span> <span class="n">result</span><span class="o">.</span><span class="n">returncode</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">git_info</span><span class="p">[</span><span class="s1">&#39;last_commit&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                    <span class="k">pass</span>
                
                <span class="c1"># Check for uncommitted changes</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">result</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span>
                        <span class="p">[</span><span class="s1">&#39;git&#39;</span><span class="p">,</span> <span class="s1">&#39;status&#39;</span><span class="p">,</span> <span class="s1">&#39;--porcelain&#39;</span><span class="p">],</span>
                        <span class="n">cwd</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">current_project_path</span><span class="p">,</span>
                        <span class="n">capture_output</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                        <span class="n">text</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                        <span class="n">timeout</span><span class="o">=</span><span class="mi">5</span>
                    <span class="p">)</span>
                    <span class="k">if</span> <span class="n">result</span><span class="o">.</span><span class="n">returncode</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">git_info</span><span class="p">[</span><span class="s1">&#39;has_uncommitted&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
                <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                    <span class="k">pass</span>
        
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to get git info: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="n">git_info</span>
    
    <span class="k">def</span><span class="w"> </span><span class="nf">_build_session_info</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Build session information.</span>
<span class="sd">        </span>
<span class="sd">        WHY: Session information tracks the current claude-mpm session state,</span>
<span class="sd">        including active components and configuration. This helps with session</span>
<span class="sd">        management and debugging.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># These would be populated by the actual session manager</span>
        <span class="c1"># For now, we provide placeholders that can be updated by the caller</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="s1">&#39;session_id&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>  <span class="c1"># Could be set by session manager</span>
            <span class="s1">&#39;ticket_count&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>   <span class="c1"># Could be updated by ticket manager</span>
            <span class="s1">&#39;agent_count&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>    <span class="c1"># Could be updated by agent manager</span>
            <span class="s1">&#39;hooks_enabled&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>  <span class="c1"># Could be detected from configuration</span>
            <span class="s1">&#39;monitor_enabled&#39;</span><span class="p">:</span> <span class="kc">False</span>  <span class="c1"># Could be detected from process state</span>
        <span class="p">}</span>
    
    <span class="k">def</span><span class="w"> </span><span class="nf">_build_project_info</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Build project information section.</span>
<span class="sd">        </span>
<span class="sd">        WHY: Project information helps identify the type of project and its</span>
<span class="sd">        characteristics, enabling better tool selection and project-specific</span>
<span class="sd">        optimizations.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">project_info</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;has_claude_config&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
            <span class="s1">&#39;has_claude_md&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
            <span class="s1">&#39;has_pyproject&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
            <span class="s1">&#39;has_package_json&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
            <span class="s1">&#39;project_type&#39;</span><span class="p">:</span> <span class="s1">&#39;unknown&#39;</span>
        <span class="p">}</span>
        
        <span class="c1"># Check for various project files</span>
        <span class="n">claude_files</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;.claude&#39;</span><span class="p">,</span> <span class="s1">&#39;claude.toml&#39;</span><span class="p">,</span> <span class="s1">&#39;.claude.toml&#39;</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">claude_file</span> <span class="ow">in</span> <span class="n">claude_files</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current_project_path</span> <span class="o">/</span> <span class="n">claude_file</span><span class="p">)</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
                <span class="n">project_info</span><span class="p">[</span><span class="s1">&#39;has_claude_config&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">break</span>
        
        <span class="n">claude_md_files</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;CLAUDE.md&#39;</span><span class="p">,</span> <span class="s1">&#39;claude.md&#39;</span><span class="p">,</span> <span class="s1">&#39;.claude.md&#39;</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">claude_md</span> <span class="ow">in</span> <span class="n">claude_md_files</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current_project_path</span> <span class="o">/</span> <span class="n">claude_md</span><span class="p">)</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
                <span class="n">project_info</span><span class="p">[</span><span class="s1">&#39;has_claude_md&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">break</span>
        
        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current_project_path</span> <span class="o">/</span> <span class="s1">&#39;pyproject.toml&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
            <span class="n">project_info</span><span class="p">[</span><span class="s1">&#39;has_pyproject&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
        
        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current_project_path</span> <span class="o">/</span> <span class="s1">&#39;package.json&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
            <span class="n">project_info</span><span class="p">[</span><span class="s1">&#39;has_package_json&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
        
        <span class="c1"># Determine project type</span>
        <span class="k">if</span> <span class="n">project_info</span><span class="p">[</span><span class="s1">&#39;has_pyproject&#39;</span><span class="p">]</span> <span class="ow">or</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current_project_path</span> <span class="o">/</span> <span class="s1">&#39;setup.py&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
            <span class="n">project_info</span><span class="p">[</span><span class="s1">&#39;project_type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;python&#39;</span>
        <span class="k">elif</span> <span class="n">project_info</span><span class="p">[</span><span class="s1">&#39;has_package_json&#39;</span><span class="p">]:</span>
            <span class="n">project_info</span><span class="p">[</span><span class="s1">&#39;project_type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;javascript&#39;</span>
        <span class="k">elif</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current_project_path</span> <span class="o">/</span> <span class="s1">&#39;Cargo.toml&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
            <span class="n">project_info</span><span class="p">[</span><span class="s1">&#39;project_type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;rust&#39;</span>
        <span class="k">elif</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current_project_path</span> <span class="o">/</span> <span class="s1">&#39;go.mod&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
            <span class="n">project_info</span><span class="p">[</span><span class="s1">&#39;project_type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;go&#39;</span>
        <span class="k">elif</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current_project_path</span> <span class="o">/</span> <span class="s1">&#39;pom.xml&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
            <span class="n">project_info</span><span class="p">[</span><span class="s1">&#39;project_type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;java&#39;</span>
        <span class="k">elif</span> <span class="nb">any</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">current_project_path</span> <span class="o">/</span> <span class="n">ext</span><span class="p">)</span><span class="o">.</span><span class="n">exists</span><span class="p">()</span> <span class="k">for</span> <span class="n">ext</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;*.c&#39;</span><span class="p">,</span> <span class="s1">&#39;*.cpp&#39;</span><span class="p">,</span> <span class="s1">&#39;*.h&#39;</span><span class="p">,</span> <span class="s1">&#39;*.hpp&#39;</span><span class="p">]):</span>
            <span class="n">project_info</span><span class="p">[</span><span class="s1">&#39;project_type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;c/cpp&#39;</span>
        <span class="k">elif</span> <span class="n">project_info</span><span class="p">[</span><span class="s1">&#39;has_claude_config&#39;</span><span class="p">]</span> <span class="ow">or</span> <span class="n">project_info</span><span class="p">[</span><span class="s1">&#39;has_claude_md&#39;</span><span class="p">]:</span>
            <span class="n">project_info</span><span class="p">[</span><span class="s1">&#39;project_type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;claude&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Try to detect by file extensions</span>
            <span class="n">common_files</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current_project_path</span><span class="o">.</span><span class="n">iterdir</span><span class="p">())[:</span><span class="mi">20</span><span class="p">]</span>  <span class="c1"># Check first 20 files</span>
            <span class="n">extensions</span> <span class="o">=</span> <span class="p">{</span><span class="n">f</span><span class="o">.</span><span class="n">suffix</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">common_files</span> <span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">is_file</span><span class="p">()}</span>
            
            <span class="k">if</span> <span class="s1">&#39;.py&#39;</span> <span class="ow">in</span> <span class="n">extensions</span><span class="p">:</span>
                <span class="n">project_info</span><span class="p">[</span><span class="s1">&#39;project_type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;python&#39;</span>
            <span class="k">elif</span> <span class="nb">any</span><span class="p">(</span><span class="n">ext</span> <span class="ow">in</span> <span class="n">extensions</span> <span class="k">for</span> <span class="n">ext</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;.js&#39;</span><span class="p">,</span> <span class="s1">&#39;.ts&#39;</span><span class="p">,</span> <span class="s1">&#39;.jsx&#39;</span><span class="p">,</span> <span class="s1">&#39;.tsx&#39;</span><span class="p">]):</span>
                <span class="n">project_info</span><span class="p">[</span><span class="s1">&#39;project_type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;javascript&#39;</span>
            <span class="k">elif</span> <span class="nb">any</span><span class="p">(</span><span class="n">ext</span> <span class="ow">in</span> <span class="n">extensions</span> <span class="k">for</span> <span class="n">ext</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;.rs&#39;</span><span class="p">]):</span>
                <span class="n">project_info</span><span class="p">[</span><span class="s1">&#39;project_type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;rust&#39;</span>
            <span class="k">elif</span> <span class="nb">any</span><span class="p">(</span><span class="n">ext</span> <span class="ow">in</span> <span class="n">extensions</span> <span class="k">for</span> <span class="n">ext</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;.go&#39;</span><span class="p">]):</span>
                <span class="n">project_info</span><span class="p">[</span><span class="s1">&#39;project_type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;go&#39;</span>
            <span class="k">elif</span> <span class="nb">any</span><span class="p">(</span><span class="n">ext</span> <span class="ow">in</span> <span class="n">extensions</span> <span class="k">for</span> <span class="n">ext</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;.java&#39;</span><span class="p">,</span> <span class="s1">&#39;.scala&#39;</span><span class="p">,</span> <span class="s1">&#39;.kt&#39;</span><span class="p">]):</span>
                <span class="n">project_info</span><span class="p">[</span><span class="s1">&#39;project_type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;jvm&#39;</span>
            <span class="k">elif</span> <span class="nb">any</span><span class="p">(</span><span class="n">ext</span> <span class="ow">in</span> <span class="n">extensions</span> <span class="k">for</span> <span class="n">ext</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;.c&#39;</span><span class="p">,</span> <span class="s1">&#39;.cpp&#39;</span><span class="p">,</span> <span class="s1">&#39;.cc&#39;</span><span class="p">,</span> <span class="s1">&#39;.h&#39;</span><span class="p">,</span> <span class="s1">&#39;.hpp&#39;</span><span class="p">]):</span>
                <span class="n">project_info</span><span class="p">[</span><span class="s1">&#39;project_type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;c/cpp&#39;</span>
            <span class="k">elif</span> <span class="nb">any</span><span class="p">(</span><span class="n">ext</span> <span class="ow">in</span> <span class="n">extensions</span> <span class="k">for</span> <span class="n">ext</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;.md&#39;</span><span class="p">,</span> <span class="s1">&#39;.txt&#39;</span><span class="p">,</span> <span class="s1">&#39;.rst&#39;</span><span class="p">]):</span>
                <span class="n">project_info</span><span class="p">[</span><span class="s1">&#39;project_type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;documentation&#39;</span>
        
        <span class="k">return</span> <span class="n">project_info</span>
    
    <span class="k">def</span><span class="w"> </span><span class="nf">_save_registry_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">registry_file</span><span class="p">:</span> <span class="n">Path</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Save registry data to YAML file.</span>
<span class="sd">        </span>
<span class="sd">        WHY: Centralized saving logic ensures consistent formatting and error</span>
<span class="sd">        handling across all registry operations. YAML format provides human</span>
<span class="sd">        readability for debugging and manual inspection.</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            registry_file: Path to the registry file</span>
<span class="sd">            data: Registry data to save</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Remove internal fields before saving</span>
            <span class="n">save_data</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">k</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)}</span>
            
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">registry_file</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">yaml</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">save_data</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">default_flow_style</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">sort_keys</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
                
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Saved registry data to </span><span class="si">{</span><span class="n">registry_file</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to save registry data: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">ProjectRegistryError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to save registry: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    
<div class="viewcode-block" id="ProjectRegistry.list_projects">
<a class="viewcode-back" href="../../../../claude_mpm.services.project.registry.html#claude_mpm.services.project.ProjectRegistry.list_projects">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">list_projects</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        List all registered projects.</span>
<span class="sd">        </span>
<span class="sd">        WHY: Provides visibility into all projects managed by claude-mpm,</span>
<span class="sd">        useful for project management and analytics.</span>
<span class="sd">        </span>
<span class="sd">        Returns:</span>
<span class="sd">            List of project registry data dictionaries</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">projects</span> <span class="o">=</span> <span class="p">[]</span>
        
        <span class="k">try</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">registry_file</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">registry_dir</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s2">&quot;*.yaml&quot;</span><span class="p">):</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">registry_file</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                        <span class="n">data</span> <span class="o">=</span> <span class="n">yaml</span><span class="o">.</span><span class="n">safe_load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span> <span class="ow">or</span> <span class="p">{}</span>
                    <span class="n">projects</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to read registry file </span><span class="si">{</span><span class="n">registry_file</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="k">continue</span>
        
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to list projects: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="n">projects</span></div>

    
<div class="viewcode-block" id="ProjectRegistry.cleanup_old_entries">
<a class="viewcode-back" href="../../../../claude_mpm.services.project.registry.html#claude_mpm.services.project.ProjectRegistry.cleanup_old_entries">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">cleanup_old_entries</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">max_age_days</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">90</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Clean up old registry entries that haven&#39;t been accessed recently.</span>
<span class="sd">        </span>
<span class="sd">        WHY: Prevents registry directory from growing indefinitely with old</span>
<span class="sd">        project entries. Keeps the registry focused on active projects.</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            max_age_days: Maximum age in days for keeping entries</span>
<span class="sd">            </span>
<span class="sd">        Returns:</span>
<span class="sd">            Number of entries cleaned up</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">max_age_days</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">0</span>
        
        <span class="n">cleaned_count</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">cutoff_date</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(</span><span class="n">timezone</span><span class="o">.</span><span class="n">utc</span><span class="p">)</span> <span class="o">-</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="n">max_age_days</span><span class="p">)</span>
        
        <span class="k">try</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">registry_file</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">registry_dir</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s2">&quot;*.yaml&quot;</span><span class="p">):</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">registry_file</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                        <span class="n">data</span> <span class="o">=</span> <span class="n">yaml</span><span class="o">.</span><span class="n">safe_load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span> <span class="ow">or</span> <span class="p">{}</span>
                    
                    <span class="c1"># Check last accessed time</span>
                    <span class="n">last_accessed_str</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;metadata&#39;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;last_accessed&#39;</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">last_accessed_str</span><span class="p">:</span>
                        <span class="n">last_accessed</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">fromisoformat</span><span class="p">(</span><span class="n">last_accessed_str</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;Z&#39;</span><span class="p">,</span> <span class="s1">&#39;+00:00&#39;</span><span class="p">))</span>
                        <span class="k">if</span> <span class="n">last_accessed</span> <span class="o">&lt;</span> <span class="n">cutoff_date</span><span class="p">:</span>
                            <span class="n">registry_file</span><span class="o">.</span><span class="n">unlink</span><span class="p">()</span>
                            <span class="n">cleaned_count</span> <span class="o">+=</span> <span class="mi">1</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Cleaned up old registry entry: </span><span class="si">{</span><span class="n">registry_file</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                    
                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to process registry file </span><span class="si">{</span><span class="n">registry_file</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="k">continue</span>
        
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to cleanup old entries: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">cleaned_count</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Cleaned up </span><span class="si">{</span><span class="n">cleaned_count</span><span class="si">}</span><span class="s2"> old registry entries&quot;</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="n">cleaned_count</span></div>

    
<div class="viewcode-block" id="ProjectRegistry.update_session_info">
<a class="viewcode-back" href="../../../../claude_mpm.services.project.registry.html#claude_mpm.services.project.ProjectRegistry.update_session_info">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">update_session_info</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">session_updates</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Update session information for the current project.</span>
<span class="sd">        </span>
<span class="sd">        WHY: Allows other components (session manager, ticket manager, etc.)</span>
<span class="sd">        to update the registry with current session state information.</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            session_updates: Dictionary of session updates to apply</span>
<span class="sd">            </span>
<span class="sd">        Returns:</span>
<span class="sd">            True if update was successful, False otherwise</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">existing_entry</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_find_existing_entry</span><span class="p">()</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">existing_entry</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;No existing registry entry found for session update&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="kc">False</span>
            
            <span class="n">registry_file</span> <span class="o">=</span> <span class="n">existing_entry</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;_registry_file&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">registry_file</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Registry file reference missing&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="kc">False</span>
            
            <span class="c1"># Update session information</span>
            <span class="k">if</span> <span class="s1">&#39;session&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">existing_entry</span><span class="p">:</span>
                <span class="n">existing_entry</span><span class="p">[</span><span class="s1">&#39;session&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
            
            <span class="n">existing_entry</span><span class="p">[</span><span class="s1">&#39;session&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">session_updates</span><span class="p">)</span>
            
            <span class="c1"># Update metadata timestamp</span>
            <span class="n">now</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(</span><span class="n">timezone</span><span class="o">.</span><span class="n">utc</span><span class="p">)</span><span class="o">.</span><span class="n">isoformat</span><span class="p">()</span>
            <span class="n">existing_entry</span><span class="p">[</span><span class="s1">&#39;metadata&#39;</span><span class="p">][</span><span class="s1">&#39;updated_at&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">now</span>
            
            <span class="c1"># Save updated data</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_save_registry_data</span><span class="p">(</span><span class="n">registry_file</span><span class="p">,</span> <span class="n">existing_entry</span><span class="p">)</span>
            
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Updated session info: </span><span class="si">{</span><span class="n">session_updates</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">True</span>
            
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to update session info: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">False</span></div>
</div>

</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025, Claude MPM Team.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>