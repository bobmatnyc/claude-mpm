

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../../../">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>claude_mpm.services.version_control.semantic_versioning &mdash; Claude MPM API Reference 3.8.2 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../../../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../../../../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../../../../_static/custom.css?v=dbb19ff3" />
      <link rel="stylesheet" type="text/css" href="../../../../_static/custom.css?v=dbb19ff3" />

  
      <script src="../../../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../../../_static/documentation_options.js?v=070f1fcc"></script>
      <script src="../../../../_static/doctools.js?v=9bcbadda"></script>
      <script src="../../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: #2980B9" >

          
          
          <a href="../../../../index.html" class="icon icon-home">
            Claude MPM API Reference
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Core API</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../core/index.html">Core API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../services/index.html">Services API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../agents/index.html">Agents API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../hooks/index.html">Hooks API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../cli/index.html">CLI API</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../modules.html">claude_mpm</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../genindex.html">Index</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../py-modindex.html">Module Index</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../search.html">Search Page</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu"  style="background: #2980B9" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../index.html">Claude MPM API Reference</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../../index.html">Module code</a></li>
          <li class="breadcrumb-item"><a href="../../services.html">claude_mpm.services</a></li>
      <li class="breadcrumb-item active">claude_mpm.services.version_control.semantic_versioning</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for claude_mpm.services.version_control.semantic_versioning</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Semantic Versioning Manager - Version management logic for Version Control Agent.</span>

<span class="sd">This module provides comprehensive semantic versioning management including:</span>
<span class="sd">1. Version parsing and validation</span>
<span class="sd">2. Automatic version bumping based on changes</span>
<span class="sd">3. Changelog generation and management</span>
<span class="sd">4. Tag creation and management</span>
<span class="sd">5. Version metadata handling</span>

<span class="sd">Semantic Versioning Strategy:</span>
<span class="sd">- Follows semver.org specification 2.0.0</span>
<span class="sd">- Format: MAJOR.MINOR.PATCH[-PRERELEASE][+BUILD]</span>
<span class="sd">- MAJOR: Incompatible API changes</span>
<span class="sd">- MINOR: Backwards-compatible functionality additions</span>
<span class="sd">- PATCH: Backwards-compatible bug fixes</span>
<span class="sd">- PRERELEASE: Optional pre-release identifiers (alpha, beta, rc)</span>
<span class="sd">- BUILD: Optional build metadata</span>

<span class="sd">Agent Version Management:</span>
<span class="sd">- Agents use semantic versioning for consistency</span>
<span class="sd">- Version stored in agent template JSON files</span>
<span class="sd">- Automatic migration from old formats (serial, integer)</span>
<span class="sd">- Version comparison for deployment decisions</span>
<span class="sd">- Base and agent version tracking</span>

<span class="sd">Version Detection:</span>
<span class="sd">- Multiple file format support (package.json, pyproject.toml, etc.)</span>
<span class="sd">- Git tag integration for version history</span>
<span class="sd">- Changelog parsing for version tracking</span>
<span class="sd">- Fallback mechanisms for missing version info</span>

<span class="sd">Change Analysis:</span>
<span class="sd">- Conventional commit pattern matching</span>
<span class="sd">- Breaking change detection</span>
<span class="sd">- Feature and bug fix classification</span>
<span class="sd">- Confidence scoring for version bump suggestions</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">re</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">json</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">datetime</span><span class="w"> </span><span class="kn">import</span> <span class="n">datetime</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">List</span><span class="p">,</span> <span class="n">Optional</span><span class="p">,</span> <span class="n">Any</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">,</span> <span class="n">Union</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">dataclasses</span><span class="w"> </span><span class="kn">import</span> <span class="n">dataclass</span><span class="p">,</span> <span class="n">field</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">enum</span><span class="w"> </span><span class="kn">import</span> <span class="n">Enum</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">logging</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">...utils.config_manager</span><span class="w"> </span><span class="kn">import</span> <span class="n">ConfigurationManager</span>


<div class="viewcode-block" id="VersionBumpType">
<a class="viewcode-back" href="../../../../claude_mpm.services.version_control.semantic_versioning.html#claude_mpm.services.version_control.VersionBumpType">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">VersionBumpType</span><span class="p">(</span><span class="n">Enum</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Types of version bumps.&quot;&quot;&quot;</span>

    <span class="n">MAJOR</span> <span class="o">=</span> <span class="s2">&quot;major&quot;</span>
    <span class="n">MINOR</span> <span class="o">=</span> <span class="s2">&quot;minor&quot;</span>
    <span class="n">PATCH</span> <span class="o">=</span> <span class="s2">&quot;patch&quot;</span>
    <span class="n">PRERELEASE</span> <span class="o">=</span> <span class="s2">&quot;prerelease&quot;</span></div>



<div class="viewcode-block" id="SemanticVersion">
<a class="viewcode-back" href="../../../../claude_mpm.services.version_control.semantic_versioning.html#claude_mpm.services.version_control.SemanticVersion">[docs]</a>
<span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">SemanticVersion</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Represents a semantic version following semver.org specification.</span>
<span class="sd">    </span>
<span class="sd">    This class encapsulates a semantic version with support for:</span>
<span class="sd">    - Major, minor, and patch version numbers</span>
<span class="sd">    - Pre-release identifiers (alpha, beta, rc, etc.)</span>
<span class="sd">    - Build metadata</span>
<span class="sd">    - Version comparison and sorting</span>
<span class="sd">    - Version bumping operations</span>
<span class="sd">    </span>
<span class="sd">    The comparison logic follows semver precedence rules:</span>
<span class="sd">    1. Compare major, minor, patch numerically</span>
<span class="sd">    2. Pre-release versions have lower precedence than normal versions</span>
<span class="sd">    3. Pre-release identifiers are compared alphanumerically</span>
<span class="sd">    4. Build metadata is ignored in comparisons</span>
<span class="sd">    </span>
<span class="sd">    This is used for both project versioning and agent version management.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">major</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">minor</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">patch</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">prerelease</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">build</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

<div class="viewcode-block" id="SemanticVersion.__str__">
<a class="viewcode-back" href="../../../../claude_mpm.services.version_control.semantic_versioning.html#claude_mpm.services.version_control.SemanticVersion.__str__">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;String representation of version in semver format.</span>
<span class="sd">        </span>
<span class="sd">        Examples:</span>
<span class="sd">        - 1.2.3</span>
<span class="sd">        - 1.2.3-alpha.1</span>
<span class="sd">        - 1.2.3-beta.2+build.123</span>
<span class="sd">        - 1.2.3+20230615</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">version</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">major</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">minor</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">patch</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">prerelease</span><span class="p">:</span>
            <span class="n">version</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;-</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">prerelease</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">build</span><span class="p">:</span>
            <span class="n">version</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;+</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">build</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">return</span> <span class="n">version</span></div>


<div class="viewcode-block" id="SemanticVersion.__lt__">
<a class="viewcode-back" href="../../../../claude_mpm.services.version_control.semantic_versioning.html#claude_mpm.services.version_control.SemanticVersion.__lt__">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="fm">__lt__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="s2">&quot;SemanticVersion&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Compare versions for sorting according to semver precedence.</span>
<span class="sd">        </span>
<span class="sd">        Comparison Rules:</span>
<span class="sd">        1. Version core (major.minor.patch) compared numerically</span>
<span class="sd">        2. Version with pre-release &lt; same version without pre-release</span>
<span class="sd">        3. Pre-release versions compared alphanumerically</span>
<span class="sd">        4. Build metadata ignored (1.0.0+build1 == 1.0.0+build2)</span>
<span class="sd">        </span>
<span class="sd">        This enables proper version sorting for:</span>
<span class="sd">        - Determining latest version</span>
<span class="sd">        - Agent deployment decisions</span>
<span class="sd">        - Version history display</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Compare version core components</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">major</span> <span class="o">!=</span> <span class="n">other</span><span class="o">.</span><span class="n">major</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">major</span> <span class="o">&lt;</span> <span class="n">other</span><span class="o">.</span><span class="n">major</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">minor</span> <span class="o">!=</span> <span class="n">other</span><span class="o">.</span><span class="n">minor</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">minor</span> <span class="o">&lt;</span> <span class="n">other</span><span class="o">.</span><span class="n">minor</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">patch</span> <span class="o">!=</span> <span class="n">other</span><span class="o">.</span><span class="n">patch</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">patch</span> <span class="o">&lt;</span> <span class="n">other</span><span class="o">.</span><span class="n">patch</span>

        <span class="c1"># Handle prerelease comparison per semver spec</span>
        <span class="c1"># No prerelease &gt; with prerelease (1.0.0 &gt; 1.0.0-alpha)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">prerelease</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">other</span><span class="o">.</span><span class="n">prerelease</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">prerelease</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">other</span><span class="o">.</span><span class="n">prerelease</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="c1"># Both have prerelease - compare alphanumerically</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">prerelease</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">other</span><span class="o">.</span><span class="n">prerelease</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">prerelease</span> <span class="o">&lt;</span> <span class="n">other</span><span class="o">.</span><span class="n">prerelease</span>

        <span class="k">return</span> <span class="kc">False</span></div>


<div class="viewcode-block" id="SemanticVersion.bump">
<a class="viewcode-back" href="../../../../claude_mpm.services.version_control.semantic_versioning.html#claude_mpm.services.version_control.SemanticVersion.bump">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">bump</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bump_type</span><span class="p">:</span> <span class="n">VersionBumpType</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;SemanticVersion&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create a new version with the specified bump applied.</span>
<span class="sd">        </span>
<span class="sd">        Version Bump Rules:</span>
<span class="sd">        - MAJOR: Increment major, reset minor and patch to 0</span>
<span class="sd">        - MINOR: Increment minor, reset patch to 0</span>
<span class="sd">        - PATCH: Increment patch only</span>
<span class="sd">        - PRERELEASE: Handle pre-release progression</span>
<span class="sd">        </span>
<span class="sd">        Pre-release Progression:</span>
<span class="sd">        - No prerelease -&gt; alpha.1</span>
<span class="sd">        - alpha.1 -&gt; alpha.2</span>
<span class="sd">        - beta.1 -&gt; beta.2</span>
<span class="sd">        - rc.1 -&gt; rc.2</span>
<span class="sd">        - custom -&gt; custom.1</span>
<span class="sd">        </span>
<span class="sd">        Examples:</span>
<span class="sd">        - 1.2.3 + MAJOR -&gt; 2.0.0</span>
<span class="sd">        - 1.2.3 + MINOR -&gt; 1.3.0</span>
<span class="sd">        - 1.2.3 + PATCH -&gt; 1.2.4</span>
<span class="sd">        - 1.2.3 + PRERELEASE -&gt; 1.2.3-alpha.1</span>
<span class="sd">        - 1.2.3-alpha.1 + PRERELEASE -&gt; 1.2.3-alpha.2</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            bump_type: Type of version bump to apply</span>
<span class="sd">            </span>
<span class="sd">        Returns:</span>
<span class="sd">            New SemanticVersion instance with bump applied</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">bump_type</span> <span class="o">==</span> <span class="n">VersionBumpType</span><span class="o">.</span><span class="n">MAJOR</span><span class="p">:</span>
            <span class="c1"># Breaking changes - reset minor and patch</span>
            <span class="k">return</span> <span class="n">SemanticVersion</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">major</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">bump_type</span> <span class="o">==</span> <span class="n">VersionBumpType</span><span class="o">.</span><span class="n">MINOR</span><span class="p">:</span>
            <span class="c1"># New features - reset patch only</span>
            <span class="k">return</span> <span class="n">SemanticVersion</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">major</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">minor</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">bump_type</span> <span class="o">==</span> <span class="n">VersionBumpType</span><span class="o">.</span><span class="n">PATCH</span><span class="p">:</span>
            <span class="c1"># Bug fixes - increment patch only</span>
            <span class="k">return</span> <span class="n">SemanticVersion</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">major</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">minor</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">patch</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">bump_type</span> <span class="o">==</span> <span class="n">VersionBumpType</span><span class="o">.</span><span class="n">PRERELEASE</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">prerelease</span><span class="p">:</span>
                <span class="c1"># Increment existing prerelease number</span>
                <span class="n">match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;(.+?)(\d+)$&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">prerelease</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">match</span><span class="p">:</span>
                    <span class="n">prefix</span><span class="p">,</span> <span class="n">num</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="n">groups</span><span class="p">()</span>
                    <span class="n">new_prerelease</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">prefix</span><span class="si">}{</span><span class="nb">int</span><span class="p">(</span><span class="n">num</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c1"># Add .1 if no number present</span>
                    <span class="n">new_prerelease</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">prerelease</span><span class="si">}</span><span class="s2">.1&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># Start new prerelease series</span>
                <span class="n">new_prerelease</span> <span class="o">=</span> <span class="s2">&quot;alpha.1&quot;</span>

            <span class="k">return</span> <span class="n">SemanticVersion</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">major</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">minor</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">patch</span><span class="p">,</span> <span class="n">prerelease</span><span class="o">=</span><span class="n">new_prerelease</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span></div>
</div>



<div class="viewcode-block" id="VersionMetadata">
<a class="viewcode-back" href="../../../../claude_mpm.services.version_control.semantic_versioning.html#claude_mpm.services.version_control.VersionMetadata">[docs]</a>
<span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">VersionMetadata</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Metadata associated with a version.&quot;&quot;&quot;</span>

    <span class="n">version</span><span class="p">:</span> <span class="n">SemanticVersion</span>
    <span class="n">release_date</span><span class="p">:</span> <span class="n">datetime</span>
    <span class="n">commit_hash</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">tag_name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">changes</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">list</span><span class="p">)</span>
    <span class="n">breaking_changes</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">list</span><span class="p">)</span>
    <span class="n">contributors</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">list</span><span class="p">)</span>
    <span class="n">notes</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span></div>



<div class="viewcode-block" id="ChangeAnalysis">
<a class="viewcode-back" href="../../../../claude_mpm.services.version_control.semantic_versioning.html#claude_mpm.services.version_control.ChangeAnalysis">[docs]</a>
<span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">ChangeAnalysis</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Analysis of changes for version bumping.&quot;&quot;&quot;</span>

    <span class="n">has_breaking_changes</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">has_new_features</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">has_bug_fixes</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">change_descriptions</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">list</span><span class="p">)</span>
    <span class="n">suggested_bump</span><span class="p">:</span> <span class="n">VersionBumpType</span> <span class="o">=</span> <span class="n">VersionBumpType</span><span class="o">.</span><span class="n">PATCH</span>
    <span class="n">confidence</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span></div>



<div class="viewcode-block" id="SemanticVersionManager">
<a class="viewcode-back" href="../../../../claude_mpm.services.version_control.semantic_versioning.html#claude_mpm.services.version_control.SemanticVersionManager">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">SemanticVersionManager</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Manages semantic versioning for the Version Control Agent.</span>

<span class="sd">    Provides comprehensive version management including parsing, bumping,</span>
<span class="sd">    changelog generation, and integration with Git tags.</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="SemanticVersionManager.__init__">
<a class="viewcode-back" href="../../../../claude_mpm.services.version_control.semantic_versioning.html#claude_mpm.services.version_control.SemanticVersionManager.__init__">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">project_root</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">logger</span><span class="p">:</span> <span class="n">logging</span><span class="o">.</span><span class="n">Logger</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialize Semantic Version Manager.</span>

<span class="sd">        Args:</span>
<span class="sd">            project_root: Root directory of the project</span>
<span class="sd">            logger: Logger instance</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">project_root</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">project_root</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span> <span class="o">=</span> <span class="n">logger</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">config_mgr</span> <span class="o">=</span> <span class="n">ConfigurationManager</span><span class="p">(</span><span class="n">cache_enabled</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># Version file patterns</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">version_files</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;package.json&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_package_json_version</span><span class="p">,</span>
            <span class="s2">&quot;pyproject.toml&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_pyproject_toml_version</span><span class="p">,</span>
            <span class="s2">&quot;Cargo.toml&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_cargo_toml_version</span><span class="p">,</span>
            <span class="s2">&quot;VERSION&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_version_file</span><span class="p">,</span>
            <span class="s2">&quot;version.txt&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_version_file</span><span class="p">,</span>
            <span class="s2">&quot;pom.xml&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_pom_xml_version</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="c1"># Change patterns for analysis</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">breaking_change_patterns</span> <span class="o">=</span> <span class="p">[</span>
            <span class="sa">r</span><span class="s2">&quot;\bbreaking\b&quot;</span><span class="p">,</span>
            <span class="sa">r</span><span class="s2">&quot;\bbreaking[-_]change\b&quot;</span><span class="p">,</span>
            <span class="sa">r</span><span class="s2">&quot;\bremove\b.*\bapi\b&quot;</span><span class="p">,</span>
            <span class="sa">r</span><span class="s2">&quot;\bdelete\b.*\bapi\b&quot;</span><span class="p">,</span>
            <span class="sa">r</span><span class="s2">&quot;\bdrop\b.*\bsupport\b&quot;</span><span class="p">,</span>
            <span class="sa">r</span><span class="s2">&quot;\bincompatible\b&quot;</span><span class="p">,</span>
            <span class="sa">r</span><span class="s2">&quot;\bmajor\b.*\bchange\b&quot;</span><span class="p">,</span>
        <span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">feature_patterns</span> <span class="o">=</span> <span class="p">[</span>
            <span class="sa">r</span><span class="s2">&quot;\badd\b&quot;</span><span class="p">,</span>
            <span class="sa">r</span><span class="s2">&quot;\bnew\b.*\bfeature\b&quot;</span><span class="p">,</span>
            <span class="sa">r</span><span class="s2">&quot;\bimplement\b&quot;</span><span class="p">,</span>
            <span class="sa">r</span><span class="s2">&quot;\benhance\b&quot;</span><span class="p">,</span>
            <span class="sa">r</span><span class="s2">&quot;\bintroduce\b&quot;</span><span class="p">,</span>
            <span class="sa">r</span><span class="s2">&quot;\bfeature\b.*\badd\b&quot;</span><span class="p">,</span>
        <span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">bug_fix_patterns</span> <span class="o">=</span> <span class="p">[</span>
            <span class="sa">r</span><span class="s2">&quot;\bfix\b&quot;</span><span class="p">,</span>
            <span class="sa">r</span><span class="s2">&quot;\bbug\b.*\bfix\b&quot;</span><span class="p">,</span>
            <span class="sa">r</span><span class="s2">&quot;\bresolve\b&quot;</span><span class="p">,</span>
            <span class="sa">r</span><span class="s2">&quot;\bcorrect\b&quot;</span><span class="p">,</span>
            <span class="sa">r</span><span class="s2">&quot;\bpatch\b&quot;</span><span class="p">,</span>
            <span class="sa">r</span><span class="s2">&quot;\bhotfix\b&quot;</span><span class="p">,</span>
        <span class="p">]</span></div>


<div class="viewcode-block" id="SemanticVersionManager.parse_version">
<a class="viewcode-back" href="../../../../claude_mpm.services.version_control.semantic_versioning.html#claude_mpm.services.version_control.SemanticVersionManager.parse_version">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">parse_version</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">version_string</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">SemanticVersion</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Parse a version string into a SemanticVersion object.</span>

<span class="sd">        Version String Formats Supported:</span>
<span class="sd">        - 1.2.3 (basic semantic version)</span>
<span class="sd">        - v1.2.3 (with &#39;v&#39; prefix - common in git tags)</span>
<span class="sd">        - 1.2.3-alpha (with prerelease)</span>
<span class="sd">        - 1.2.3-alpha.1 (with prerelease and number)</span>
<span class="sd">        - 1.2.3-beta.2+build.123 (full format)</span>
<span class="sd">        - 1.2.3+20230615 (with build metadata only)</span>
<span class="sd">        </span>
<span class="sd">        The parser is flexible and handles:</span>
<span class="sd">        - Optional &#39;v&#39; prefix (stripped automatically)</span>
<span class="sd">        - Whitespace trimming</span>
<span class="sd">        - Full semver specification compliance</span>
<span class="sd">        - Graceful failure for invalid formats</span>
<span class="sd">        </span>
<span class="sd">        This is used for:</span>
<span class="sd">        - Parsing versions from files (package.json, etc.)</span>
<span class="sd">        - Converting git tags to versions</span>
<span class="sd">        - Agent version parsing and migration</span>
<span class="sd">        - User input validation</span>

<span class="sd">        Args:</span>
<span class="sd">            version_string: Version string to parse</span>

<span class="sd">        Returns:</span>
<span class="sd">            SemanticVersion object or None if parsing fails</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Clean up version string - handle common variations</span>
            <span class="n">version_string</span> <span class="o">=</span> <span class="n">version_string</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">lstrip</span><span class="p">(</span><span class="s2">&quot;v&quot;</span><span class="p">)</span>

            <span class="c1"># Regex pattern for semantic version per semver.org spec</span>
            <span class="c1"># Captures: major.minor.patch[-prerelease][+build]</span>
            <span class="n">pattern</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;^(\d+)\.(\d+)\.(\d+)(?:-([a-zA-Z0-9\-\.]+))?(?:\+([a-zA-Z0-9\-\.]+))?$&quot;</span>
            <span class="n">match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span> <span class="n">version_string</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">match</span><span class="p">:</span>
                <span class="n">major</span><span class="p">,</span> <span class="n">minor</span><span class="p">,</span> <span class="n">patch</span><span class="p">,</span> <span class="n">prerelease</span><span class="p">,</span> <span class="n">build</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="n">groups</span><span class="p">()</span>

                <span class="k">return</span> <span class="n">SemanticVersion</span><span class="p">(</span>
                    <span class="n">major</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">major</span><span class="p">),</span>
                    <span class="n">minor</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">minor</span><span class="p">),</span>
                    <span class="n">patch</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">patch</span><span class="p">),</span>
                    <span class="n">prerelease</span><span class="o">=</span><span class="n">prerelease</span><span class="p">,</span>
                    <span class="n">build</span><span class="o">=</span><span class="n">build</span><span class="p">,</span>
                <span class="p">)</span>

            <span class="k">return</span> <span class="kc">None</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error parsing version &#39;</span><span class="si">{</span><span class="n">version_string</span><span class="si">}</span><span class="s2">&#39;: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span></div>


<div class="viewcode-block" id="SemanticVersionManager.get_current_version">
<a class="viewcode-back" href="../../../../claude_mpm.services.version_control.semantic_versioning.html#claude_mpm.services.version_control.SemanticVersionManager.get_current_version">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_current_version</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">SemanticVersion</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the current version from multiple sources with intelligent fallback.</span>
<span class="sd">        </span>
<span class="sd">        Uses the enhanced version parser to check:</span>
<span class="sd">        1. Git tags (most recent)</span>
<span class="sd">        2. VERSION file</span>
<span class="sd">        3. package.json</span>
<span class="sd">        4. pyproject.toml</span>
<span class="sd">        5. Other configured version files</span>

<span class="sd">        Returns:</span>
<span class="sd">            Current SemanticVersion or None if not found</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Import here to avoid circular dependency</span>
            <span class="kn">from</span><span class="w"> </span><span class="nn">claude_mpm.services.version_control.version_parser</span><span class="w"> </span><span class="kn">import</span> <span class="n">get_version_parser</span>
            
            <span class="c1"># Use enhanced parser for current version</span>
            <span class="n">parser</span> <span class="o">=</span> <span class="n">get_version_parser</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project_root</span><span class="p">)</span>
            <span class="n">version_meta</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">get_current_version</span><span class="p">()</span>
            
            <span class="k">if</span> <span class="n">version_meta</span><span class="p">:</span>
                <span class="n">version</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse_version</span><span class="p">(</span><span class="n">version_meta</span><span class="o">.</span><span class="n">version</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">version</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Found version </span><span class="si">{</span><span class="n">version</span><span class="si">}</span><span class="s2"> from </span><span class="si">{</span><span class="n">version_meta</span><span class="o">.</span><span class="n">source</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="c1"># Optionally attach metadata</span>
                    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">version</span><span class="p">,</span> <span class="s1">&#39;__dict__&#39;</span><span class="p">):</span>
                        <span class="n">version</span><span class="o">.</span><span class="n">source</span> <span class="o">=</span> <span class="n">version_meta</span><span class="o">.</span><span class="n">source</span>
                    <span class="k">return</span> <span class="n">version</span>
                
        <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
            <span class="c1"># Fallback to original implementation</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Enhanced version parser not available, using fallback&quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error getting current version with enhanced parser: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        
        <span class="c1"># Fallback to original implementation</span>
        <span class="k">for</span> <span class="n">filename</span><span class="p">,</span> <span class="n">parser</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">version_files</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">file_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">project_root</span> <span class="o">/</span> <span class="n">filename</span>

            <span class="k">if</span> <span class="n">file_path</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">version_string</span> <span class="o">=</span> <span class="n">parser</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">version_string</span><span class="p">:</span>
                        <span class="n">version</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse_version</span><span class="p">(</span><span class="n">version_string</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">version</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Found version </span><span class="si">{</span><span class="n">version</span><span class="si">}</span><span class="s2"> in </span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                            <span class="k">return</span> <span class="n">version</span>
                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error parsing version from </span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="k">continue</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;No version found in project files&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span></div>


    <span class="k">def</span><span class="w"> </span><span class="nf">_parse_package_json_version</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_path</span><span class="p">:</span> <span class="n">Path</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Parse version from package.json.&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config_mgr</span><span class="o">.</span><span class="n">load_json</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;version&quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_parse_pyproject_toml_version</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_path</span><span class="p">:</span> <span class="n">Path</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Parse version from pyproject.toml.&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="kn">import</span><span class="w"> </span><span class="nn">tomllib</span>
        <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="kn">import</span><span class="w"> </span><span class="nn">tomli</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">tomllib</span>
            <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
                <span class="c1"># Fallback to simple regex parsing</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_toml_version_regex</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">data</span> <span class="o">=</span> <span class="n">tomllib</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>

            <span class="c1"># Try different locations for version</span>
            <span class="k">if</span> <span class="s2">&quot;project&quot;</span> <span class="ow">in</span> <span class="n">data</span> <span class="ow">and</span> <span class="s2">&quot;version&quot;</span> <span class="ow">in</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;project&quot;</span><span class="p">]:</span>
                <span class="k">return</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;project&quot;</span><span class="p">][</span><span class="s2">&quot;version&quot;</span><span class="p">]</span>
            <span class="k">elif</span> <span class="p">(</span>
                <span class="s2">&quot;tool&quot;</span> <span class="ow">in</span> <span class="n">data</span> <span class="ow">and</span> <span class="s2">&quot;poetry&quot;</span> <span class="ow">in</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;tool&quot;</span><span class="p">]</span> <span class="ow">and</span> <span class="s2">&quot;version&quot;</span> <span class="ow">in</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;tool&quot;</span><span class="p">][</span><span class="s2">&quot;poetry&quot;</span><span class="p">]</span>
            <span class="p">):</span>
                <span class="k">return</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;tool&quot;</span><span class="p">][</span><span class="s2">&quot;poetry&quot;</span><span class="p">][</span><span class="s2">&quot;version&quot;</span><span class="p">]</span>

            <span class="k">return</span> <span class="kc">None</span>

        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_toml_version_regex</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_parse_toml_version_regex</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_path</span><span class="p">:</span> <span class="n">Path</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Parse version from TOML file using regex.&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">content</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>

            <span class="c1"># Look for version = &quot;x.y.z&quot; pattern</span>
            <span class="n">patterns</span> <span class="o">=</span> <span class="p">[</span><span class="sa">r</span><span class="s1">&#39;version\s*=\s*[&quot;</span><span class="se">\&#39;</span><span class="s1">]([^&quot;</span><span class="se">\&#39;</span><span class="s1">]+)[&quot;</span><span class="se">\&#39;</span><span class="s1">]&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;version:\s*[&quot;</span><span class="se">\&#39;</span><span class="s1">]([^&quot;</span><span class="se">\&#39;</span><span class="s1">]+)[&quot;</span><span class="se">\&#39;</span><span class="s1">]&#39;</span><span class="p">]</span>

            <span class="k">for</span> <span class="n">pattern</span> <span class="ow">in</span> <span class="n">patterns</span><span class="p">:</span>
                <span class="n">match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span> <span class="n">content</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">match</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

            <span class="k">return</span> <span class="kc">None</span>

        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_parse_cargo_toml_version</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_path</span><span class="p">:</span> <span class="n">Path</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Parse version from Cargo.toml.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_toml_version_regex</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_parse_version_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_path</span><span class="p">:</span> <span class="n">Path</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Parse version from simple version file.&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_parse_pom_xml_version</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_path</span><span class="p">:</span> <span class="n">Path</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Parse version from Maven pom.xml.&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">content</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>

            <span class="c1"># Simple regex to find version in pom.xml</span>
            <span class="n">pattern</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;&lt;version&gt;([^&lt;]+)&lt;/version&gt;&quot;</span>
            <span class="n">match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span> <span class="n">content</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">match</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

            <span class="k">return</span> <span class="kc">None</span>

        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>

<div class="viewcode-block" id="SemanticVersionManager.analyze_changes">
<a class="viewcode-back" href="../../../../claude_mpm.services.version_control.semantic_versioning.html#claude_mpm.services.version_control.SemanticVersionManager.analyze_changes">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">analyze_changes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">changes</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">ChangeAnalysis</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Analyze changes to suggest version bump type.</span>

<span class="sd">        Change Analysis Process:</span>
<span class="sd">        1. Scan each change description for patterns</span>
<span class="sd">        2. Categorize changes (breaking, feature, fix)</span>
<span class="sd">        3. Determine highest priority change type</span>
<span class="sd">        4. Suggest appropriate version bump</span>
<span class="sd">        5. Calculate confidence score</span>
<span class="sd">        </span>
<span class="sd">        Pattern Matching:</span>
<span class="sd">        - Breaking: &quot;breaking&quot;, &quot;breaking change&quot;, &quot;remove api&quot;, etc.</span>
<span class="sd">        - Features: &quot;add&quot;, &quot;new feature&quot;, &quot;implement&quot;, &quot;enhance&quot;</span>
<span class="sd">        - Fixes: &quot;fix&quot;, &quot;bug fix&quot;, &quot;resolve&quot;, &quot;correct&quot;</span>
<span class="sd">        </span>
<span class="sd">        Version Bump Priority:</span>
<span class="sd">        1. Breaking changes -&gt; MAJOR (highest priority)</span>
<span class="sd">        2. New features -&gt; MINOR</span>
<span class="sd">        3. Bug fixes -&gt; PATCH</span>
<span class="sd">        4. Other changes -&gt; PATCH (default)</span>
<span class="sd">        </span>
<span class="sd">        Confidence Scoring:</span>
<span class="sd">        - 0.9: Clear breaking changes detected</span>
<span class="sd">        - 0.8: Clear new features detected</span>
<span class="sd">        - 0.7: Clear bug fixes detected</span>
<span class="sd">        - 0.5: No clear patterns (default to patch)</span>
<span class="sd">        </span>
<span class="sd">        This analysis is used for:</span>
<span class="sd">        - Conventional commit integration</span>
<span class="sd">        - Automated version bumping</span>
<span class="sd">        - Release note generation</span>
<span class="sd">        - Agent version updates</span>

<span class="sd">        Args:</span>
<span class="sd">            changes: List of change descriptions (e.g., commit messages)</span>

<span class="sd">        Returns:</span>
<span class="sd">            ChangeAnalysis with suggested version bump and confidence</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">analysis</span> <span class="o">=</span> <span class="n">ChangeAnalysis</span><span class="p">()</span>
        <span class="n">analysis</span><span class="o">.</span><span class="n">change_descriptions</span> <span class="o">=</span> <span class="n">changes</span>

        <span class="c1"># Analyze each change against defined patterns</span>
        <span class="k">for</span> <span class="n">change</span> <span class="ow">in</span> <span class="n">changes</span><span class="p">:</span>
            <span class="n">change_lower</span> <span class="o">=</span> <span class="n">change</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>

            <span class="c1"># Check for breaking changes (highest priority)</span>
            <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span> <span class="n">change_lower</span><span class="p">)</span> <span class="k">for</span> <span class="n">pattern</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">breaking_change_patterns</span><span class="p">):</span>
                <span class="n">analysis</span><span class="o">.</span><span class="n">has_breaking_changes</span> <span class="o">=</span> <span class="kc">True</span>

            <span class="c1"># Check for new features</span>
            <span class="k">elif</span> <span class="nb">any</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span> <span class="n">change_lower</span><span class="p">)</span> <span class="k">for</span> <span class="n">pattern</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">feature_patterns</span><span class="p">):</span>
                <span class="n">analysis</span><span class="o">.</span><span class="n">has_new_features</span> <span class="o">=</span> <span class="kc">True</span>

            <span class="c1"># Check for bug fixes</span>
            <span class="k">elif</span> <span class="nb">any</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span> <span class="n">change_lower</span><span class="p">)</span> <span class="k">for</span> <span class="n">pattern</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">bug_fix_patterns</span><span class="p">):</span>
                <span class="n">analysis</span><span class="o">.</span><span class="n">has_bug_fixes</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="c1"># Determine suggested bump based on priority</span>
        <span class="k">if</span> <span class="n">analysis</span><span class="o">.</span><span class="n">has_breaking_changes</span><span class="p">:</span>
            <span class="n">analysis</span><span class="o">.</span><span class="n">suggested_bump</span> <span class="o">=</span> <span class="n">VersionBumpType</span><span class="o">.</span><span class="n">MAJOR</span>
            <span class="n">analysis</span><span class="o">.</span><span class="n">confidence</span> <span class="o">=</span> <span class="mf">0.9</span>  <span class="c1"># High confidence for breaking changes</span>
        <span class="k">elif</span> <span class="n">analysis</span><span class="o">.</span><span class="n">has_new_features</span><span class="p">:</span>
            <span class="n">analysis</span><span class="o">.</span><span class="n">suggested_bump</span> <span class="o">=</span> <span class="n">VersionBumpType</span><span class="o">.</span><span class="n">MINOR</span>
            <span class="n">analysis</span><span class="o">.</span><span class="n">confidence</span> <span class="o">=</span> <span class="mf">0.8</span>  <span class="c1"># Good confidence for features</span>
        <span class="k">elif</span> <span class="n">analysis</span><span class="o">.</span><span class="n">has_bug_fixes</span><span class="p">:</span>
            <span class="n">analysis</span><span class="o">.</span><span class="n">suggested_bump</span> <span class="o">=</span> <span class="n">VersionBumpType</span><span class="o">.</span><span class="n">PATCH</span>
            <span class="n">analysis</span><span class="o">.</span><span class="n">confidence</span> <span class="o">=</span> <span class="mf">0.7</span>  <span class="c1"># Moderate confidence for fixes</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">analysis</span><span class="o">.</span><span class="n">suggested_bump</span> <span class="o">=</span> <span class="n">VersionBumpType</span><span class="o">.</span><span class="n">PATCH</span>
            <span class="n">analysis</span><span class="o">.</span><span class="n">confidence</span> <span class="o">=</span> <span class="mf">0.5</span>  <span class="c1"># Low confidence, default to safe patch</span>

        <span class="k">return</span> <span class="n">analysis</span></div>


<div class="viewcode-block" id="SemanticVersionManager.bump_version">
<a class="viewcode-back" href="../../../../claude_mpm.services.version_control.semantic_versioning.html#claude_mpm.services.version_control.SemanticVersionManager.bump_version">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">bump_version</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">current_version</span><span class="p">:</span> <span class="n">SemanticVersion</span><span class="p">,</span> <span class="n">bump_type</span><span class="p">:</span> <span class="n">VersionBumpType</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">SemanticVersion</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Bump version according to semantic versioning rules.</span>

<span class="sd">        Args:</span>
<span class="sd">            current_version: Current version</span>
<span class="sd">            bump_type: Type of bump to apply</span>

<span class="sd">        Returns:</span>
<span class="sd">            New version</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">current_version</span><span class="o">.</span><span class="n">bump</span><span class="p">(</span><span class="n">bump_type</span><span class="p">)</span></div>


<div class="viewcode-block" id="SemanticVersionManager.suggest_version_bump">
<a class="viewcode-back" href="../../../../claude_mpm.services.version_control.semantic_versioning.html#claude_mpm.services.version_control.SemanticVersionManager.suggest_version_bump">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">suggest_version_bump</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">commit_messages</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">VersionBumpType</span><span class="p">,</span> <span class="nb">float</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Suggest version bump based on commit messages.</span>

<span class="sd">        Args:</span>
<span class="sd">            commit_messages: List of commit messages since last version</span>

<span class="sd">        Returns:</span>
<span class="sd">            Tuple of (suggested_bump_type, confidence_score)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">analysis</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">analyze_changes</span><span class="p">(</span><span class="n">commit_messages</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">analysis</span><span class="o">.</span><span class="n">suggested_bump</span><span class="p">,</span> <span class="n">analysis</span><span class="o">.</span><span class="n">confidence</span></div>


<div class="viewcode-block" id="SemanticVersionManager.update_version_files">
<a class="viewcode-back" href="../../../../claude_mpm.services.version_control.semantic_versioning.html#claude_mpm.services.version_control.SemanticVersionManager.update_version_files">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">update_version_files</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">new_version</span><span class="p">:</span> <span class="n">SemanticVersion</span><span class="p">,</span> <span class="n">files_to_update</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">bool</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Update version in project files.</span>

<span class="sd">        Args:</span>
<span class="sd">            new_version: New version to set</span>
<span class="sd">            files_to_update: Specific files to update (defaults to all found)</span>

<span class="sd">        Returns:</span>
<span class="sd">            Dictionary mapping filenames to success status</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">results</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">version_string</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">new_version</span><span class="p">)</span>

        <span class="n">files_to_check</span> <span class="o">=</span> <span class="n">files_to_update</span> <span class="ow">or</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">version_files</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

        <span class="k">for</span> <span class="n">filename</span> <span class="ow">in</span> <span class="n">files_to_check</span><span class="p">:</span>
            <span class="n">file_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">project_root</span> <span class="o">/</span> <span class="n">filename</span>

            <span class="k">if</span> <span class="n">file_path</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">success</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_update_version_file</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="n">version_string</span><span class="p">)</span>
                    <span class="n">results</span><span class="p">[</span><span class="n">filename</span><span class="p">]</span> <span class="o">=</span> <span class="n">success</span>

                    <span class="k">if</span> <span class="n">success</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Updated version to </span><span class="si">{</span><span class="n">version_string</span><span class="si">}</span><span class="s2"> in </span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to update version in </span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error updating version in </span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="n">results</span><span class="p">[</span><span class="n">filename</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="k">return</span> <span class="n">results</span></div>


    <span class="k">def</span><span class="w"> </span><span class="nf">_update_version_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_path</span><span class="p">:</span> <span class="n">Path</span><span class="p">,</span> <span class="n">new_version</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Update version in a specific file.&quot;&quot;&quot;</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="n">file_path</span><span class="o">.</span><span class="n">name</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">filename</span> <span class="o">==</span> <span class="s2">&quot;package.json&quot;</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_update_package_json_version</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="n">new_version</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">filename</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;pyproject.toml&quot;</span><span class="p">,</span> <span class="s2">&quot;Cargo.toml&quot;</span><span class="p">]:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_update_toml_version</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="n">new_version</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">filename</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;VERSION&quot;</span><span class="p">,</span> <span class="s2">&quot;version.txt&quot;</span><span class="p">]:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_update_simple_version_file</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="n">new_version</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">filename</span> <span class="o">==</span> <span class="s2">&quot;pom.xml&quot;</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_update_pom_xml_version</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="n">new_version</span><span class="p">)</span>

            <span class="k">return</span> <span class="kc">False</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error updating </span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">False</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_update_package_json_version</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_path</span><span class="p">:</span> <span class="n">Path</span><span class="p">,</span> <span class="n">new_version</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Update version in package.json.&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config_mgr</span><span class="o">.</span><span class="n">load_json</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
            <span class="n">data</span><span class="p">[</span><span class="s2">&quot;version&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_version</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">config_mgr</span><span class="o">.</span><span class="n">save_json</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">file_path</span><span class="p">)</span>

            <span class="k">return</span> <span class="kc">True</span>

        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_update_toml_version</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_path</span><span class="p">:</span> <span class="n">Path</span><span class="p">,</span> <span class="n">new_version</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Update version in TOML file.&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">content</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>

            <span class="c1"># Replace version field</span>
            <span class="n">patterns</span> <span class="o">=</span> <span class="p">[</span>
                <span class="p">(</span><span class="sa">r</span><span class="s1">&#39;(version\s*=\s*)[&quot;</span><span class="se">\&#39;</span><span class="s1">]([^&quot;</span><span class="se">\&#39;</span><span class="s1">]+)[&quot;</span><span class="se">\&#39;</span><span class="s1">]&#39;</span><span class="p">,</span> <span class="sa">rf</span><span class="s1">&#39;\g&lt;1&gt;&quot;</span><span class="si">{</span><span class="n">new_version</span><span class="si">}</span><span class="s1">&quot;&#39;</span><span class="p">),</span>
                <span class="p">(</span><span class="sa">r</span><span class="s1">&#39;(version:\s*)[&quot;</span><span class="se">\&#39;</span><span class="s1">]([^&quot;</span><span class="se">\&#39;</span><span class="s1">]+)[&quot;</span><span class="se">\&#39;</span><span class="s1">]&#39;</span><span class="p">,</span> <span class="sa">rf</span><span class="s1">&#39;\g&lt;1&gt;&quot;</span><span class="si">{</span><span class="n">new_version</span><span class="si">}</span><span class="s1">&quot;&#39;</span><span class="p">),</span>
            <span class="p">]</span>

            <span class="n">updated</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">for</span> <span class="n">pattern</span><span class="p">,</span> <span class="n">replacement</span> <span class="ow">in</span> <span class="n">patterns</span><span class="p">:</span>
                <span class="n">new_content</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span> <span class="n">replacement</span><span class="p">,</span> <span class="n">content</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">new_content</span> <span class="o">!=</span> <span class="n">content</span><span class="p">:</span>
                    <span class="n">content</span> <span class="o">=</span> <span class="n">new_content</span>
                    <span class="n">updated</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="k">break</span>

            <span class="k">if</span> <span class="n">updated</span><span class="p">:</span>
                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">content</span><span class="p">)</span>
                <span class="k">return</span> <span class="kc">True</span>

            <span class="k">return</span> <span class="kc">False</span>

        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_update_simple_version_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_path</span><span class="p">:</span> <span class="n">Path</span><span class="p">,</span> <span class="n">new_version</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Update version in simple version file.&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">new_version</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_update_pom_xml_version</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_path</span><span class="p">:</span> <span class="n">Path</span><span class="p">,</span> <span class="n">new_version</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Update version in Maven pom.xml.&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">content</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>

            <span class="c1"># Replace first version tag (project version)</span>
            <span class="n">pattern</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;(&lt;version&gt;)[^&lt;]+(&lt;/version&gt;)&quot;</span>
            <span class="n">replacement</span> <span class="o">=</span> <span class="sa">rf</span><span class="s2">&quot;\g&lt;1&gt;</span><span class="si">{</span><span class="n">new_version</span><span class="si">}</span><span class="s2">\g&lt;2&gt;&quot;</span>

            <span class="n">new_content</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span> <span class="n">replacement</span><span class="p">,</span> <span class="n">content</span><span class="p">,</span> <span class="n">count</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">new_content</span> <span class="o">!=</span> <span class="n">content</span><span class="p">:</span>
                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">new_content</span><span class="p">)</span>
                <span class="k">return</span> <span class="kc">True</span>

            <span class="k">return</span> <span class="kc">False</span>

        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>

<div class="viewcode-block" id="SemanticVersionManager.generate_changelog_entry">
<a class="viewcode-back" href="../../../../claude_mpm.services.version_control.semantic_versioning.html#claude_mpm.services.version_control.SemanticVersionManager.generate_changelog_entry">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">generate_changelog_entry</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">version</span><span class="p">:</span> <span class="n">SemanticVersion</span><span class="p">,</span>
        <span class="n">changes</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
        <span class="n">metadata</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">VersionMetadata</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generate changelog entry for a version.</span>

<span class="sd">        Args:</span>
<span class="sd">            version: Version for the changelog entry</span>
<span class="sd">            changes: List of changes</span>
<span class="sd">            metadata: Optional version metadata</span>

<span class="sd">        Returns:</span>
<span class="sd">            Formatted changelog entry</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">date_str</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">metadata</span> <span class="ow">and</span> <span class="n">metadata</span><span class="o">.</span><span class="n">release_date</span><span class="p">:</span>
            <span class="n">date_str</span> <span class="o">=</span> <span class="n">metadata</span><span class="o">.</span><span class="n">release_date</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># Build changelog entry</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;## [</span><span class="si">{</span><span class="n">version</span><span class="si">}</span><span class="s2">] - </span><span class="si">{</span><span class="n">date_str</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">]</span>

        <span class="c1"># Categorize changes</span>
        <span class="n">breaking_changes</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">features</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">fixes</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">other_changes</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">change</span> <span class="ow">in</span> <span class="n">changes</span><span class="p">:</span>
            <span class="n">change_lower</span> <span class="o">=</span> <span class="n">change</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>

            <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span> <span class="n">change_lower</span><span class="p">)</span> <span class="k">for</span> <span class="n">pattern</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">breaking_change_patterns</span><span class="p">):</span>
                <span class="n">breaking_changes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">change</span><span class="p">)</span>
            <span class="k">elif</span> <span class="nb">any</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span> <span class="n">change_lower</span><span class="p">)</span> <span class="k">for</span> <span class="n">pattern</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">feature_patterns</span><span class="p">):</span>
                <span class="n">features</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">change</span><span class="p">)</span>
            <span class="k">elif</span> <span class="nb">any</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span> <span class="n">change_lower</span><span class="p">)</span> <span class="k">for</span> <span class="n">pattern</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">bug_fix_patterns</span><span class="p">):</span>
                <span class="n">fixes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">change</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">other_changes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">change</span><span class="p">)</span>

        <span class="c1"># Add sections</span>
        <span class="k">if</span> <span class="n">breaking_changes</span><span class="p">:</span>
            <span class="n">lines</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="s2">&quot;### ⚠ BREAKING CHANGES&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">])</span>
            <span class="k">for</span> <span class="n">change</span> <span class="ow">in</span> <span class="n">breaking_changes</span><span class="p">:</span>
                <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;- </span><span class="si">{</span><span class="n">change</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">features</span><span class="p">:</span>
            <span class="n">lines</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="s2">&quot;### ✨ Features&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">])</span>
            <span class="k">for</span> <span class="n">change</span> <span class="ow">in</span> <span class="n">features</span><span class="p">:</span>
                <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;- </span><span class="si">{</span><span class="n">change</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">fixes</span><span class="p">:</span>
            <span class="n">lines</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="s2">&quot;### 🐛 Bug Fixes&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">])</span>
            <span class="k">for</span> <span class="n">change</span> <span class="ow">in</span> <span class="n">fixes</span><span class="p">:</span>
                <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;- </span><span class="si">{</span><span class="n">change</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">other_changes</span><span class="p">:</span>
            <span class="n">lines</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="s2">&quot;### 📝 Other Changes&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">])</span>
            <span class="k">for</span> <span class="n">change</span> <span class="ow">in</span> <span class="n">other_changes</span><span class="p">:</span>
                <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;- </span><span class="si">{</span><span class="n">change</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>

        <span class="c1"># Add metadata</span>
        <span class="k">if</span> <span class="n">metadata</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">metadata</span><span class="o">.</span><span class="n">commit_hash</span><span class="p">:</span>
                <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;**Commit:** </span><span class="si">{</span><span class="n">metadata</span><span class="o">.</span><span class="n">commit_hash</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">metadata</span><span class="o">.</span><span class="n">contributors</span><span class="p">:</span>
                <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;**Contributors:** </span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">metadata</span><span class="o">.</span><span class="n">contributors</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">metadata</span><span class="o">.</span><span class="n">notes</span><span class="p">:</span>
                <span class="n">lines</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">metadata</span><span class="o">.</span><span class="n">notes</span><span class="p">])</span>

        <span class="k">return</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span></div>


<div class="viewcode-block" id="SemanticVersionManager.update_changelog">
<a class="viewcode-back" href="../../../../claude_mpm.services.version_control.semantic_versioning.html#claude_mpm.services.version_control.SemanticVersionManager.update_changelog">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">update_changelog</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">version</span><span class="p">:</span> <span class="n">SemanticVersion</span><span class="p">,</span> <span class="n">changes</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">changelog_file</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;docs/CHANGELOG.md&quot;</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Update CHANGELOG.md with new version entry.</span>

<span class="sd">        Args:</span>
<span class="sd">            version: Version for the changelog entry</span>
<span class="sd">            changes: List of changes</span>
<span class="sd">            changelog_file: Changelog file name</span>

<span class="sd">        Returns:</span>
<span class="sd">            True if update was successful</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">changelog_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">project_root</span> <span class="o">/</span> <span class="n">changelog_file</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Generate new entry</span>
            <span class="n">new_entry</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">generate_changelog_entry</span><span class="p">(</span><span class="n">version</span><span class="p">,</span> <span class="n">changes</span><span class="p">)</span>

            <span class="c1"># Read existing changelog or create new one</span>
            <span class="k">if</span> <span class="n">changelog_path</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">changelog_path</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                    <span class="n">existing_content</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>

                <span class="c1"># Insert new entry after title</span>
                <span class="n">lines</span> <span class="o">=</span> <span class="n">existing_content</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">insert_index</span> <span class="o">=</span> <span class="mi">0</span>

                <span class="c1"># Find insertion point (after # Changelog title)</span>
                <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">lines</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;# &quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;## [Unreleased]&quot;</span><span class="p">):</span>
                        <span class="n">insert_index</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span>
                        <span class="k">break</span>

                <span class="c1"># Insert new entry</span>
                <span class="n">lines</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">insert_index</span><span class="p">,</span> <span class="n">new_entry</span><span class="p">)</span>
                <span class="n">lines</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">insert_index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>

                <span class="n">content</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># Create new changelog</span>
                <span class="n">content</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;# Changelog</span><span class="se">\n\n</span><span class="si">{</span><span class="n">new_entry</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>

            <span class="c1"># Write updated changelog</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">changelog_path</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">content</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Updated </span><span class="si">{</span><span class="n">changelog_file</span><span class="si">}</span><span class="s2"> with version </span><span class="si">{</span><span class="n">version</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">True</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error updating changelog: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">False</span></div>


<div class="viewcode-block" id="SemanticVersionManager.get_version_history">
<a class="viewcode-back" href="../../../../claude_mpm.services.version_control.semantic_versioning.html#claude_mpm.services.version_control.SemanticVersionManager.get_version_history">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_version_history</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">SemanticVersion</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get version history from multiple sources with intelligent fallback.</span>
<span class="sd">        </span>
<span class="sd">        Uses the enhanced version parser to retrieve version history from:</span>
<span class="sd">        1. Git tags (primary source)</span>
<span class="sd">        2. CHANGELOG.md (fallback)</span>
<span class="sd">        3. VERSION files (current version only)</span>

<span class="sd">        Returns:</span>
<span class="sd">            List of versions in descending order</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Import here to avoid circular dependency</span>
            <span class="kn">from</span><span class="w"> </span><span class="nn">claude_mpm.services.version_control.version_parser</span><span class="w"> </span><span class="kn">import</span> <span class="n">get_version_parser</span>
            
            <span class="c1"># Use enhanced parser for comprehensive version history</span>
            <span class="n">parser</span> <span class="o">=</span> <span class="n">get_version_parser</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project_root</span><span class="p">)</span>
            <span class="n">version_metadata</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">get_version_history</span><span class="p">(</span><span class="n">include_prereleases</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            
            <span class="c1"># Convert to SemanticVersion objects</span>
            <span class="n">versions</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">meta</span> <span class="ow">in</span> <span class="n">version_metadata</span><span class="p">:</span>
                <span class="n">version</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse_version</span><span class="p">(</span><span class="n">meta</span><span class="o">.</span><span class="n">version</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">version</span><span class="p">:</span>
                    <span class="c1"># Optionally attach metadata to version</span>
                    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">version</span><span class="p">,</span> <span class="s1">&#39;__dict__&#39;</span><span class="p">):</span>
                        <span class="n">version</span><span class="o">.</span><span class="n">source</span> <span class="o">=</span> <span class="n">meta</span><span class="o">.</span><span class="n">source</span>
                        <span class="n">version</span><span class="o">.</span><span class="n">release_date</span> <span class="o">=</span> <span class="n">meta</span><span class="o">.</span><span class="n">release_date</span>
                        <span class="n">version</span><span class="o">.</span><span class="n">commit_hash</span> <span class="o">=</span> <span class="n">meta</span><span class="o">.</span><span class="n">commit_hash</span>
                    <span class="n">versions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">version</span><span class="p">)</span>
            
            <span class="k">return</span> <span class="n">versions</span>
            
        <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
            <span class="c1"># Fallback to original implementation if enhanced parser not available</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Enhanced version parser not available, falling back to changelog parsing&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_changelog_versions_fallback</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error getting version history: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="c1"># Fallback to original implementation</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_changelog_versions_fallback</span><span class="p">()</span></div>


    <span class="k">def</span><span class="w"> </span><span class="nf">_parse_changelog_versions_fallback</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">SemanticVersion</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Fallback method: Parse versions from changelog file only.&quot;&quot;&quot;</span>
        <span class="n">versions</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># Try to get versions from changelog</span>
        <span class="n">changelog_paths</span> <span class="o">=</span> <span class="p">[</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">project_root</span> <span class="o">/</span> <span class="s2">&quot;CHANGELOG.md&quot;</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">project_root</span> <span class="o">/</span> <span class="s2">&quot;docs&quot;</span> <span class="o">/</span> <span class="s2">&quot;CHANGELOG.md&quot;</span>
        <span class="p">]</span>
        
        <span class="k">for</span> <span class="n">changelog_path</span> <span class="ow">in</span> <span class="n">changelog_paths</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">changelog_path</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
                <span class="n">versions</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_parse_changelog_versions</span><span class="p">(</span><span class="n">changelog_path</span><span class="p">))</span>
                <span class="k">break</span>

        <span class="c1"># Sort versions in descending order</span>
        <span class="n">versions</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">versions</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_parse_changelog_versions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">changelog_path</span><span class="p">:</span> <span class="n">Path</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">SemanticVersion</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Parse versions from changelog file.&quot;&quot;&quot;</span>
        <span class="n">versions</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">changelog_path</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">content</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>

            <span class="c1"># Find version entries</span>
            <span class="n">pattern</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;##\s*\[([^\]]+)\]&quot;</span>
            <span class="n">matches</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span> <span class="n">content</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">match</span> <span class="ow">in</span> <span class="n">matches</span><span class="p">:</span>
                <span class="n">version</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse_version</span><span class="p">(</span><span class="n">match</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">version</span><span class="p">:</span>
                    <span class="n">versions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">version</span><span class="p">)</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error parsing changelog versions: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">versions</span></div>

</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025, Claude MPM Team.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>