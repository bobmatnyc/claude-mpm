{"version":3,"file":"session-manager.js","sources":["../../js/components/session-manager.js"],"sourcesContent":["/**\n * Session Manager Component\n * Handles session selection and management\n */\n\nclass SessionManager {\n    constructor(socketClient) {\n        this.socketClient = socketClient;\n        this.sessions = new Map();\n        this.currentSessionId = null;\n        this.selectedSessionId = '';\n\n        this.init();\n    }\n\n    /**\n     * Initialize the session manager\n     */\n    init() {\n        this.setupEventHandlers();\n        this.setupSocketListeners();\n        this.updateSessionSelect();\n    }\n\n    /**\n     * Setup event handlers for UI controls\n     */\n    setupEventHandlers() {\n        // Session selection dropdown\n        const sessionSelect = document.getElementById('session-select');\n        if (sessionSelect) {\n            sessionSelect.addEventListener('change', (e) => {\n                this.selectedSessionId = e.target.value;\n                this.onSessionFilterChanged();\n\n                // Load working directory for this session\n                if (window.dashboard && window.dashboard.loadWorkingDirectoryForSession) {\n                    window.dashboard.loadWorkingDirectoryForSession(e.target.value);\n                }\n            });\n        }\n\n        // Refresh sessions button\n        const refreshBtn = document.querySelector('button[onclick=\"refreshSessions()\"]');\n        if (refreshBtn) {\n            refreshBtn.addEventListener('click', () => {\n                this.refreshSessions();\n            });\n        }\n    }\n\n    /**\n     * Setup socket event listeners\n     */\n    setupSocketListeners() {\n        // Listen for socket event updates\n        this.socketClient.onEventUpdate((events, sessions) => {\n            this.sessions = sessions;\n            this.updateSessionSelect();\n            // Update footer info when new events arrive\n            this.updateFooterInfo();\n        });\n\n        // Listen for connection status changes\n        document.addEventListener('socketConnectionStatus', (e) => {\n            if (e.detail.type === 'connected') {\n                // Request fresh session data when connected\n                setTimeout(() => this.refreshSessions(), 1000);\n            }\n        });\n    }\n\n    /**\n     * Update the session selection dropdown\n     */\n    updateSessionSelect() {\n        const sessionSelect = document.getElementById('session-select');\n        if (!sessionSelect) return;\n\n        // Store current selection\n        const currentSelection = sessionSelect.value;\n\n        // Clear existing options except default ones\n        sessionSelect.innerHTML = `\n            <option value=\"\">All Sessions</option>\n        `;\n\n        // Add sessions from the sessions map\n        if (this.sessions && this.sessions.size > 0) {\n            const sortedSessions = Array.from(this.sessions.values())\n                .sort((a, b) => new Date(b.lastActivity || b.startTime) - new Date(a.lastActivity || a.startTime));\n\n            sortedSessions.forEach(session => {\n                const option = document.createElement('option');\n                option.value = session.id;\n\n                // Format session display text\n                const startTime = new Date(session.startTime || session.last_activity).toLocaleString();\n                const eventCount = session.eventCount || session.event_count || 0;\n                const isActive = session.id === this.currentSessionId;\n\n                option.textContent = `${session.id.substring(0, 8)}... (${eventCount} events, ${startTime})${isActive ? ' [ACTIVE]' : ''}`;\n                sessionSelect.appendChild(option);\n            });\n        }\n\n        // Restore selection if it still exists\n        if (currentSelection && Array.from(sessionSelect.options).some(opt => opt.value === currentSelection)) {\n            sessionSelect.value = currentSelection;\n            this.selectedSessionId = currentSelection;\n            // Trigger events for restored selection\n            this.onSessionFilterChanged();\n        } else {\n            this.selectedSessionId = sessionSelect.value;\n            // Trigger events for new selection\n            if (this.selectedSessionId) {\n                this.onSessionFilterChanged();\n            }\n        }\n    }\n\n    /**\n     * Handle session filter change\n     */\n    onSessionFilterChanged() {\n        // Notify event viewer about filter change\n        const eventViewer = window.eventViewer;\n        if (eventViewer) {\n            eventViewer.setSessionFilter(this.selectedSessionId);\n        }\n\n        // Update footer information\n        this.updateFooterInfo();\n\n        // Dispatch custom event for other components\n        document.dispatchEvent(new CustomEvent('sessionFilterChanged', {\n            detail: { sessionId: this.selectedSessionId }\n        }));\n\n        // Also dispatch sessionChanged for backward compatibility with other components\n        document.dispatchEvent(new CustomEvent('sessionChanged', {\n            detail: { sessionId: this.selectedSessionId }\n        }));\n    }\n\n    /**\n     * Refresh sessions from server\n     */\n    refreshSessions() {\n        if (this.socketClient && this.socketClient.getConnectionState().isConnected) {\n            console.log('Refreshing sessions...');\n            this.socketClient.requestStatus();\n        } else {\n            console.warn('Cannot refresh sessions: not connected to server');\n        }\n    }\n\n    /**\n     * Update footer information based on selected session\n     */\n    updateFooterInfo() {\n        console.log('[SESSION-DEBUG] updateFooterInfo called, selectedSessionId:', this.selectedSessionId);\n\n        const footerSessionEl = document.getElementById('footer-session');\n        const footerWorkingDirEl = document.getElementById('footer-working-dir');\n        const footerGitBranchEl = document.getElementById('footer-git-branch');\n\n        if (!footerSessionEl) {\n            console.warn('[SESSION-DEBUG] footer-session element not found');\n            return;\n        }\n\n        let sessionInfo = 'All Sessions';\n        let workingDir = window.dashboard?.workingDirectoryManager?.getDefaultWorkingDir() || process?.cwd?.() || '/Users/masa/Projects/claude-mpm';\n        let gitBranch = 'Unknown';\n\n        console.log('[SESSION-DEBUG] Initial values - sessionInfo:', sessionInfo, 'workingDir:', workingDir, 'gitBranch:', gitBranch);\n\n        if (this.selectedSessionId === 'current') {\n            sessionInfo = this.currentSessionId ?\n                `Current: ${this.currentSessionId.substring(0, 8)}...` :\n                'Current: None';\n\n            // For current session, try to extract info from recent events\n            if (this.currentSessionId) {\n                const sessionData = this.extractSessionInfoFromEvents(this.currentSessionId);\n                workingDir = sessionData.workingDir || window.dashboard?.workingDirectoryManager?.getDefaultWorkingDir() || '/Users/masa/Projects/claude-mpm';\n                gitBranch = sessionData.gitBranch || 'Unknown';\n            }\n        } else if (this.selectedSessionId) {\n            const session = this.sessions.get(this.selectedSessionId);\n            if (session) {\n                sessionInfo = `${this.selectedSessionId.substring(0, 8)}...`;\n                workingDir = session.working_directory || session.workingDirectory || '';\n                gitBranch = session.git_branch || session.gitBranch || '';\n\n                // If session doesn't have these values, extract from events\n                if (!workingDir || !gitBranch) {\n                    const sessionData = this.extractSessionInfoFromEvents(this.selectedSessionId);\n                    workingDir = workingDir || sessionData.workingDir || '.';\n                    gitBranch = gitBranch || sessionData.gitBranch || '';\n                }\n            }\n        }\n\n        console.log('[SESSION-DEBUG] Final values before setting footer - sessionInfo:', sessionInfo, 'workingDir:', workingDir, 'gitBranch:', gitBranch);\n\n        footerSessionEl.textContent = sessionInfo;\n        if (footerWorkingDirEl) {\n            console.log('[SESSION-DEBUG] Setting footer working dir to:', workingDir);\n            footerWorkingDirEl.textContent = workingDir;\n        } else {\n            console.warn('[SESSION-DEBUG] footer-working-dir element not found');\n        }\n        if (footerGitBranchEl) {\n            console.log('[SESSION-DEBUG] Setting footer git branch to:', gitBranch);\n            footerGitBranchEl.textContent = gitBranch;\n        } else {\n            console.warn('[SESSION-DEBUG] footer-git-branch element not found');\n        }\n    }\n\n    /**\n     * Extract working directory and git branch from events for a specific session\n     * @param {string} sessionId - Session ID to extract info for\n     * @returns {Object} Object with workingDir and gitBranch properties\n     */\n    extractSessionInfoFromEvents(sessionId) {\n        let workingDir = '';\n        let gitBranch = '';\n\n        console.log(`[DEBUG] extractSessionInfoFromEvents called for sessionId: ${sessionId}`);\n\n        // Get events from the socket client\n        const socketClient = this.socketClient;\n        if (socketClient && socketClient.events) {\n            console.log(`[DEBUG] Total events available: ${socketClient.events.length}`);\n\n            // Look for session start events or recent events with this session ID\n            const sessionEvents = socketClient.events.filter(event =>\n                event.data && event.data.session_id === sessionId\n            );\n\n            console.log(`[DEBUG] Events matching sessionId ${sessionId}: ${sessionEvents.length}`);\n\n            // Log a few sample events to see their structure\n            if (sessionEvents.length > 0) {\n                console.log(`[DEBUG] Sample events for session ${sessionId}:`);\n\n                // Show first 3 events\n                sessionEvents.slice(0, 3).forEach((event, index) => {\n                    console.log(`[DEBUG] Event ${index + 1}:`, {\n                        type: event.type,\n                        timestamp: event.timestamp,\n                        data_keys: event.data ? Object.keys(event.data) : 'no data',\n                        full_event: event\n                    });\n                });\n\n                // Show last 3 events if different from first 3\n                if (sessionEvents.length > 3) {\n                    console.log(`[DEBUG] Last 3 events for session ${sessionId}:`);\n                    sessionEvents.slice(-3).forEach((event, index) => {\n                        console.log(`[DEBUG] Last Event ${index + 1}:`, {\n                            type: event.type,\n                            timestamp: event.timestamp,\n                            data_keys: event.data ? Object.keys(event.data) : 'no data',\n                            full_event: event\n                        });\n                    });\n                }\n            }\n\n            // Find the most recent event with working directory and git branch info\n            for (let i = sessionEvents.length - 1; i >= 0; i--) {\n                const event = sessionEvents[i];\n                if (event.data) {\n                    console.log(`[DEBUG] Examining event ${i} data:`, event.data);\n\n                    // Check for working directory info\n                    if (!workingDir) {\n                        if (event.data.working_directory) {\n                            workingDir = event.data.working_directory;\n                            console.log(`[DEBUG] Found working_directory: ${workingDir}`);\n                        } else if (event.data.cwd) {\n                            workingDir = event.data.cwd;\n                            console.log(`[DEBUG] Found cwd: ${workingDir}`);\n                        } else if (event.data.instance_info && event.data.instance_info.working_dir) {\n                            workingDir = event.data.instance_info.working_dir;\n                            console.log(`[DEBUG] Found instance_info.working_dir: ${workingDir}`);\n                        }\n                    }\n\n                    // Check for git branch info - check all possible field names\n                    if (!gitBranch) {\n                        const possibleBranchFields = [\n                            'git_branch',\n                            'gitBranch',\n                            'branch',\n                            'git.branch',\n                            'vcs_branch',\n                            'current_branch'\n                        ];\n\n                        for (const field of possibleBranchFields) {\n                            if (event.data[field]) {\n                                gitBranch = event.data[field];\n                                console.log(`[DEBUG] Found git branch in field '${field}': ${gitBranch}`);\n                                break;\n                            }\n                        }\n\n                        // Check nested locations\n                        if (!gitBranch) {\n                            if (event.data.instance_info) {\n                                console.log(`[DEBUG] Checking instance_info for branch:`, event.data.instance_info);\n                                for (const field of possibleBranchFields) {\n                                    if (event.data.instance_info[field]) {\n                                        gitBranch = event.data.instance_info[field];\n                                        console.log(`[DEBUG] Found git branch in instance_info.${field}: ${gitBranch}`);\n                                        break;\n                                    }\n                                }\n                            }\n\n                            if (!gitBranch && event.data.git) {\n                                console.log(`[DEBUG] Checking git object:`, event.data.git);\n                                if (event.data.git.branch) {\n                                    gitBranch = event.data.git.branch;\n                                    console.log(`[DEBUG] Found git branch in git.branch: ${gitBranch}`);\n                                }\n                            }\n                        }\n                    }\n\n                    // If we have both, we can stop looking\n                    if (workingDir && gitBranch) {\n                        console.log(`[DEBUG] Found both workingDir and gitBranch, stopping search`);\n                        break;\n                    }\n                }\n            }\n        } else {\n            console.log(`[DEBUG] No socket client or events available`);\n        }\n\n        console.log(`[DEBUG] Final results - workingDir: '${workingDir}', gitBranch: '${gitBranch}'`);\n        return { workingDir, gitBranch };\n    }\n\n    /**\n     * Set current session ID (from server status)\n     * @param {string} sessionId - Current session ID\n     */\n    setCurrentSessionId(sessionId) {\n        this.currentSessionId = sessionId;\n        this.updateSessionSelect();\n        this.updateFooterInfo();\n    }\n\n    /**\n     * Add or update a session\n     * @param {Object} sessionData - Session data\n     */\n    addSession(sessionData) {\n        if (!sessionData.id) return;\n\n        const existingSession = this.sessions.get(sessionData.id);\n        if (existingSession) {\n            // Update existing session\n            Object.assign(existingSession, sessionData);\n        } else {\n            // Add new session\n            this.sessions.set(sessionData.id, {\n                id: sessionData.id,\n                startTime: sessionData.startTime || sessionData.start_time || new Date().toISOString(),\n                lastActivity: sessionData.lastActivity || sessionData.last_activity || new Date().toISOString(),\n                eventCount: sessionData.eventCount || sessionData.event_count || 0,\n                working_directory: sessionData.working_directory || sessionData.workingDirectory || '',\n                git_branch: sessionData.git_branch || sessionData.gitBranch || '',\n                agent_type: sessionData.agent_type || sessionData.agentType || '',\n                ...sessionData\n            });\n        }\n\n        this.updateSessionSelect();\n    }\n\n    /**\n     * Remove a session\n     * @param {string} sessionId - Session ID to remove\n     */\n    removeSession(sessionId) {\n        if (this.sessions.has(sessionId)) {\n            this.sessions.delete(sessionId);\n\n            // If the removed session was selected, reset to all sessions\n            if (this.selectedSessionId === sessionId) {\n                this.selectedSessionId = '';\n                const sessionSelect = document.getElementById('session-select');\n                if (sessionSelect) {\n                    sessionSelect.value = '';\n                }\n                this.onSessionFilterChanged();\n            }\n\n            this.updateSessionSelect();\n        }\n    }\n\n    /**\n     * Get current session filter\n     * @returns {string} Current session filter\n     */\n    getCurrentFilter() {\n        return this.selectedSessionId;\n    }\n\n    /**\n     * Get session information\n     * @param {string} sessionId - Session ID\n     * @returns {Object|null} Session data or null if not found\n     */\n    getSession(sessionId) {\n        return this.sessions.get(sessionId) || null;\n    }\n\n    /**\n     * Get all sessions\n     * @returns {Map} All sessions\n     */\n    getAllSessions() {\n        return this.sessions;\n    }\n\n    /**\n     * Get current active session ID\n     * @returns {string|null} Current session ID\n     */\n    getCurrentSessionId() {\n        return this.currentSessionId;\n    }\n\n    /**\n     * Clear all sessions\n     */\n    clearSessions() {\n        this.sessions.clear();\n        this.currentSessionId = null;\n        this.selectedSessionId = '';\n        this.updateSessionSelect();\n        this.updateFooterInfo();\n    }\n\n    /**\n     * Export session data\n     * @returns {Object} Session export data\n     */\n    exportSessionData() {\n        return {\n            sessions: Array.from(this.sessions.entries()),\n            currentSessionId: this.currentSessionId,\n            selectedSessionId: this.selectedSessionId\n        };\n    }\n\n    /**\n     * Import session data\n     * @param {Object} data - Session import data\n     */\n    importSessionData(data) {\n        if (data.sessions && Array.isArray(data.sessions)) {\n            this.sessions.clear();\n            data.sessions.forEach(([id, sessionData]) => {\n                this.sessions.set(id, sessionData);\n            });\n        }\n\n        if (data.currentSessionId) {\n            this.currentSessionId = data.currentSessionId;\n        }\n\n        if (data.selectedSessionId !== undefined) {\n            this.selectedSessionId = data.selectedSessionId;\n        }\n\n        this.updateSessionSelect();\n        this.updateFooterInfo();\n    }\n\n    /**\n     * Get events for a specific session\n     * @param {string} sessionId - Session ID to get events for\n     * @returns {Array} - Filtered events for the session\n     */\n    getEventsForSession(sessionId) {\n        if (!sessionId || !this.socketClient) {\n            return [];\n        }\n\n        const allEvents = this.socketClient.events || [];\n        return allEvents.filter(event => {\n            // Check for session ID in various possible locations\n            const eventSessionId = event.session_id ||\n                                 (event.data && event.data.session_id) ||\n                                 null;\n            return eventSessionId === sessionId;\n        });\n    }\n}\n\n// Global functions for backward compatibility\nwindow.refreshSessions = function() {\n    if (window.sessionManager) {\n        window.sessionManager.refreshSessions();\n    }\n};\n\n// Export for global use\nwindow.SessionManager = SessionManager;\n// ES6 Module export\nexport { SessionManager };\nexport default SessionManager;\n"],"names":["SessionManager","constructor","socketClient","this","sessions","Map","currentSessionId","selectedSessionId","init","setupEventHandlers","setupSocketListeners","updateSessionSelect","sessionSelect","document","getElementById","addEventListener","e","target","value","onSessionFilterChanged","window","dashboard","loadWorkingDirectoryForSession","refreshBtn","querySelector","refreshSessions","onEventUpdate","events","updateFooterInfo","detail","type","setTimeout","currentSelection","innerHTML","size","Array","from","values","sort","a","b","Date","lastActivity","startTime","forEach","session","option","createElement","id","last_activity","toLocaleString","eventCount","event_count","isActive","textContent","substring","appendChild","options","some","opt","eventViewer","setSessionFilter","dispatchEvent","CustomEvent","sessionId","getConnectionState","isConnected","console","log","requestStatus","warn","footerSessionEl","footerWorkingDirEl","footerGitBranchEl","sessionInfo","workingDir","workingDirectoryManager","getDefaultWorkingDir","process","cwd","gitBranch","sessionData","extractSessionInfoFromEvents","get","working_directory","workingDirectory","git_branch","length","sessionEvents","filter","event","data","session_id","slice","index","timestamp","data_keys","Object","keys","full_event","i","instance_info","working_dir","possibleBranchFields","field","git","branch","setCurrentSessionId","addSession","existingSession","assign","set","start_time","toISOString","agent_type","agentType","removeSession","has","delete","getCurrentFilter","getSession","getAllSessions","getCurrentSessionId","clearSessions","clear","exportSessionData","entries","importSessionData","isArray","getEventsForSession","sessionManager"],"mappings":"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"}