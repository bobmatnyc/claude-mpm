{"version":3,"file":"module-viewer.js","sources":["../../js/components/module-viewer.js"],"sourcesContent":["/**\n * Module Viewer Component\n * Displays detailed information about selected events organized by class/type\n */\n\nclass ModuleViewer {\n    constructor(containerId) {\n        this.container = document.getElementById(containerId);\n        this.dataContainer = null;\n        this.jsonContainer = null;\n        this.currentEvent = null;\n        this.eventsByClass = new Map();\n\n        // Global JSON visibility state - persisted across all events\n        // When true, all events show JSON expanded; when false, all collapsed\n        this.globalJsonExpanded = localStorage.getItem('dashboard-json-expanded') === 'true';\n        \n        // Track if keyboard listener has been added to avoid duplicates\n        this.keyboardListenerAdded = false;\n\n        this.init();\n    }\n\n    /**\n     * Initialize the module viewer\n     */\n    init() {\n        this.setupContainers();\n        this.setupEventHandlers();\n        this.showEmptyState();\n    }\n\n    /**\n     * Setup container references for the two-pane layout\n     */\n    setupContainers() {\n        this.dataContainer = document.getElementById('module-data-content');\n        this.jsonContainer = null; // No longer used - JSON is handled via collapsible sections\n\n        if (!this.dataContainer) {\n            console.error('Module viewer data container not found');\n        }\n    }\n\n    /**\n     * Setup event handlers\n     */\n    setupEventHandlers() {\n        // Listen for event selection\n        document.addEventListener('eventSelected', (e) => {\n            this.showEventDetails(e.detail.event);\n        });\n\n        // Listen for selection cleared\n        document.addEventListener('eventSelectionCleared', () => {\n            this.showEmptyState();\n        });\n\n        // Listen for socket event updates to maintain event classification\n        document.addEventListener('socketEventUpdate', (e) => {\n            this.updateEventsByClass(e.detail.events);\n        });\n    }\n\n    /**\n     * Show empty state when no event is selected\n     */\n    showEmptyState() {\n        if (this.dataContainer) {\n            this.dataContainer.innerHTML = `\n                <div class=\"module-empty\">\n                    <p>Click on an event to view structured data</p>\n                    <p class=\"module-hint\">Data is organized by event type</p>\n                </div>\n            `;\n        }\n\n        // JSON container no longer exists - handled via collapsible sections\n\n        this.currentEvent = null;\n    }\n\n    /**\n     * Show details for a selected event\n     * @param {Object} event - The selected event\n     */\n    showEventDetails(event) {\n        this.currentEvent = event;\n\n        // Render structured data in top pane\n        this.renderStructuredData(event);\n\n        // Render JSON in bottom pane\n        this.renderJsonData(event);\n    }\n\n    /**\n     * Render structured data in the data pane with collapsible JSON section\n     * @param {Object} event - The event to render\n     */\n    renderStructuredData(event) {\n        if (!this.dataContainer) return;\n\n        // Create contextual header\n        const contextualHeader = this.createContextualHeader(event);\n\n        // Create structured view based on event type\n        const structuredView = this.createEventStructuredView(event);\n\n        // Create collapsible JSON section\n        const collapsibleJsonSection = this.createCollapsibleJsonSection(event);\n\n        // Combine all sections in data container\n        this.dataContainer.innerHTML = contextualHeader + structuredView + collapsibleJsonSection;\n\n        // Initialize JSON toggle functionality\n        this.initializeJsonToggle();\n    }\n\n    /**\n     * Render JSON data in the JSON pane (legacy support - now using collapsible section)\n     * @param {Object} event - The event to render\n     */\n    renderJsonData(event) {\n        // JSON is now integrated into data container as collapsible section\n        // Hide the JSON pane completely by clearing it\n        // JSON container no longer exists - handled via collapsible sections\n    }\n\n    /**\n     * Ingest method that determines how to render event(s)\n     * @param {Object|Array} eventData - Single event or array of events\n     */\n    ingest(eventData) {\n        if (Array.isArray(eventData)) {\n            // Handle multiple events - for now, show the first one\n            if (eventData.length > 0) {\n                this.showEventDetails(eventData[0]);\n            } else {\n                this.showEmptyState();\n            }\n        } else if (eventData && typeof eventData === 'object') {\n            // Handle single event\n            this.showEventDetails(eventData);\n        } else {\n            // Invalid data\n            this.showEmptyState();\n        }\n    }\n\n    /**\n     * Update events grouped by class for analysis\n     * @param {Array} events - All events\n     */\n    updateEventsByClass(events) {\n        this.eventsByClass.clear();\n\n        events.forEach(event => {\n            const eventClass = this.getEventClass(event);\n            if (!this.eventsByClass.has(eventClass)) {\n                this.eventsByClass.set(eventClass, []);\n            }\n            this.eventsByClass.get(eventClass).push(event);\n        });\n    }\n\n    /**\n     * Get event class/category for grouping\n     * @param {Object} event - Event object\n     * @returns {string} Event class\n     */\n    getEventClass(event) {\n        if (!event.type) return 'unknown';\n\n        // Group similar event types\n        switch (event.type) {\n            case 'session':\n                return 'Session Management';\n            case 'claude':\n                return 'Claude Interactions';\n            case 'agent':\n                return 'Agent Operations';\n            case 'hook':\n                return 'Hook System';\n            case 'todo':\n                return 'Task Management';\n            case 'memory':\n                return 'Memory Operations';\n            case 'log':\n                return 'System Logs';\n            case 'connection':\n                return 'Connection Events';\n            default:\n                return 'Other Events';\n        }\n    }\n\n    /**\n     * Create contextual header for the structured data\n     * @param {Object} event - Event to display\n     * @returns {string} HTML content\n     */\n    createContextualHeader(event) {\n        const timestamp = this.formatTimestamp(event.timestamp);\n        const data = event.data || {};\n        let headerText = '';\n\n        // Determine header text based on event type\n        switch (event.type) {\n            case 'hook':\n                // For Tools: \"ToolName: [Agent] [time]\"\n                const toolName = this.extractToolName(data);\n                const agent = this.extractAgent(event) || 'Unknown';\n                if (toolName) {\n                    headerText = `${toolName}: ${agent} ${timestamp}`;\n                } else {\n                    const hookName = this.getHookDisplayName(event, data);\n                    headerText = `${hookName}: ${agent} ${timestamp}`;\n                }\n                break;\n\n            case 'agent':\n                // For Agents: \"Agent: [AgentType] [time]\"\n                const agentType = data.agent_type || data.name || 'Unknown';\n                headerText = `Agent: ${agentType} ${timestamp}`;\n                break;\n\n            case 'todo':\n                // For TodoWrite: \"TodoWrite: [Agent] [time]\"\n                const todoAgent = this.extractAgent(event) || 'PM';\n                headerText = `TodoWrite: ${todoAgent} ${timestamp}`;\n                break;\n\n            case 'memory':\n                // For Memory: \"Memory: [Operation] [time]\"\n                const operation = data.operation || 'Unknown';\n                headerText = `Memory: ${operation} ${timestamp}`;\n                break;\n\n            case 'session':\n            case 'claude':\n            case 'log':\n            case 'connection':\n                // For Events: \"Event: [Type.Subtype] [time]\"\n                const eventType = event.type;\n                const subtype = event.subtype || 'default';\n                headerText = `Event: ${eventType}.${subtype} ${timestamp}`;\n                break;\n\n            default:\n                // For Files and other events: \"File: [filename] [time]\" or generic\n                const fileName = this.extractFileName(data);\n                if (fileName) {\n                    headerText = `File: ${fileName} ${timestamp}`;\n                } else {\n                    const eventType = event.type || 'Unknown';\n                    const subtype = event.subtype || 'default';\n                    headerText = `Event: ${eventType}.${subtype} ${timestamp}`;\n                }\n                break;\n        }\n\n        return `\n            <div class=\"contextual-header\">\n                <h3 class=\"contextual-header-text\">${headerText}</h3>\n            </div>\n        `;\n    }\n\n    /**\n     * Create structured view for an event\n     * @param {Object} event - Event to display\n     * @returns {string} HTML content\n     */\n    createEventStructuredView(event) {\n        const eventClass = this.getEventClass(event);\n        const relatedEvents = this.eventsByClass.get(eventClass) || [];\n        const eventCount = relatedEvents.length;\n\n        let content = `\n            <div class=\"structured-view-section\">\n                ${this.createEventDetailCard(event.type, event, eventCount)}\n            </div>\n        `;\n\n        // Add type-specific content\n        switch (event.type) {\n            case 'agent':\n                content += this.createAgentStructuredView(event);\n                break;\n            case 'hook':\n                // Check if this is actually a Task delegation (agent-related hook)\n                if (event.data?.tool_name === 'Task' && event.data?.tool_parameters?.subagent_type) {\n                    content += this.createAgentStructuredView(event);\n                } else {\n                    content += this.createHookStructuredView(event);\n                }\n                break;\n            case 'todo':\n                content += this.createTodoStructuredView(event);\n                break;\n            case 'memory':\n                content += this.createMemoryStructuredView(event);\n                break;\n            case 'claude':\n                content += this.createClaudeStructuredView(event);\n                break;\n            case 'session':\n                content += this.createSessionStructuredView(event);\n                break;\n            default:\n                content += this.createGenericStructuredView(event);\n                break;\n        }\n\n        // Note: JSON section is now rendered separately in the JSON pane\n        return content;\n    }\n\n    /**\n     * Create event detail card\n     */\n    createEventDetailCard(eventType, event, count) {\n        const timestamp = new Date(event.timestamp).toLocaleString();\n        const eventIcon = this.getEventIcon(eventType);\n\n        return `\n            <div class=\"event-detail-card\">\n                <div class=\"event-detail-header\">\n                    <div class=\"event-detail-title\">\n                        ${eventIcon} ${eventType || 'Unknown'}.${event.subtype || 'default'}\n                    </div>\n                    <div class=\"event-detail-time\">${timestamp}</div>\n                </div>\n                <div class=\"event-detail-content\">\n                    ${this.createProperty('Event ID', event.id || 'N/A')}\n                    ${this.createProperty('Type', `${eventType}.${event.subtype || 'default'}`)}\n                    ${this.createProperty('Class Events', count)}\n                    ${event.data && event.data.session_id ?\n                        this.createProperty('Session', event.data.session_id) : ''}\n                </div>\n            </div>\n        `;\n    }\n\n    /**\n     * Create agent-specific structured view\n     */\n    createAgentStructuredView(event) {\n        const data = event.data || {};\n\n        // Handle Task delegation events (which appear as hook events but contain agent info)\n        if (event.type === 'hook' && data.tool_name === 'Task' && data.tool_parameters?.subagent_type) {\n            const taskData = data.tool_parameters;\n            return `\n                <div class=\"structured-view-section\">\n                    <div class=\"structured-data\">\n                        ${this.createProperty('Agent Type', taskData.subagent_type)}\n                        ${this.createProperty('Task Type', 'Subagent Delegation')}\n                        ${this.createProperty('Phase', event.subtype || 'pre_tool')}\n                        ${taskData.description ? this.createProperty('Description', taskData.description) : ''}\n                        ${taskData.prompt ? this.createProperty('Prompt Preview', this.truncateText(taskData.prompt, 200)) : ''}\n                        ${data.session_id ? this.createProperty('Session ID', data.session_id) : ''}\n                        ${data.working_directory ? this.createProperty('Working Directory', data.working_directory) : ''}\n                    </div>\n                    ${taskData.prompt ? `\n                        <div class=\"prompt-section\">\n                            <div class=\"contextual-header\">\n                                <h3 class=\"contextual-header-text\">📝 Task Prompt</h3>\n                            </div>\n                            <div class=\"structured-data\">\n                                <div class=\"task-prompt\" style=\"white-space: pre-wrap; max-height: 300px; overflow-y: auto; padding: 10px; background: #f8fafc; border-radius: 6px; font-family: monospace; font-size: 12px; line-height: 1.4;\">\n                                    ${taskData.prompt}\n                                </div>\n                            </div>\n                        </div>\n                    ` : ''}\n                </div>\n            `;\n        }\n\n        // Handle regular agent events\n        return `\n            <div class=\"structured-view-section\">\n                <div class=\"structured-data\">\n                    ${this.createProperty('Agent Type', data.agent_type || data.subagent_type || 'Unknown')}\n                    ${this.createProperty('Name', data.name || 'N/A')}\n                    ${this.createProperty('Phase', event.subtype || 'N/A')}\n                    ${data.config ? this.createProperty('Config', typeof data.config === 'object' ? Object.keys(data.config).join(', ') : String(data.config)) : ''}\n                    ${data.capabilities ? this.createProperty('Capabilities', data.capabilities.join(', ')) : ''}\n                    ${data.result ? this.createProperty('Result', typeof data.result === 'object' ? '[Object]' : String(data.result)) : ''}\n                </div>\n            </div>\n        `;\n    }\n\n    /**\n     * Create hook-specific structured view\n     */\n    createHookStructuredView(event) {\n        const data = event.data || {};\n\n        // Extract file path information from tool parameters\n        const filePath = this.extractFilePathFromHook(data);\n        const toolInfo = this.extractToolInfoFromHook(data);\n\n        // Note: Git diff functionality moved to Files tab only\n        // Events tab no longer shows git diff buttons\n\n        // Create inline tool result content if available (without separate section header)\n        const toolResultContent = this.createInlineToolResultContent(data, event);\n\n        return `\n            <div class=\"structured-view-section\">\n                <div class=\"structured-data\">\n                    ${this.createProperty('Hook Name', this.getHookDisplayName(event, data))}\n                    ${this.createProperty('Event Type', data.event_type || event.subtype || 'N/A')}\n                    ${filePath ? this.createProperty('File Path', filePath) : ''}\n                    ${toolInfo.tool_name ? this.createProperty('Tool', toolInfo.tool_name) : ''}\n                    ${toolInfo.operation_type ? this.createProperty('Operation', toolInfo.operation_type) : ''}\n                    ${data.session_id ? this.createProperty('Session ID', data.session_id) : ''}\n                    ${data.working_directory ? this.createProperty('Working Directory', data.working_directory) : ''}\n                    ${data.duration_ms ? this.createProperty('Duration', `${data.duration_ms}ms`) : ''}\n                    ${toolResultContent}\n                </div>\n            </div>\n        `;\n    }\n\n    /**\n     * Create inline tool result content (no separate section header)\n     * @param {Object} data - Event data\n     * @param {Object} event - Full event object (optional, for phase checking)\n     * @returns {string} HTML content for inline tool result display\n     */\n    createInlineToolResultContent(data, event = null) {\n        const resultSummary = data.result_summary;\n\n        // Determine if this is a post-tool event\n        // Check multiple possible locations for the event phase\n        const eventPhase = event?.subtype || data.event_type || data.phase;\n        const isPostTool = eventPhase === 'post_tool' || eventPhase?.includes('post');\n\n        // Debug logging to help troubleshoot tool result display issues\n        if (window.DEBUG_TOOL_RESULTS) {\n            console.log('🔧 createInlineToolResultContent debug:', {\n                hasResultSummary: !!resultSummary,\n                eventPhase,\n                isPostTool,\n                eventSubtype: event?.subtype,\n                dataEventType: data.event_type,\n                dataPhase: data.phase,\n                toolName: data.tool_name,\n                resultSummaryKeys: resultSummary ? Object.keys(resultSummary) : []\n            });\n        }\n\n        // Only show results if we have result data and this is a post-tool event\n        // OR if we have result_summary regardless of phase (some events may not have proper phase info)\n        if (!resultSummary) {\n            return '';\n        }\n\n        // If we know this is a pre-tool event, don't show results\n        if (eventPhase === 'pre_tool' || (eventPhase?.includes('pre') && !eventPhase?.includes('post'))) {\n            return '';\n        }\n\n        let resultContent = '';\n\n        // Add output preview if available\n        if (resultSummary.has_output && resultSummary.output_preview) {\n            resultContent += `\n                ${this.createProperty('Output', this.truncateText(resultSummary.output_preview, 200))}\n                ${resultSummary.output_lines ? this.createProperty('Output Lines', resultSummary.output_lines) : ''}\n            `;\n        }\n\n        // Add error preview if available\n        if (resultSummary.has_error && resultSummary.error_preview) {\n            resultContent += `\n                ${this.createProperty('Error', this.truncateText(resultSummary.error_preview, 200))}\n            `;\n        }\n\n        // If no specific output or error, but we have other result info\n        if (!resultSummary.has_output && !resultSummary.has_error && Object.keys(resultSummary).length > 3) {\n            // Show other result fields\n            const otherFields = Object.entries(resultSummary)\n                .filter(([key, value]) => !['has_output', 'has_error', 'exit_code'].includes(key) && value !== undefined)\n                .map(([key, value]) => this.createProperty(this.formatFieldName(key), String(value)))\n                .join('');\n\n            resultContent += otherFields;\n        }\n\n        return resultContent;\n    }\n\n    /**\n     * Create tool result section if result data is available\n     * @param {Object} data - Event data\n     * @param {Object} event - Full event object (optional, for phase checking)\n     * @returns {string} HTML content for tool result section\n     */\n    createToolResultSection(data, event = null) {\n        const resultSummary = data.result_summary;\n\n        // Determine if this is a post-tool event\n        // Check multiple possible locations for the event phase\n        const eventPhase = event?.subtype || data.event_type || data.phase;\n        const isPostTool = eventPhase === 'post_tool' || eventPhase?.includes('post');\n\n        // Debug logging to help troubleshoot tool result display issues\n        if (window.DEBUG_TOOL_RESULTS) {\n            console.log('🔧 createToolResultSection debug:', {\n                hasResultSummary: !!resultSummary,\n                eventPhase,\n                isPostTool,\n                eventSubtype: event?.subtype,\n                dataEventType: data.event_type,\n                dataPhase: data.phase,\n                toolName: data.tool_name,\n                resultSummaryKeys: resultSummary ? Object.keys(resultSummary) : []\n            });\n        }\n\n        // Only show results if we have result data and this is a post-tool event\n        // OR if we have result_summary regardless of phase (some events may not have proper phase info)\n        if (!resultSummary) {\n            return '';\n        }\n\n        // If we know this is a pre-tool event, don't show results\n        if (eventPhase === 'pre_tool' || (eventPhase?.includes('pre') && !eventPhase?.includes('post'))) {\n            return '';\n        }\n\n        // Determine result status and icon\n        let statusIcon = '⏳';\n        let statusClass = 'tool-running';\n        let statusText = 'Unknown';\n\n        if (data.success === true) {\n            statusIcon = '✅';\n            statusClass = 'tool-success';\n            statusText = 'Success';\n        } else if (data.success === false) {\n            statusIcon = '❌';\n            statusClass = 'tool-failure';\n            statusText = 'Failed';\n        } else if (data.exit_code === 0) {\n            statusIcon = '✅';\n            statusClass = 'tool-success';\n            statusText = 'Completed';\n        } else if (data.exit_code === 2) {\n            statusIcon = '⚠️';\n            statusClass = 'tool-blocked';\n            statusText = 'Blocked';\n        } else if (data.exit_code !== undefined && data.exit_code !== 0) {\n            statusIcon = '❌';\n            statusClass = 'tool-failure';\n            statusText = 'Error';\n        }\n\n        let resultContent = '';\n\n        // Add basic result info\n        resultContent += `\n            <div class=\"tool-result-status ${statusClass}\">\n                <span class=\"tool-result-icon\">${statusIcon}</span>\n                <span class=\"tool-result-text\">${statusText}</span>\n                ${data.exit_code !== undefined ? `<span class=\"tool-exit-code\">Exit Code: ${data.exit_code}</span>` : ''}\n            </div>\n        `;\n\n        // Add output preview if available\n        if (resultSummary.has_output && resultSummary.output_preview) {\n            resultContent += `\n                <div class=\"tool-result-output\">\n                    <div class=\"tool-result-label\">📄 Output:</div>\n                    <div class=\"tool-result-preview\">\n                        <pre>${this.escapeHtml(resultSummary.output_preview)}</pre>\n                    </div>\n                    ${resultSummary.output_lines ? `<div class=\"tool-result-meta\">Lines: ${resultSummary.output_lines}</div>` : ''}\n                </div>\n            `;\n        }\n\n        // Add error preview if available\n        if (resultSummary.has_error && resultSummary.error_preview) {\n            resultContent += `\n                <div class=\"tool-result-error\">\n                    <div class=\"tool-result-label\">⚠️ Error:</div>\n                    <div class=\"tool-result-preview error-preview\">\n                        <pre>${this.escapeHtml(resultSummary.error_preview)}</pre>\n                    </div>\n                </div>\n            `;\n        }\n\n        // If no specific output or error, but we have other result info\n        if (!resultSummary.has_output && !resultSummary.has_error && Object.keys(resultSummary).length > 3) {\n            // Show other result fields\n            const otherFields = Object.entries(resultSummary)\n                .filter(([key, value]) => !['has_output', 'has_error', 'exit_code'].includes(key) && value !== undefined)\n                .map(([key, value]) => this.createProperty(this.formatFieldName(key), String(value)))\n                .join('');\n\n            if (otherFields) {\n                resultContent += `\n                    <div class=\"tool-result-other\">\n                        <div class=\"tool-result-label\">📊 Result Details:</div>\n                        <div class=\"structured-data\">\n                            ${otherFields}\n                        </div>\n                    </div>\n                `;\n            }\n        }\n\n        // Only return content if we have something to show\n        if (!resultContent.trim()) {\n            return '';\n        }\n\n        return `\n            <div class=\"tool-result-section\">\n                <div class=\"contextual-header\">\n                    <h3 class=\"contextual-header-text\">🔧 Tool Result</h3>\n                </div>\n                <div class=\"tool-result-content\">\n                    ${resultContent}\n                </div>\n            </div>\n        `;\n    }\n\n    /**\n     * Check if this is a write operation that modifies files\n     * @param {string} toolName - Name of the tool used\n     * @param {Object} data - Event data\n     * @returns {boolean} True if this is a write operation\n     */\n    isWriteOperation(toolName, data) {\n        // Common write operation tool names\n        const writeTools = [\n            'Write',\n            'Edit',\n            'MultiEdit',\n            'NotebookEdit'\n        ];\n\n        if (writeTools.includes(toolName)) {\n            return true;\n        }\n\n        // Check for write-related parameters in the data\n        if (data.tool_parameters) {\n            const params = data.tool_parameters;\n\n            // Check for content or editing parameters\n            if (params.content || params.new_string || params.edits) {\n                return true;\n            }\n\n            // Check for file modification indicators\n            if (params.edit_mode && params.edit_mode !== 'read') {\n                return true;\n            }\n        }\n\n        // Check event subtype for write operations\n        if (data.event_type === 'post_tool' || data.event_type === 'pre_tool') {\n            // Additional heuristics based on tool usage patterns\n            if (toolName && (\n                toolName.toLowerCase().includes('write') ||\n                toolName.toLowerCase().includes('edit') ||\n                toolName.toLowerCase().includes('modify')\n            )) {\n                return true;\n            }\n        }\n\n        return false;\n    }\n\n    /**\n     * Determines if a file operation is read-only or modifies the file\n     * @param {string} operation - The operation type\n     * @returns {boolean} True if operation is read-only, false if it modifies the file\n     */\n    isReadOnlyOperation(operation) {\n        if (!operation) return true; // Default to read-only for safety\n\n        const readOnlyOperations = ['read'];\n        const editOperations = ['write', 'edit', 'multiedit', 'create', 'delete', 'move', 'copy'];\n\n        const opLower = operation.toLowerCase();\n\n        // Explicitly read-only operations\n        if (readOnlyOperations.includes(opLower)) {\n            return true;\n        }\n\n        // Explicitly edit operations\n        if (editOperations.includes(opLower)) {\n            return false;\n        }\n\n        // Default to read-only for unknown operations\n        return true;\n    }\n\n    /**\n     * Create todo-specific structured view\n     */\n    createTodoStructuredView(event) {\n        const data = event.data || {};\n\n        let content = '';\n\n        // Add todo checklist if available - start directly with checklist\n        if (data.todos && Array.isArray(data.todos)) {\n            content += `\n                <div class=\"todo-checklist\">\n                    ${data.todos.map(todo => `\n                        <div class=\"todo-item todo-${todo.status || 'pending'}\">\n                            <span class=\"todo-status\">${this.getTodoStatusIcon(todo.status)}</span>\n                            <span class=\"todo-content\">${todo.content || 'No content'}</span>\n                            <span class=\"todo-priority priority-${todo.priority || 'medium'}\">${this.getTodoPriorityIcon(todo.priority)}</span>\n                        </div>\n                    `).join('')}\n                </div>\n            `;\n        }\n\n        return content;\n    }\n\n    /**\n     * Create memory-specific structured view\n     */\n    createMemoryStructuredView(event) {\n        const data = event.data || {};\n\n        return `\n            <div class=\"structured-view-section\">\n                <div class=\"structured-data\">\n                    ${this.createProperty('Operation', data.operation || 'Unknown')}\n                    ${this.createProperty('Key', data.key || 'N/A')}\n                    ${data.value ? this.createProperty('Value', typeof data.value === 'object' ? '[Object]' : String(data.value)) : ''}\n                    ${data.namespace ? this.createProperty('Namespace', data.namespace) : ''}\n                    ${data.metadata ? this.createProperty('Metadata', typeof data.metadata === 'object' ? '[Object]' : String(data.metadata)) : ''}\n                </div>\n            </div>\n        `;\n    }\n\n    /**\n     * Create Claude-specific structured view\n     */\n    createClaudeStructuredView(event) {\n        const data = event.data || {};\n\n        return `\n            <div class=\"structured-view-section\">\n                <div class=\"structured-data\">\n                    ${this.createProperty('Type', event.subtype || 'N/A')}\n                    ${data.prompt ? this.createProperty('Prompt', this.truncateText(data.prompt, 200)) : ''}\n                    ${data.message ? this.createProperty('Message', this.truncateText(data.message, 200)) : ''}\n                    ${data.response ? this.createProperty('Response', this.truncateText(data.response, 200)) : ''}\n                    ${data.content ? this.createProperty('Content', this.truncateText(data.content, 200)) : ''}\n                    ${data.tokens ? this.createProperty('Tokens', data.tokens) : ''}\n                    ${data.model ? this.createProperty('Model', data.model) : ''}\n                </div>\n            </div>\n        `;\n    }\n\n    /**\n     * Create session-specific structured view\n     */\n    createSessionStructuredView(event) {\n        const data = event.data || {};\n\n        return `\n            <div class=\"structured-view-section\">\n                <div class=\"structured-data\">\n                    ${this.createProperty('Action', event.subtype || 'N/A')}\n                    ${this.createProperty('Session ID', data.session_id || 'N/A')}\n                    ${data.working_directory ? this.createProperty('Working Dir', data.working_directory) : ''}\n                    ${data.git_branch ? this.createProperty('Git Branch', data.git_branch) : ''}\n                    ${data.agent_type ? this.createProperty('Agent Type', data.agent_type) : ''}\n                </div>\n            </div>\n        `;\n    }\n\n    /**\n     * Create generic structured view\n     */\n    createGenericStructuredView(event) {\n        const data = event.data || {};\n        const keys = Object.keys(data);\n\n        if (keys.length === 0) {\n            return '';\n        }\n\n        return `\n            <div class=\"structured-view-section\">\n                <div class=\"structured-data\">\n                    ${keys.map(key =>\n                        this.createProperty(key, typeof data[key] === 'object' ?\n                            '[Object]' : String(data[key]))\n                    ).join('')}\n                </div>\n            </div>\n        `;\n    }\n\n    /**\n     * Create collapsible JSON section that appears below main content\n     * WHY: Uses global state to maintain consistent JSON visibility across all events\n     * DESIGN DECISION: Sticky toggle improves debugging workflow by maintaining JSON\n     * visibility preference as user navigates through different events\n     * @param {Object} event - The event to render\n     * @returns {string} HTML content\n     */\n    createCollapsibleJsonSection(event) {\n        const uniqueId = 'json-section-' + Math.random().toString(36).substr(2, 9);\n        const jsonString = this.formatJSON(event);\n        \n        // Use global state to determine initial visibility\n        const isExpanded = this.globalJsonExpanded;\n        const display = isExpanded ? 'block' : 'none';\n        const arrow = isExpanded ? '▲' : '▼';\n        const ariaExpanded = isExpanded ? 'true' : 'false';\n        \n        return `\n            <div class=\"collapsible-json-section\" id=\"${uniqueId}\">\n                <div class=\"json-toggle-header\"\n                     onclick=\"window.moduleViewer.toggleJsonSection()\"\n                     role=\"button\"\n                     tabindex=\"0\"\n                     aria-expanded=\"${ariaExpanded}\"\n                     onkeydown=\"if(event.key==='Enter'||event.key===' '){window.moduleViewer.toggleJsonSection();event.preventDefault();}\">\n                    <span class=\"json-toggle-text\">Raw JSON</span>\n                    <span class=\"json-toggle-arrow\">${arrow}</span>\n                </div>\n                <div class=\"json-content-collapsible\" style=\"display: ${display};\" aria-hidden=\"${!isExpanded}\">\n                    <div class=\"json-display\" onclick=\"window.moduleViewer.copyJsonToClipboard(event)\">\n                        <pre>${jsonString}</pre>\n                    </div>\n                </div>\n            </div>\n        `;\n    }\n\n    /**\n     * Copy JSON content to clipboard\n     * @param {Event} event - Click event\n     */\n    async copyJsonToClipboard(event) {\n        // Only trigger on the copy icon area (top-right corner)\n        const rect = event.currentTarget.getBoundingClientRect();\n        const clickX = event.clientX - rect.left;\n        const clickY = event.clientY - rect.top;\n\n        // Check if click is in the top-right corner (copy icon area)\n        if (clickX > rect.width - 50 && clickY < 30) {\n            const preElement = event.currentTarget.querySelector('pre');\n            if (preElement) {\n                try {\n                    await navigator.clipboard.writeText(preElement.textContent);\n                    this.showNotification('JSON copied to clipboard', 'success');\n                } catch (err) {\n                    console.error('Failed to copy JSON:', err);\n                    this.showNotification('Failed to copy JSON', 'error');\n                }\n            }\n            event.stopPropagation();\n        }\n    }\n\n    /**\n     * Initialize JSON toggle functionality\n     * WHY: Ensures newly rendered events respect the current global JSON visibility state\n     */\n    initializeJsonToggle() {\n        // Make sure the moduleViewer is available globally for onclick handlers\n        window.moduleViewer = this;\n\n        // Apply global state to newly rendered JSON sections\n        // This ensures new events respect the current global state\n        if (this.globalJsonExpanded) {\n            // Small delay to ensure DOM is ready\n            setTimeout(() => {\n                this.updateAllJsonSections();\n            }, 0);\n        }\n\n        // Add keyboard navigation support (only add once to avoid duplicates)\n        if (!this.keyboardListenerAdded) {\n            this.keyboardListenerAdded = true;\n            document.addEventListener('keydown', (e) => {\n                if (e.target.classList.contains('json-toggle-header')) {\n                    if (e.key === 'Enter' || e.key === ' ') {\n                        this.toggleJsonSection();\n                        e.preventDefault();\n                    }\n                }\n            });\n        }\n    }\n\n    /**\n     * Toggle JSON section visibility globally - affects ALL events\n     * WHY: Sticky toggle maintains user preference across all events for better debugging\n     * DESIGN DECISION: Uses localStorage to persist preference across page refreshes\n     */\n    toggleJsonSection() {\n        // Toggle the global state\n        this.globalJsonExpanded = !this.globalJsonExpanded;\n        \n        // Persist the preference to localStorage\n        localStorage.setItem('dashboard-json-expanded', this.globalJsonExpanded.toString());\n        \n        // Update ALL JSON sections on the page\n        this.updateAllJsonSections();\n        \n        // Dispatch event to notify other components of the change\n        document.dispatchEvent(new CustomEvent('jsonToggleChanged', {\n            detail: { expanded: this.globalJsonExpanded }\n        }));\n    }\n\n    /**\n     * Update all JSON sections on the page to match global state\n     * WHY: Ensures consistent JSON visibility across all displayed events\n     */\n    updateAllJsonSections() {\n        // Find all JSON content sections and toggle headers\n        const allJsonContents = document.querySelectorAll('.json-content-collapsible');\n        const allArrows = document.querySelectorAll('.json-toggle-arrow');\n        const allHeaders = document.querySelectorAll('.json-toggle-header');\n        \n        // Update each JSON section\n        allJsonContents.forEach((jsonContent, index) => {\n            if (this.globalJsonExpanded) {\n                // Show JSON content\n                jsonContent.style.display = 'block';\n                jsonContent.setAttribute('aria-hidden', 'false');\n                if (allArrows[index]) {\n                    allArrows[index].textContent = '▲';\n                }\n                if (allHeaders[index]) {\n                    allHeaders[index].setAttribute('aria-expanded', 'true');\n                }\n            } else {\n                // Hide JSON content\n                jsonContent.style.display = 'none';\n                jsonContent.setAttribute('aria-hidden', 'true');\n                if (allArrows[index]) {\n                    allArrows[index].textContent = '▼';\n                }\n                if (allHeaders[index]) {\n                    allHeaders[index].setAttribute('aria-expanded', 'false');\n                }\n            }\n        });\n        \n        // If expanded and there's content, scroll the first visible one into view\n        if (this.globalJsonExpanded && allJsonContents.length > 0) {\n            setTimeout(() => {\n                const firstVisible = allJsonContents[0];\n                if (firstVisible) {\n                    firstVisible.scrollIntoView({ behavior: 'smooth', block: 'nearest' });\n                }\n            }, 100);\n        }\n    }\n\n    /**\n     * Create a property display element with optional file path detection\n     */\n    createProperty(key, value) {\n        const displayValue = this.truncateText(String(value), 300);\n\n        // Check if this is a file path property that should be clickable\n        if (this.isFilePathProperty(key, value)) {\n            return `\n                <div class=\"event-property\">\n                    <span class=\"event-property-key\">${key}:</span>\n                    <span class=\"event-property-value\">\n                        ${this.createClickableFilePath(value)}\n                    </span>\n                </div>\n            `;\n        }\n\n        return `\n            <div class=\"event-property\">\n                <span class=\"event-property-key\">${key}:</span>\n                <span class=\"event-property-value\">${displayValue}</span>\n            </div>\n        `;\n    }\n\n    /**\n     * Check if a property represents a file path that should be clickable\n     * @param {string} key - Property key\n     * @param {string} value - Property value\n     * @returns {boolean} True if this should be a clickable file path\n     */\n    isFilePathProperty(key, value) {\n        const filePathKeys = [\n            'File Path',\n            'file_path',\n            'notebook_path',\n            'Full Path',\n            'Working Directory',\n            'working_directory'\n        ];\n\n        // Check if key indicates a file path\n        if (filePathKeys.some(pathKey => key.toLowerCase().includes(pathKey.toLowerCase()))) {\n            // Ensure value looks like a file path (contains / or \\\\ and has reasonable length)\n            const strValue = String(value);\n            return strValue.length > 0 &&\n                   (strValue.includes('/') || strValue.includes('\\\\')) &&\n                   strValue.length < 500; // Reasonable path length limit\n        }\n\n        return false;\n    }\n\n    /**\n     * Create a clickable file path element\n     * @param {string} filePath - The file path to make clickable\n     * @returns {string} HTML for clickable file path\n     */\n    createClickableFilePath(filePath) {\n        const displayPath = this.truncateText(String(filePath), 300);\n        const escapedPath = filePath.replace(/'/g, \"\\\\'\");\n\n        return `\n            <span class=\"clickable-file-path\"\n                  onclick=\"showFileViewerModal('${escapedPath}')\"\n                  title=\"Click to view file contents with syntax highlighting&#10;Path: ${filePath}\">\n                ${displayPath}\n            </span>\n        `;\n    }\n\n    /**\n     * Get icon for event type\n     */\n    getEventIcon(eventType) {\n        const icons = {\n            session: '📱',\n            claude: '🤖',\n            agent: '🎯',\n            hook: '🔗',\n            todo: '✅',\n            memory: '🧠',\n            log: '📝',\n            connection: '🔌',\n            unknown: '❓'\n        };\n        return icons[eventType] || icons.unknown;\n    }\n\n    /**\n     * Get todo status icon\n     */\n    getTodoStatusIcon(status) {\n        const icons = {\n            completed: '✅',\n            'in_progress': '🔄',\n            pending: '⏳',\n            cancelled: '❌'\n        };\n        return icons[status] || icons.pending;\n    }\n\n    /**\n     * Get todo priority icon\n     */\n    getTodoPriorityIcon(priority) {\n        const icons = {\n            high: '🔴',\n            medium: '🟡',\n            low: '🟢'\n        };\n        return icons[priority] || icons.medium;\n    }\n\n    /**\n     * Get meaningful hook display name from event data\n     */\n    getHookDisplayName(event, data) {\n        // First check if there's a specific hook name in the data\n        if (data.hook_name) return data.hook_name;\n        if (data.name) return data.name;\n\n        // Use event.subtype or data.event_type to determine hook name\n        const eventType = event.subtype || data.event_type;\n\n        // Map hook event types to meaningful display names\n        const hookNames = {\n            'user_prompt': 'User Prompt',\n            'pre_tool': 'Tool Execution (Pre)',\n            'post_tool': 'Tool Execution (Post)',\n            'notification': 'Notification',\n            'stop': 'Session Stop',\n            'subagent_stop': 'Subagent Stop'\n        };\n\n        if (hookNames[eventType]) {\n            return hookNames[eventType];\n        }\n\n        // If it's a compound event type like \"hook.user_prompt\", extract the part after \"hook.\"\n        if (typeof event.type === 'string' && event.type.startsWith('hook.')) {\n            const hookType = event.type.replace('hook.', '');\n            if (hookNames[hookType]) {\n                return hookNames[hookType];\n            }\n        }\n\n        // Fallback to formatting the event type nicely\n        if (eventType) {\n            return eventType.split('_')\n                .map(word => word.charAt(0).toUpperCase() + word.slice(1))\n                .join(' ');\n        }\n\n        return 'Unknown Hook';\n    }\n\n    /**\n     * Extract file path from hook event data\n     */\n    extractFilePathFromHook(data) {\n        // Check tool parameters for file path\n        if (data.tool_parameters && data.tool_parameters.file_path) {\n            return data.tool_parameters.file_path;\n        }\n\n        // Check direct file_path field\n        if (data.file_path) {\n            return data.file_path;\n        }\n\n        // Check nested in other common locations\n        if (data.tool_input && data.tool_input.file_path) {\n            return data.tool_input.file_path;\n        }\n\n        // Check for notebook path (alternative field name)\n        if (data.tool_parameters && data.tool_parameters.notebook_path) {\n            return data.tool_parameters.notebook_path;\n        }\n\n        return null;\n    }\n\n    /**\n     * Extract tool information from hook event data\n     */\n    extractToolInfoFromHook(data) {\n        return {\n            tool_name: data.tool_name || (data.tool_parameters && data.tool_parameters.tool_name),\n            operation_type: data.operation_type || (data.tool_parameters && data.tool_parameters.operation_type)\n        };\n    }\n\n    /**\n     * Truncate text to specified length\n     */\n    truncateText(text, maxLength) {\n        if (!text || text.length <= maxLength) return text;\n        return text.substring(0, maxLength) + '...';\n    }\n    \n    /**\n     * Format operation details object for display\n     * @param {Object} details - Details object containing operation information\n     * @returns {string} Formatted HTML string\n     */\n    formatOperationDetails(details) {\n        if (!details || typeof details !== 'object') {\n            return '';\n        }\n        \n        let formattedDetails = '';\n        \n        // Display the bash command if available\n        if (details.parameters && details.parameters.command) {\n            formattedDetails += `<br><strong>Command:</strong> <code>${this.escapeHtml(details.parameters.command)}</code>`;\n        }\n        \n        // Display success/error status\n        if (details.success !== undefined) {\n            formattedDetails += `<br><strong>Status:</strong> ${details.success ? '✅ Success' : '❌ Failed'}`;\n        }\n        \n        // Display exit code if available\n        if (details.exit_code !== undefined && details.exit_code !== null) {\n            formattedDetails += `<br><strong>Exit Code:</strong> ${details.exit_code}`;\n        }\n        \n        // Display duration if available\n        if (details.duration_ms !== undefined && details.duration_ms !== null) {\n            const duration = details.duration_ms > 1000 \n                ? `${(details.duration_ms / 1000).toFixed(2)}s` \n                : `${details.duration_ms}ms`;\n            formattedDetails += `<br><strong>Duration:</strong> ${duration}`;\n        }\n        \n        // Display error message if available\n        if (details.error) {\n            formattedDetails += `<br><strong>Error:</strong> ${this.escapeHtml(this.truncateText(details.error, 200))}`;\n        }\n        \n        return formattedDetails;\n    }\n    \n    /**\n     * Escape HTML to prevent XSS\n     */\n    escapeHtml(text) {\n        if (!text) return '';\n        const div = document.createElement('div');\n        div.textContent = text;\n        return div.innerHTML;\n    }\n\n    /**\n     * Format JSON for display\n     */\n    formatJSON(obj) {\n        try {\n            return JSON.stringify(obj, null, 2);\n        } catch (e) {\n            return String(obj);\n        }\n    }\n\n    /**\n     * Format timestamp for display\n     * @param {string|number} timestamp - Timestamp to format\n     * @returns {string} Formatted time\n     */\n    formatTimestamp(timestamp) {\n        if (!timestamp) return 'Unknown time';\n\n        try {\n            const date = new Date(timestamp);\n            return date.toLocaleTimeString('en-US', {\n                hour: 'numeric',\n                minute: '2-digit',\n                second: '2-digit',\n                hour12: true\n            });\n        } catch (e) {\n            return 'Invalid time';\n        }\n    }\n\n    /**\n     * Escape HTML characters to prevent XSS\n     * @param {string} text - Text to escape\n     * @returns {string} Escaped text\n     */\n    escapeHtml(text) {\n        if (!text) return '';\n        const div = document.createElement('div');\n        div.textContent = text;\n        return div.innerHTML;\n    }\n\n    /**\n     * Format field name for display (convert snake_case to Title Case)\n     * @param {string} fieldName - Field name to format\n     * @returns {string} Formatted field name\n     */\n    formatFieldName(fieldName) {\n        return fieldName\n            .split('_')\n            .map(word => word.charAt(0).toUpperCase() + word.slice(1))\n            .join(' ');\n    }\n\n    /**\n     * Extract tool name from event data\n     * @param {Object} data - Event data\n     * @returns {string|null} Tool name\n     */\n    extractToolName(data) {\n        // Check various locations where tool name might be stored\n        if (data.tool_name) return data.tool_name;\n        if (data.tool_parameters && data.tool_parameters.tool_name) return data.tool_parameters.tool_name;\n        if (data.tool_input && data.tool_input.tool_name) return data.tool_input.tool_name;\n\n        // Try to infer from other fields\n        if (data.tool_parameters) {\n            // Common tool patterns\n            if (data.tool_parameters.file_path || data.tool_parameters.notebook_path) {\n                return 'FileOperation';\n            }\n            if (data.tool_parameters.pattern) {\n                return 'Search';\n            }\n            if (data.tool_parameters.command) {\n                return 'Bash';\n            }\n            if (data.tool_parameters.todos) {\n                return 'TodoWrite';\n            }\n        }\n\n        return null;\n    }\n\n    /**\n     * Extract agent information from event data\n     * @param {Object} data - Event data\n     * @returns {string|null} Agent identifier\n     */\n    extractAgent(data) {\n        // First check if we have enhanced inference data from dashboard\n        if (data._agentName && data._agentName !== 'Unknown Agent') {\n            return data._agentName;\n        }\n\n        // Check inference data if available\n        if (data._inference && data._inference.agentName && data._inference.agentName !== 'Unknown') {\n            return data._inference.agentName;\n        }\n\n        // Check various locations where agent info might be stored\n        if (data.agent) return data.agent;\n        if (data.agent_type) return data.agent_type;\n        if (data.agent_name) return data.agent_name;\n\n        // Check session data\n        if (data.session_id && typeof data.session_id === 'string') {\n            // Extract agent from session ID if it contains agent info\n            const sessionParts = data.session_id.split('_');\n            if (sessionParts.length > 1) {\n                return sessionParts[0].toUpperCase();\n            }\n        }\n\n        // Infer from context\n        if (data.todos) return 'PM'; // TodoWrite typically from PM agent\n        if (data.tool_name === 'TodoWrite') return 'PM';\n\n        return null;\n    }\n\n    /**\n     * Extract file name from event data\n     * @param {Object} data - Event data\n     * @returns {string|null} File name\n     */\n    extractFileName(data) {\n        const filePath = this.extractFilePathFromHook(data);\n        if (filePath) {\n            // Extract just the filename from the full path\n            const pathParts = filePath.split('/');\n            return pathParts[pathParts.length - 1];\n        }\n\n        // Check other common file fields\n        if (data.filename) return data.filename;\n        if (data.file) return data.file;\n\n        return null;\n    }\n\n    /**\n     * Clear the module viewer\n     */\n    clear() {\n        this.showEmptyState();\n    }\n\n    /**\n     * Show tool call details (backward compatibility method)\n     * @param {Object} toolCall - The tool call data\n     * @param {string} toolCallKey - The tool call key\n     */\n    showToolCall(toolCall, toolCallKey) {\n        if (!toolCall) {\n            this.showEmptyState();\n            return;\n        }\n\n        const toolName = toolCall.tool_name || 'Unknown Tool';\n        const agentName = toolCall.agent_type || 'PM';\n        const timestamp = this.formatTimestamp(toolCall.timestamp);\n\n        // Extract information from pre and post events\n        const preEvent = toolCall.pre_event;\n        const postEvent = toolCall.post_event;\n\n        // Get parameters from pre-event\n        const parameters = preEvent?.tool_parameters || {};\n        const target = preEvent ? this.extractToolTarget(toolName, parameters) : 'Unknown target';\n\n        // Get execution results from post-event\n        const duration = toolCall.duration_ms ? `${toolCall.duration_ms}ms` : '-';\n        const success = toolCall.success !== undefined ? toolCall.success : null;\n        const exitCode = toolCall.exit_code !== undefined ? toolCall.exit_code : null;\n\n        // Format result summary\n        let resultSummary = toolCall.result_summary || 'No summary available';\n        let formattedResultSummary = '';\n\n        if (typeof resultSummary === 'object' && resultSummary !== null) {\n            const parts = [];\n            if (resultSummary.exit_code !== undefined) {\n                parts.push(`Exit Code: ${resultSummary.exit_code}`);\n            }\n            if (resultSummary.has_output !== undefined) {\n                parts.push(`Has Output: ${resultSummary.has_output ? 'Yes' : 'No'}`);\n            }\n            if (resultSummary.has_error !== undefined) {\n                parts.push(`Has Error: ${resultSummary.has_error ? 'Yes' : 'No'}`);\n            }\n            if (resultSummary.output_lines !== undefined) {\n                parts.push(`Output Lines: ${resultSummary.output_lines}`);\n            }\n            if (resultSummary.output_preview) {\n                parts.push(`Output Preview: ${resultSummary.output_preview}`);\n            }\n            if (resultSummary.error_preview) {\n                parts.push(`Error Preview: ${resultSummary.error_preview}`);\n            }\n            formattedResultSummary = parts.join('\\n');\n        } else {\n            formattedResultSummary = String(resultSummary);\n        }\n\n        // Status information\n        let statusIcon = '⏳';\n        let statusText = 'Running...';\n        let statusClass = 'tool-running';\n\n        if (postEvent) {\n            if (success === true) {\n                statusIcon = '✅';\n                statusText = 'Success';\n                statusClass = 'tool-success';\n            } else if (success === false) {\n                statusIcon = '❌';\n                statusText = 'Failed';\n                statusClass = 'tool-failure';\n            } else {\n                statusIcon = '⏳';\n                statusText = 'Completed';\n                statusClass = 'tool-completed';\n            }\n        }\n\n        // Create contextual header\n        const contextualHeader = `\n            <div class=\"contextual-header\">\n                <h3 class=\"contextual-header-text\">${toolName}: ${agentName} ${timestamp}</h3>\n            </div>\n        `;\n\n        // Special handling for TodoWrite\n        if (toolName === 'TodoWrite' && parameters.todos) {\n            const todoContent = `\n                <div class=\"todo-checklist\">\n                    ${parameters.todos.map(todo => {\n                        const statusIcon = this.getTodoStatusIcon(todo.status);\n                        const priorityIcon = this.getTodoPriorityIcon(todo.priority);\n\n                        return `\n                            <div class=\"todo-item todo-${todo.status || 'pending'}\">\n                                <span class=\"todo-status\">${statusIcon}</span>\n                                <span class=\"todo-content\">${todo.content || 'No content'}</span>\n                                <span class=\"todo-priority priority-${todo.priority || 'medium'}\">${priorityIcon}</span>\n                            </div>\n                        `;\n                    }).join('')}\n                </div>\n            `;\n\n            // Create collapsible JSON section\n            const toolCallData = {\n                toolCall: toolCall,\n                preEvent: preEvent,\n                postEvent: postEvent\n            };\n            const collapsibleJsonSection = this.createCollapsibleJsonSection(toolCallData);\n\n            if (this.dataContainer) {\n                this.dataContainer.innerHTML = contextualHeader + todoContent + collapsibleJsonSection;\n            }\n\n            // Initialize JSON toggle functionality\n            this.initializeJsonToggle();\n        } else if (toolName === 'Grep' || toolName === 'Search' || (parameters && parameters.pattern && !parameters.file_path)) {\n            // Special handling for search operations (Grep tool or any tool with pattern parameter)\n            const searchPattern = parameters.pattern || 'No pattern specified';\n            const searchPath = parameters.path || parameters.directory || '.';\n            const searchType = parameters.type || parameters.glob || 'all files';\n            \n            // Extract search results from result_summary\n            let searchResultsContent = '';\n            if (toolCall.result_summary) {\n                if (typeof toolCall.result_summary === 'string') {\n                    searchResultsContent = toolCall.result_summary;\n                } else if (toolCall.result_summary.output_preview) {\n                    searchResultsContent = toolCall.result_summary.output_preview;\n                } else {\n                    searchResultsContent = JSON.stringify(toolCall.result_summary, null, 2);\n                }\n            }\n\n            const content = `\n                <div class=\"structured-view-section\">\n                    <div class=\"tool-call-details\">\n                        <div class=\"tool-call-info ${statusClass}\">\n                            <div class=\"structured-field\">\n                                <strong>Tool Name:</strong> ${toolName}\n                            </div>\n                            <div class=\"structured-field\">\n                                <strong>Agent:</strong> ${agentName}\n                            </div>\n                            <div class=\"structured-field\">\n                                <strong>Status:</strong> ${statusIcon} ${statusText}\n                            </div>\n                            <div class=\"structured-field\">\n                                <strong>Search Pattern:</strong> <code>${searchPattern}</code>\n                            </div>\n                            <div class=\"structured-field\">\n                                <strong>Search Path:</strong> ${searchPath}\n                            </div>\n                            <div class=\"structured-field\">\n                                <strong>File Type:</strong> ${searchType}\n                            </div>\n                            <div class=\"structured-field\">\n                                <strong>Started:</strong> ${new Date(toolCall.timestamp).toLocaleString()}\n                            </div>\n                            ${duration && duration !== '-' ? `\n                                <div class=\"structured-field\">\n                                    <strong>Duration:</strong> ${duration}\n                                </div>\n                            ` : ''}\n                        </div>\n\n                        <div class=\"search-view-action\" style=\"margin-top: 20px;\">\n                            <button class=\"btn-view-search\" data-search-params='${JSON.stringify(parameters)}' data-search-results='${JSON.stringify(searchResultsContent).replace(/'/g, \"&#39;\")}' onclick=\"window.showSearchViewerModal(JSON.parse(this.getAttribute('data-search-params')), JSON.parse(this.getAttribute('data-search-results')))\">\n                                🔍 View Search Details\n                            </button>\n                        </div>\n\n                        ${this.createToolResultFromToolCall(toolCall)}\n                    </div>\n                </div>\n            `;\n\n            // Create collapsible JSON section\n            const toolCallData = {\n                toolCall: toolCall,\n                preEvent: preEvent,\n                postEvent: postEvent\n            };\n            const collapsibleJsonSection = this.createCollapsibleJsonSection(toolCallData);\n\n            if (this.dataContainer) {\n                this.dataContainer.innerHTML = contextualHeader + content + collapsibleJsonSection;\n            }\n\n            // Initialize JSON toggle functionality\n            this.initializeJsonToggle();\n        } else {\n            // For other tools, show detailed information\n            const content = `\n                <div class=\"structured-view-section\">\n                    <div class=\"tool-call-details\">\n                        <div class=\"tool-call-info ${statusClass}\">\n                            <div class=\"structured-field\">\n                                <strong>Tool Name:</strong> ${toolName}\n                            </div>\n                            <div class=\"structured-field\">\n                                <strong>Agent:</strong> ${agentName}\n                            </div>\n                            <div class=\"structured-field\">\n                                <strong>Status:</strong> ${statusIcon} ${statusText}\n                            </div>\n                            <div class=\"structured-field\">\n                                <strong>Target:</strong> ${target}\n                            </div>\n                            <div class=\"structured-field\">\n                                <strong>Started:</strong> ${new Date(toolCall.timestamp).toLocaleString()}\n                            </div>\n                            ${duration && duration !== '-' ? `\n                                <div class=\"structured-field\">\n                                    <strong>Duration:</strong> ${duration}\n                                </div>\n                            ` : ''}\n                            ${toolCall.session_id ? `\n                                <div class=\"structured-field\">\n                                    <strong>Session ID:</strong> ${toolCall.session_id}\n                                </div>\n                            ` : ''}\n                        </div>\n\n                        ${this.createToolResultFromToolCall(toolCall)}\n                    </div>\n                </div>\n            `;\n\n            // Create collapsible JSON section\n            const toolCallData = {\n                toolCall: toolCall,\n                preEvent: preEvent,\n                postEvent: postEvent\n            };\n            const collapsibleJsonSection = this.createCollapsibleJsonSection(toolCallData);\n\n            if (this.dataContainer) {\n                this.dataContainer.innerHTML = contextualHeader + content + collapsibleJsonSection;\n            }\n\n            // Initialize JSON toggle functionality\n            this.initializeJsonToggle();\n        }\n\n        // Hide JSON pane since data is integrated above\n        // JSON container no longer exists - handled via collapsible sections\n    }\n\n    /**\n     * Show file operations details (backward compatibility method)\n     * @param {Object} fileData - The file operations data\n     * @param {string} filePath - The file path\n     */\n    showFileOperations(fileData, filePath) {\n        if (!fileData || !filePath) {\n            this.showEmptyState();\n            return;\n        }\n\n        // Get file name from path for header\n        const fileName = filePath.split('/').pop() || filePath;\n        const operations = fileData.operations || [];\n        const lastOp = operations[operations.length - 1];\n        const headerTimestamp = lastOp ? this.formatTimestamp(lastOp.timestamp) : '';\n\n        // Create contextual header\n        const contextualHeader = `\n            <div class=\"contextual-header\">\n                <h3 class=\"contextual-header-text\">File: ${fileName} ${headerTimestamp}</h3>\n            </div>\n        `;\n\n        const content = `\n            <div class=\"structured-view-section\">\n                <div class=\"file-details\">\n                    <div class=\"file-path-display\">\n                        <strong>Full Path:</strong> ${this.createClickableFilePath(filePath)}\n                        <div id=\"git-track-status-${filePath.replace(/[^a-zA-Z0-9]/g, '-')}\" class=\"git-track-status\" style=\"margin-top: 8px;\">\n                            <!-- Git tracking status will be populated here -->\n                        </div>\n                    </div>\n                    <div class=\"operations-list\">\n                        ${operations.map(op => `\n                            <div class=\"operation-item\">\n                                <div class=\"operation-header\">\n                                    <span class=\"operation-icon\">${this.getOperationIcon(op.operation)}</span>\n                                    <span class=\"operation-type\">${op.operation}</span>\n                                    <span class=\"operation-timestamp\">${new Date(op.timestamp).toLocaleString()}</span>\n                                    ${this.isReadOnlyOperation(op.operation) ? `\n                                        <!-- Read-only operation: show only file viewer -->\n                                        <span class=\"file-viewer-icon\"\n                                              onclick=\"showFileViewerModal('${filePath}')\"\n                                              title=\"View file contents with syntax highlighting\"\n                                              style=\"margin-left: 8px; cursor: pointer; font-size: 16px;\">\n                                            👁️\n                                        </span>\n                                    ` : `\n                                        <!-- Edit operation: show both file viewer and git diff -->\n                                        <span class=\"file-viewer-icon\"\n                                              onclick=\"showFileViewerModal('${filePath}')\"\n                                              title=\"View file contents with syntax highlighting\"\n                                              style=\"margin-left: 8px; cursor: pointer; font-size: 16px;\">\n                                            👁️\n                                        </span>\n                                        <span class=\"git-diff-icon\"\n                                              onclick=\"showGitDiffModal('${filePath}', '${op.timestamp}')\"\n                                              title=\"View git diff for this file operation\"\n                                              style=\"margin-left: 8px; cursor: pointer; font-size: 16px; display: none;\"\n                                              data-file-path=\"${filePath}\"\n                                              data-operation-timestamp=\"${op.timestamp}\">\n                                            📋\n                                        </span>\n                                    `}\n                                </div>\n                                <div class=\"operation-details\">\n                                    <strong>Agent:</strong> ${op.agent}<br>\n                                    <strong>Session:</strong> ${op.sessionId ? op.sessionId.substring(0, 8) + '...' : 'Unknown'}\n                                    ${op.details ? this.formatOperationDetails(op.details) : ''}\n                                </div>\n                            </div>\n                        `).join('')}\n                    </div>\n                </div>\n            </div>\n        `;\n\n        // Check git tracking status and show track control if needed\n        this.checkAndShowTrackControl(filePath);\n\n        // Check git status and conditionally show git diff icons\n        this.checkAndShowGitDiffIcons(filePath);\n\n        // Create collapsible JSON section for file data\n        const collapsibleJsonSection = this.createCollapsibleJsonSection(fileData);\n\n        // Show structured data with JSON section in data pane\n        if (this.dataContainer) {\n            this.dataContainer.innerHTML = contextualHeader + content + collapsibleJsonSection;\n        }\n\n        // Initialize JSON toggle functionality\n        this.initializeJsonToggle();\n\n        // Hide JSON pane since data is integrated above\n        // JSON container no longer exists - handled via collapsible sections\n    }\n\n    /**\n     * Show error message (backward compatibility method)\n     * @param {string} title - Error title\n     * @param {string} message - Error message\n     */\n    showErrorMessage(title, message) {\n        const content = `\n            <div class=\"module-error\">\n                <div class=\"error-header\">\n                    <h3>❌ ${title}</h3>\n                </div>\n                <div class=\"error-message\">\n                    <p>${message}</p>\n                </div>\n            </div>\n        `;\n\n        // Create collapsible JSON section for error data\n        const errorData = { title, message };\n        const collapsibleJsonSection = this.createCollapsibleJsonSection(errorData);\n\n        if (this.dataContainer) {\n            this.dataContainer.innerHTML = content + collapsibleJsonSection;\n        }\n\n        // Initialize JSON toggle functionality\n        this.initializeJsonToggle();\n\n        // JSON container no longer exists - handled via collapsible sections\n    }\n\n    /**\n     * Show agent event details (backward compatibility method)\n     * @param {Object} event - The agent event\n     * @param {number} index - Event index\n     */\n    showAgentEvent(event, index) {\n        // Show comprehensive agent-specific data instead of just single event\n        this.showAgentSpecificDetails(event, index);\n    }\n\n    /**\n     * Show comprehensive agent-specific details including prompt, todos, and tools\n     * @param {Object} event - The selected agent event\n     * @param {number} index - Event index\n     */\n    showAgentSpecificDetails(event, index) {\n        if (!event) {\n            this.showEmptyState();\n            return;\n        }\n\n        // Get agent inference to determine which agent this is\n        const agentInference = window.dashboard?.agentInference;\n        const eventViewer = window.dashboard?.eventViewer;\n\n        if (!agentInference || !eventViewer) {\n            console.warn('AgentInference or EventViewer not available, falling back to single event view');\n            this.showEventDetails(event);\n            return;\n        }\n\n        const inference = agentInference.getInferredAgentForEvent(event);\n        const agentName = inference?.agentName || this.extractAgent(event) || 'Unknown';\n\n        // Get all events from this agent\n        const allEvents = eventViewer.events || [];\n        const agentEvents = this.getAgentSpecificEvents(allEvents, agentName, agentInference);\n\n        console.log(`Showing details for agent: ${agentName}, found ${agentEvents.length} related events`);\n\n        // Extract agent-specific data\n        const agentData = this.extractAgentSpecificData(agentName, agentEvents);\n\n        // Render agent-specific view\n        this.renderAgentSpecificView(agentName, agentData, event);\n    }\n\n    /**\n     * Get all events related to a specific agent\n     * @param {Array} allEvents - All events\n     * @param {string} agentName - Name of the agent to filter for\n     * @param {Object} agentInference - Agent inference system\n     * @returns {Array} - Events related to this agent\n     */\n    getAgentSpecificEvents(allEvents, agentName, agentInference) {\n        return allEvents.filter(event => {\n            // Use agent inference to determine if this event belongs to the agent\n            const inference = agentInference.getInferredAgentForEvent(event);\n            const eventAgentName = inference?.agentName || this.extractAgent(event) || 'Unknown';\n\n            // Match agent names (case insensitive)\n            return eventAgentName.toLowerCase() === agentName.toLowerCase();\n        });\n    }\n\n    /**\n     * Extract agent-specific data from events\n     * @param {string} agentName - Name of the agent\n     * @param {Array} agentEvents - Events from this agent\n     * @returns {Object} - Extracted agent data\n     */\n    extractAgentSpecificData(agentName, agentEvents) {\n        const data = {\n            agentName: agentName,\n            totalEvents: agentEvents.length,\n            prompt: null,\n            todos: [],\n            toolsCalled: [],\n            sessions: new Set(),\n            firstSeen: null,\n            lastSeen: null,\n            eventTypes: new Set()\n        };\n\n        agentEvents.forEach(event => {\n            const eventData = event.data || {};\n            const timestamp = new Date(event.timestamp);\n\n            // Track timing\n            if (!data.firstSeen || timestamp < data.firstSeen) {\n                data.firstSeen = timestamp;\n            }\n            if (!data.lastSeen || timestamp > data.lastSeen) {\n                data.lastSeen = timestamp;\n            }\n\n            // Track sessions\n            if (event.session_id || eventData.session_id) {\n                data.sessions.add(event.session_id || eventData.session_id);\n            }\n\n            // Track event types\n            const eventType = event.hook_event_name || event.type || 'unknown';\n            data.eventTypes.add(eventType);\n\n            // Extract prompt from Task delegation events\n            if (event.type === 'hook' && eventData.tool_name === 'Task' && eventData.tool_parameters) {\n                const taskParams = eventData.tool_parameters;\n                if (taskParams.prompt && !data.prompt) {\n                    data.prompt = taskParams.prompt;\n                }\n                if (taskParams.description && !data.description) {\n                    data.description = taskParams.description;\n                }\n                if (taskParams.subagent_type === agentName && taskParams.prompt) {\n                    // Prefer prompts that match the specific agent\n                    data.prompt = taskParams.prompt;\n                }\n            }\n\n            // Also check for agent-specific prompts in other event types\n            if (eventData.prompt && (eventData.agent_type === agentName || eventData.subagent_type === agentName)) {\n                data.prompt = eventData.prompt;\n            }\n\n            // Extract todos from TodoWrite events\n            if (event.type === 'todo' || (event.type === 'hook' && eventData.tool_name === 'TodoWrite')) {\n                const todos = eventData.todos || eventData.tool_parameters?.todos;\n                if (todos && Array.isArray(todos)) {\n                    // Merge todos, keeping the most recent status for each\n                    todos.forEach(todo => {\n                        const existingIndex = data.todos.findIndex(t => t.id === todo.id || t.content === todo.content);\n                        if (existingIndex >= 0) {\n                            // Update existing todo with newer data\n                            data.todos[existingIndex] = { ...data.todos[existingIndex], ...todo, timestamp };\n                        } else {\n                            // Add new todo\n                            data.todos.push({ ...todo, timestamp });\n                        }\n                    });\n                }\n            }\n\n            // Extract tool calls - collect pre and post events separately first\n            if (event.type === 'hook' && eventData.tool_name) {\n                const phase = event.subtype || eventData.event_type;\n                const toolCallId = this.generateToolCallId(eventData.tool_name, eventData.tool_parameters, timestamp);\n\n                if (phase === 'pre_tool') {\n                    // Store pre-tool event data\n                    if (!data._preToolEvents) data._preToolEvents = new Map();\n                    data._preToolEvents.set(toolCallId, {\n                        toolName: eventData.tool_name,\n                        timestamp: timestamp,\n                        target: this.extractToolTarget(eventData.tool_name, eventData.tool_parameters, null),\n                        parameters: eventData.tool_parameters\n                    });\n                } else if (phase === 'post_tool') {\n                    // Store post-tool event data\n                    if (!data._postToolEvents) data._postToolEvents = new Map();\n                    data._postToolEvents.set(toolCallId, {\n                        toolName: eventData.tool_name,\n                        timestamp: timestamp,\n                        success: eventData.success,\n                        duration: eventData.duration_ms,\n                        resultSummary: eventData.result_summary,\n                        exitCode: eventData.exit_code\n                    });\n                }\n            }\n        });\n\n        // Sort todos by timestamp (most recent first)\n        data.todos.sort((a, b) => (b.timestamp || 0) - (a.timestamp || 0));\n\n        // Consolidate pre and post tool events into single tool calls\n        data.toolsCalled = this.consolidateToolCalls(data._preToolEvents, data._postToolEvents);\n\n        // Clean up temporary data\n        delete data._preToolEvents;\n        delete data._postToolEvents;\n\n        // Sort tools by timestamp (most recent first)\n        data.toolsCalled.sort((a, b) => b.timestamp - a.timestamp);\n\n        return data;\n    }\n\n    /**\n     * Generate a unique ID for a tool call to match pre and post events\n     * @param {string} toolName - Name of the tool\n     * @param {Object} parameters - Tool parameters\n     * @param {Date} timestamp - Timestamp of the event\n     * @returns {string} - Unique tool call ID\n     */\n    generateToolCallId(toolName, parameters, timestamp) {\n        // Create a unique identifier based on tool name, key parameters, and approximate timestamp\n        // Use a wider time window to account for timing differences between pre/post events\n        const timeWindow = Math.floor(timestamp.getTime() / 5000); // Group by 5-second windows\n\n        // Include key parameters that uniquely identify a tool call\n        let paramKey = '';\n        if (parameters) {\n            // Include important parameters that distinguish tool calls\n            const keyParams = [];\n            if (parameters.file_path) keyParams.push(parameters.file_path);\n            if (parameters.command) keyParams.push(parameters.command.substring(0, 50));\n            if (parameters.pattern) keyParams.push(parameters.pattern);\n            if (parameters.subagent_type) keyParams.push(parameters.subagent_type);\n            if (parameters.notebook_path) keyParams.push(parameters.notebook_path);\n            if (parameters.url) keyParams.push(parameters.url);\n            if (parameters.prompt) keyParams.push(parameters.prompt.substring(0, 30));\n\n            paramKey = keyParams.join('|');\n        }\n\n        // If no specific parameters, use just tool name and time window\n        if (!paramKey) {\n            paramKey = 'default';\n        }\n\n        return `${toolName}:${timeWindow}:${paramKey}`;\n    }\n\n    /**\n     * Consolidate pre and post tool events into single consolidated tool calls\n     * @param {Map} preToolEvents - Map of pre-tool events by tool call ID\n     * @param {Map} postToolEvents - Map of post-tool events by tool call ID\n     * @returns {Array} - Array of consolidated tool calls\n     */\n    consolidateToolCalls(preToolEvents, postToolEvents) {\n        const consolidatedCalls = [];\n        const processedIds = new Set();\n\n        if (!preToolEvents) preToolEvents = new Map();\n        if (!postToolEvents) postToolEvents = new Map();\n\n        // Process all pre-tool events first\n        for (const [toolCallId, preEvent] of preToolEvents) {\n            if (processedIds.has(toolCallId)) continue;\n\n            const postEvent = postToolEvents.get(toolCallId);\n\n            // Create consolidated tool call\n            const consolidatedCall = {\n                toolName: preEvent.toolName,\n                timestamp: preEvent.timestamp, // Use pre-tool timestamp as the start time\n                target: preEvent.target,\n                parameters: preEvent.parameters,\n                status: this.determineToolCallStatus(preEvent, postEvent),\n                statusIcon: this.getToolCallStatusIcon(preEvent, postEvent),\n                phase: postEvent ? 'completed' : 'running'\n            };\n\n            // Add post-event data if available\n            if (postEvent) {\n                consolidatedCall.success = postEvent.success;\n                consolidatedCall.duration = postEvent.duration;\n                consolidatedCall.resultSummary = postEvent.resultSummary;\n                consolidatedCall.exitCode = postEvent.exitCode;\n                consolidatedCall.completedAt = postEvent.timestamp;\n            }\n\n            consolidatedCalls.push(consolidatedCall);\n            processedIds.add(toolCallId);\n        }\n\n        // Process any post-tool events that don't have matching pre-tool events (edge case)\n        for (const [toolCallId, postEvent] of postToolEvents) {\n            if (processedIds.has(toolCallId)) continue;\n\n            // This is a post-tool event without a corresponding pre-tool event\n            const consolidatedCall = {\n                toolName: postEvent.toolName,\n                timestamp: postEvent.timestamp,\n                target: 'Unknown target', // We don't have pre-event data\n                parameters: null,\n                status: this.determineToolCallStatus(null, postEvent),\n                statusIcon: this.getToolCallStatusIcon(null, postEvent),\n                phase: 'completed',\n                success: postEvent.success,\n                duration: postEvent.duration,\n                resultSummary: postEvent.resultSummary,\n                exitCode: postEvent.exitCode,\n                completedAt: postEvent.timestamp\n            };\n\n            consolidatedCalls.push(consolidatedCall);\n            processedIds.add(toolCallId);\n        }\n\n        return consolidatedCalls;\n    }\n\n    /**\n     * Determine the status of a tool call based on pre and post events\n     * @param {Object} preEvent - Pre-tool event data\n     * @param {Object} postEvent - Post-tool event data\n     * @returns {string} - Status text\n     */\n    determineToolCallStatus(preEvent, postEvent) {\n        if (!postEvent) {\n            return 'Running...';\n        }\n\n        if (postEvent.success === true) {\n            return 'Success';\n        } else if (postEvent.success === false) {\n            return 'Failed';\n        } else if (postEvent.exitCode === 0) {\n            return 'Completed';\n        } else if (postEvent.exitCode === 2) {\n            return 'Blocked';\n        } else if (postEvent.exitCode !== undefined && postEvent.exitCode !== 0) {\n            return 'Error';\n        }\n\n        return 'Completed';\n    }\n\n    /**\n     * Get the status icon for a tool call\n     * @param {Object} preEvent - Pre-tool event data\n     * @param {Object} postEvent - Post-tool event data\n     * @returns {string} - Status icon\n     */\n    getToolCallStatusIcon(preEvent, postEvent) {\n        if (!postEvent) {\n            return '⏳'; // Still running\n        }\n\n        if (postEvent.success === true) {\n            return '✅'; // Success\n        } else if (postEvent.success === false) {\n            return '❌'; // Failed\n        } else if (postEvent.exitCode === 0) {\n            return '✅'; // Completed successfully\n        } else if (postEvent.exitCode === 2) {\n            return '⚠️'; // Blocked\n        } else if (postEvent.exitCode !== undefined && postEvent.exitCode !== 0) {\n            return '❌'; // Error\n        }\n\n        return '✅'; // Default to success for completed calls\n    }\n\n    /**\n     * Estimate token count for text using a simple approximation\n     * @param {string} text - Text to estimate tokens for\n     * @returns {number} - Estimated token count\n     */\n    estimateTokenCount(text) {\n        if (!text || typeof text !== 'string') return 0;\n\n        // Simple token estimation: words * 1.3 (accounts for subwords)\n        // Alternative: characters / 4 (common rule of thumb)\n        const wordCount = text.trim().split(/\\s+/).length;\n        const charBasedEstimate = Math.ceil(text.length / 4);\n\n        // Use the higher of the two estimates for safety\n        return Math.max(wordCount * 1.3, charBasedEstimate);\n    }\n\n    /**\n     * Trim excessive whitespace from text while preserving structure\n     * @param {string} text - Text to trim\n     * @returns {string} - Trimmed text\n     */\n    trimPromptWhitespace(text) {\n        if (!text || typeof text !== 'string') return '';\n\n        // Remove leading/trailing whitespace from the entire text\n        text = text.trim();\n\n        // Reduce multiple consecutive newlines to maximum of 2\n        text = text.replace(/\\n\\s*\\n\\s*\\n+/g, '\\n\\n');\n\n        // Trim whitespace from each line while preserving intentional indentation\n        text = text.split('\\n').map(line => {\n            // Only trim trailing whitespace, preserve leading whitespace for structure\n            return line.replace(/\\s+$/, '');\n        }).join('\\n');\n\n        return text;\n    }\n\n    /**\n     * Render agent-specific view with comprehensive data\n     * @param {string} agentName - Name of the agent\n     * @param {Object} agentData - Extracted agent data\n     * @param {Object} originalEvent - The original clicked event\n     */\n    renderAgentSpecificView(agentName, agentData, originalEvent) {\n        // Create contextual header\n        const timestamp = this.formatTimestamp(originalEvent.timestamp);\n        const contextualHeader = `\n            <div class=\"contextual-header\">\n                <h3 class=\"contextual-header-text\">🤖 ${agentName} Agent Details ${timestamp}</h3>\n            </div>\n        `;\n\n        // Build comprehensive agent view\n        let content = `\n            <div class=\"agent-overview-section\">\n                <div class=\"structured-data\">\n                    ${this.createProperty('Agent Name', agentName)}\n                    ${this.createProperty('Total Events', agentData.totalEvents)}\n                    ${this.createProperty('Active Sessions', agentData.sessions.size)}\n                    ${this.createProperty('Event Types', Array.from(agentData.eventTypes).join(', '))}\n                    ${agentData.firstSeen ? this.createProperty('First Seen', agentData.firstSeen.toLocaleString()) : ''}\n                    ${agentData.lastSeen ? this.createProperty('Last Seen', agentData.lastSeen.toLocaleString()) : ''}\n                </div>\n            </div>\n        `;\n\n        // Add prompt section if available\n        if (agentData.prompt) {\n            const trimmedPrompt = this.trimPromptWhitespace(agentData.prompt);\n            const tokenCount = Math.round(this.estimateTokenCount(trimmedPrompt));\n            const wordCount = trimmedPrompt.trim().split(/\\s+/).length;\n\n            content += `\n                <div class=\"agent-prompt-section\">\n                    <div class=\"contextual-header\">\n                        <h3 class=\"contextual-header-text\">📝 Agent Task Prompt</h3>\n                        <div class=\"prompt-stats\" style=\"font-size: 11px; color: #64748b; margin-top: 4px;\">\n                            ~${tokenCount} tokens • ${wordCount} words • ${trimmedPrompt.length} characters\n                        </div>\n                    </div>\n                    <div class=\"structured-data\">\n                        <div class=\"agent-prompt\" style=\"white-space: pre-wrap; max-height: 300px; overflow-y: auto; padding: 10px; background: #f8fafc; border-radius: 6px; font-family: monospace; font-size: 12px; line-height: 1.4; border: 1px solid #e2e8f0;\">\n                            ${this.escapeHtml(trimmedPrompt)}\n                        </div>\n                    </div>\n                </div>\n            `;\n        }\n\n        // Add todos section if available\n        if (agentData.todos.length > 0) {\n            content += `\n                <div class=\"agent-todos-section\">\n                    <div class=\"contextual-header\">\n                        <h3 class=\"contextual-header-text\">✅ Agent Todo List (${agentData.todos.length} items)</h3>\n                    </div>\n                    <div class=\"todo-checklist\">\n                        ${agentData.todos.map(todo => `\n                            <div class=\"todo-item todo-${todo.status || 'pending'}\">\n                                <span class=\"todo-status\">${this.getTodoStatusIcon(todo.status)}</span>\n                                <span class=\"todo-content\">${todo.content || 'No content'}</span>\n                                <span class=\"todo-priority priority-${todo.priority || 'medium'}\">${this.getTodoPriorityIcon(todo.priority)}</span>\n                                ${todo.timestamp ? `<span class=\"todo-timestamp\">${new Date(todo.timestamp).toLocaleTimeString()}</span>` : ''}\n                            </div>\n                        `).join('')}\n                    </div>\n                </div>\n            `;\n        }\n\n        // Add tools section if available\n        if (agentData.toolsCalled.length > 0) {\n            content += `\n                <div class=\"agent-tools-section\">\n                    <div class=\"contextual-header\">\n                        <h3 class=\"contextual-header-text\">🔧 Tools Called by Agent (${agentData.toolsCalled.length} calls)</h3>\n                    </div>\n                    <div class=\"tools-list\">\n                        ${agentData.toolsCalled.map(tool => {\n                            // Determine CSS class for status\n                            let statusClass = '';\n                            if (tool.statusIcon === '✅') statusClass = 'status-success';\n                            else if (tool.statusIcon === '❌') statusClass = 'status-failed';\n                            else if (tool.statusIcon === '⚠️') statusClass = 'status-blocked';\n                            else if (tool.statusIcon === '⏳') statusClass = 'status-running';\n\n                            return `\n                                <div class=\"tool-call-item\">\n                                    <div class=\"tool-call-header\">\n                                        <div style=\"display: flex; align-items: center; gap: 12px; flex: 1;\">\n                                            <span class=\"tool-name\">🔧 ${tool.toolName}</span>\n                                            <span class=\"tool-agent\">${agentName}</span>\n                                            <span class=\"tool-status-indicator ${statusClass}\">${tool.statusIcon} ${tool.status}</span>\n                                        </div>\n                                        <span class=\"tool-timestamp\" style=\"margin-left: auto;\">${tool.timestamp.toLocaleTimeString()}</span>\n                                    </div>\n                                    <div class=\"tool-call-details\">\n                                        ${tool.target ? `<span class=\"tool-target\">Target: ${tool.target}</span>` : ''}\n                                        ${tool.duration ? `<span class=\"tool-duration\">Duration: ${tool.duration}ms</span>` : ''}\n                                        ${tool.completedAt && tool.completedAt !== tool.timestamp ? `<span class=\"tool-completed\">Completed: ${tool.completedAt.toLocaleTimeString()}</span>` : ''}\n                                    </div>\n                                </div>\n                            `;\n                        }).join('')}\n                    </div>\n                </div>\n            `;\n        }\n\n        // Create collapsible JSON section for agent data\n        const agentJsonData = {\n            agentName: agentName,\n            agentData: agentData,\n            originalEvent: originalEvent\n        };\n        const collapsibleJsonSection = this.createCollapsibleJsonSection(agentJsonData);\n\n        // Show structured data with JSON section in data pane\n        if (this.dataContainer) {\n            this.dataContainer.innerHTML = contextualHeader + content + collapsibleJsonSection;\n        }\n\n        // Initialize JSON toggle functionality\n        this.initializeJsonToggle();\n\n        // Hide JSON pane since data is integrated above\n        // JSON container no longer exists - handled via collapsible sections\n    }\n\n    /**\n     * Create tool result section for backward compatibility with showToolCall method\n     * @param {Object} toolCall - Tool call data\n     * @returns {string} HTML content for tool result section\n     */\n    createToolResultFromToolCall(toolCall) {\n        // Check if we have result data\n        if (!toolCall.result_summary) {\n            return '';\n        }\n\n        // Convert toolCall data to match the format expected by createInlineToolResultContent\n        const mockData = {\n            event_type: 'post_tool',\n            result_summary: toolCall.result_summary,\n            success: toolCall.success,\n            exit_code: toolCall.exit_code\n        };\n\n        // Create a mock event object with proper subtype\n        const mockEvent = {\n            subtype: 'post_tool'\n        };\n\n        // Get inline result content\n        const inlineContent = this.createInlineToolResultContent(mockData, mockEvent);\n\n        // If we have content, wrap it in a simple section\n        if (inlineContent.trim()) {\n            return `\n                <div class=\"tool-result-inline\">\n                    <div class=\"structured-data\">\n                        ${inlineContent}\n                    </div>\n                </div>\n            `;\n        }\n\n        return '';\n    }\n\n    /**\n     * Extract tool target from tool name and parameters\n     * @param {string} toolName - Name of the tool\n     * @param {Object} parameters - Tool parameters\n     * @param {Object} altParameters - Alternative parameters\n     * @returns {string} - Tool target description\n     */\n    extractToolTarget(toolName, parameters, altParameters) {\n        const params = parameters || altParameters || {};\n\n        switch (toolName?.toLowerCase()) {\n            case 'write':\n            case 'read':\n            case 'edit':\n            case 'multiedit':\n                return params.file_path || 'Unknown file';\n            case 'bash':\n                return params.command ? `${params.command.substring(0, 50)}${params.command.length > 50 ? '...' : ''}` : 'Unknown command';\n            case 'grep':\n                return params.pattern ? `Pattern: ${params.pattern}` : 'Unknown pattern';\n            case 'glob':\n                return params.pattern ? `Pattern: ${params.pattern}` : 'Unknown glob';\n            case 'todowrite':\n                return `${params.todos?.length || 0} todos`;\n            case 'task':\n                return params.subagent_type || params.agent_type || 'Subagent delegation';\n            default:\n                // Try to find a meaningful parameter\n                if (params.file_path) return params.file_path;\n                if (params.pattern) return `Pattern: ${params.pattern}`;\n                if (params.command) return `Command: ${params.command.substring(0, 30)}...`;\n                if (params.path) return params.path;\n                return 'Unknown target';\n        }\n    }\n\n\n    /**\n     * Get operation icon for file operations\n     * @param {string} operation - Operation type\n     * @returns {string} - Icon for the operation\n     */\n    getOperationIcon(operation) {\n        const icons = {\n            'read': '👁️',\n            'write': '✏️',\n            'edit': '📝',\n            'multiedit': '📝',\n            'create': '🆕',\n            'delete': '🗑️',\n            'move': '📦',\n            'copy': '📋'\n        };\n        return icons[operation?.toLowerCase()] || '📄';\n    }\n\n    /**\n     * Get current event\n     */\n    getCurrentEvent() {\n        return this.currentEvent;\n    }\n\n    /**\n     * Check git tracking status and show track control if needed\n     * @param {string} filePath - Path to the file to check\n     */\n    async checkAndShowTrackControl(filePath) {\n        if (!filePath) return;\n\n        try {\n            // Get the Socket.IO client\n            const socket = window.socket || window.dashboard?.socketClient?.socket;\n            if (!socket) {\n                console.warn('No socket connection available for git tracking check');\n                return;\n            }\n\n            // Get working directory from dashboard with proper fallback\n            let workingDir = window.dashboard?.currentWorkingDir;\n\n            // Don't use 'Unknown' as a working directory\n            if (!workingDir || workingDir === 'Unknown' || workingDir.trim() === '') {\n                // Try to get from footer element\n                const footerDir = document.getElementById('footer-working-dir');\n                if (footerDir?.textContent?.trim() && footerDir.textContent.trim() !== 'Unknown') {\n                    workingDir = footerDir.textContent.trim();\n                } else {\n                    // Final fallback to current directory\n                    workingDir = '.';\n                }\n                console.log('[MODULE-VIEWER-DEBUG] Working directory fallback used:', workingDir);\n            }\n\n            // Set up one-time listener for tracking status response\n            const responsePromise = new Promise((resolve, reject) => {\n                const responseHandler = (data) => {\n                    if (data.file_path === filePath) {\n                        socket.off('file_tracked_response', responseHandler);\n                        resolve(data);\n                    }\n                };\n\n                socket.on('file_tracked_response', responseHandler);\n\n                // Timeout after 5 seconds\n                setTimeout(() => {\n                    socket.off('file_tracked_response', responseHandler);\n                    reject(new Error('Request timeout'));\n                }, 5000);\n            });\n\n            // Send tracking status request\n            socket.emit('check_file_tracked', {\n                file_path: filePath,\n                working_dir: workingDir\n            });\n\n            // Wait for response\n            const result = await responsePromise;\n            this.displayTrackingStatus(filePath, result);\n\n        } catch (error) {\n            console.error('Error checking file tracking status:', error);\n            this.displayTrackingStatus(filePath, {\n                success: false,\n                error: error.message,\n                file_path: filePath\n            });\n        }\n    }\n\n    /**\n     * Display tracking status and show track control if needed\n     * @param {string} filePath - Path to the file\n     * @param {Object} result - Result from tracking status check\n     */\n    displayTrackingStatus(filePath, result) {\n        const statusElementId = `git-track-status-${filePath.replace(/[^a-zA-Z0-9]/g, '-')}`;\n        const statusElement = document.getElementById(statusElementId);\n\n        if (!statusElement) return;\n\n        if (result.success && result.is_tracked === false) {\n            // File is not tracked - show track button\n            statusElement.innerHTML = `\n                <div class=\"untracked-file-notice\">\n                    <span class=\"untracked-icon\">⚠️</span>\n                    <span class=\"untracked-text\">This file is not tracked by git</span>\n                    <button class=\"track-file-button\"\n                            onclick=\"window.moduleViewer.trackFile('${filePath}')\"\n                            title=\"Add this file to git tracking\">\n                        <span class=\"git-icon\">📁</span> Track File\n                    </button>\n                </div>\n            `;\n        } else if (result.success && result.is_tracked === true) {\n            // File is tracked - show status\n            statusElement.innerHTML = `\n                <div class=\"tracked-file-notice\">\n                    <span class=\"tracked-icon\">✅</span>\n                    <span class=\"tracked-text\">This file is tracked by git</span>\n                </div>\n            `;\n        } else if (!result.success) {\n            // Error checking status\n            statusElement.innerHTML = `\n                <div class=\"tracking-error-notice\">\n                    <span class=\"error-icon\">❌</span>\n                    <span class=\"error-text\">Could not check git status: ${result.error || 'Unknown error'}</span>\n                </div>\n            `;\n        }\n    }\n\n    /**\n     * Track a file using git add\n     * @param {string} filePath - Path to the file to track\n     */\n    async trackFile(filePath) {\n        if (!filePath) return;\n\n        try {\n            // Get the Socket.IO client\n            const socket = window.socket || window.dashboard?.socketClient?.socket;\n            if (!socket) {\n                console.warn('No socket connection available for git add');\n                return;\n            }\n\n            // Get working directory from dashboard with proper fallback\n            let workingDir = window.dashboard?.currentWorkingDir;\n\n            // Don't use 'Unknown' as a working directory\n            if (!workingDir || workingDir === 'Unknown' || workingDir.trim() === '') {\n                // Try to get from footer element\n                const footerDir = document.getElementById('footer-working-dir');\n                if (footerDir?.textContent?.trim() && footerDir.textContent.trim() !== 'Unknown') {\n                    workingDir = footerDir.textContent.trim();\n                } else {\n                    // Final fallback to current directory\n                    workingDir = '.';\n                }\n                console.log('[MODULE-VIEWER-DEBUG] Working directory fallback used:', workingDir);\n            }\n\n            // Update button to show loading state\n            const statusElementId = `git-track-status-${filePath.replace(/[^a-zA-Z0-9]/g, '-')}`;\n            const statusElement = document.getElementById(statusElementId);\n\n            if (statusElement) {\n                statusElement.innerHTML = `\n                    <div class=\"tracking-file-notice\">\n                        <span class=\"loading-icon\">⏳</span>\n                        <span class=\"loading-text\">Adding file to git tracking...</span>\n                    </div>\n                `;\n            }\n\n            // Set up one-time listener for git add response\n            const responsePromise = new Promise((resolve, reject) => {\n                const responseHandler = (data) => {\n                    if (data.file_path === filePath) {\n                        socket.off('git_add_response', responseHandler);\n                        resolve(data);\n                    }\n                };\n\n                socket.on('git_add_response', responseHandler);\n\n                // Timeout after 10 seconds\n                setTimeout(() => {\n                    socket.off('git_add_response', responseHandler);\n                    reject(new Error('Request timeout'));\n                }, 10000);\n            });\n\n            // Send git add request\n            socket.emit('git_add_file', {\n                file_path: filePath,\n                working_dir: workingDir\n            });\n\n            console.log('📁 Git add request sent:', {\n                filePath,\n                workingDir\n            });\n\n            // Wait for response\n            const result = await responsePromise;\n            console.log('📦 Git add result:', result);\n\n            // Update UI based on result\n            if (result.success) {\n                if (statusElement) {\n                    statusElement.innerHTML = `\n                        <div class=\"tracked-file-notice\">\n                            <span class=\"tracked-icon\">✅</span>\n                            <span class=\"tracked-text\">File successfully added to git tracking</span>\n                        </div>\n                    `;\n                }\n\n                // Show success notification\n                this.showNotification('File tracked successfully', 'success');\n            } else {\n                if (statusElement) {\n                    statusElement.innerHTML = `\n                        <div class=\"tracking-error-notice\">\n                            <span class=\"error-icon\">❌</span>\n                            <span class=\"error-text\">Failed to track file: ${result.error || 'Unknown error'}</span>\n                            <button class=\"track-file-button\"\n                                    onclick=\"window.moduleViewer.trackFile('${filePath}')\"\n                                    title=\"Try again\">\n                                <span class=\"git-icon\">📁</span> Retry\n                            </button>\n                        </div>\n                    `;\n                }\n\n                // Show error notification\n                this.showNotification(`Failed to track file: ${result.error}`, 'error');\n            }\n\n        } catch (error) {\n            console.error('❌ Failed to track file:', error);\n\n            // Update UI to show error\n            const statusElementId = `git-track-status-${filePath.replace(/[^a-zA-Z0-9]/g, '-')}`;\n            const statusElement = document.getElementById(statusElementId);\n\n            if (statusElement) {\n                statusElement.innerHTML = `\n                    <div class=\"tracking-error-notice\">\n                        <span class=\"error-icon\">❌</span>\n                        <span class=\"error-text\">Error: ${error.message}</span>\n                        <button class=\"track-file-button\"\n                                onclick=\"window.moduleViewer.trackFile('${filePath}')\"\n                                title=\"Try again\">\n                            <span class=\"git-icon\">📁</span> Retry\n                        </button>\n                    </div>\n                `;\n            }\n\n            // Show error notification\n            this.showNotification(`Error tracking file: ${error.message}`, 'error');\n        }\n    }\n\n    /**\n     * Check git status and conditionally show git diff icons\n     * Only shows git diff icons if git status check succeeds\n     * @param {string} filePath - Path to the file to check\n     */\n    async checkAndShowGitDiffIcons(filePath) {\n        if (!filePath) {\n            console.debug('[GIT-DIFF-ICONS] No filePath provided, skipping git diff icon check');\n            return;\n        }\n\n        console.debug('[GIT-DIFF-ICONS] Checking git diff icons for file:', filePath);\n\n        try {\n            // Get the Socket.IO client\n            const socket = window.socket || window.dashboard?.socketClient?.socket;\n            if (!socket) {\n                console.warn('[GIT-DIFF-ICONS] No socket connection available for git status check');\n                return;\n            }\n\n            console.debug('[GIT-DIFF-ICONS] Socket connection available, proceeding');\n\n            // Get working directory from dashboard with proper fallback\n            let workingDir = window.dashboard?.currentWorkingDir;\n\n            // Don't use 'Unknown' as a working directory\n            if (!workingDir || workingDir === 'Unknown' || workingDir.trim() === '') {\n                // Try to get from footer element\n                const footerDir = document.getElementById('footer-working-dir');\n                if (footerDir?.textContent?.trim() && footerDir.textContent.trim() !== 'Unknown') {\n                    workingDir = footerDir.textContent.trim();\n                } else {\n                    // Final fallback to current directory\n                    workingDir = '.';\n                }\n                console.log('[GIT-DIFF-ICONS] Working directory fallback used:', workingDir);\n            } else {\n                console.debug('[GIT-DIFF-ICONS] Using working directory:', workingDir);\n            }\n\n            // Set up one-time listener for git status response\n            const responsePromise = new Promise((resolve, reject) => {\n                const responseHandler = (data) => {\n                    console.debug('[GIT-DIFF-ICONS] Received git status response:', data);\n                    if (data.file_path === filePath) {\n                        socket.off('git_status_response', responseHandler);\n                        resolve(data);\n                    } else {\n                        console.debug('[GIT-DIFF-ICONS] Response for different file, ignoring:', data.file_path);\n                    }\n                };\n\n                socket.on('git_status_response', responseHandler);\n\n                // Timeout after 3 seconds\n                setTimeout(() => {\n                    socket.off('git_status_response', responseHandler);\n                    console.warn('[GIT-DIFF-ICONS] Timeout waiting for git status response');\n                    reject(new Error('Request timeout'));\n                }, 3000);\n            });\n\n            console.debug('[GIT-DIFF-ICONS] Sending check_git_status event');\n            // Send git status request\n            socket.emit('check_git_status', {\n                file_path: filePath,\n                working_dir: workingDir\n            });\n\n            // Wait for response\n            const result = await responsePromise;\n            console.debug('[GIT-DIFF-ICONS] Git status check result:', result);\n\n            // Only show git diff icons if git status check was successful\n            if (result.success) {\n                console.debug('[GIT-DIFF-ICONS] Git status check successful, showing icons for:', filePath);\n                this.showGitDiffIconsForFile(filePath);\n            } else {\n                console.debug('[GIT-DIFF-ICONS] Git status check failed, icons will remain hidden:', result.error);\n            }\n            // If git status fails, icons remain hidden (display: none)\n\n        } catch (error) {\n            console.warn('[GIT-DIFF-ICONS] Git status check failed, hiding git diff icons:', error.message);\n            // Icons remain hidden on error\n        }\n    }\n\n    /**\n     * Show git diff icons for a specific file after successful git status check\n     * @param {string} filePath - Path to the file\n     */\n    showGitDiffIconsForFile(filePath) {\n        console.debug('[GIT-DIFF-ICONS] Showing git diff icons for file:', filePath);\n\n        // Find all git diff icons for this file path and show them\n        const gitDiffIcons = document.querySelectorAll(`[data-file-path=\"${filePath}\"]`);\n        console.debug('[GIT-DIFF-ICONS] Found', gitDiffIcons.length, 'elements with matching file path');\n\n        let shownCount = 0;\n        gitDiffIcons.forEach((icon, index) => {\n            console.debug('[GIT-DIFF-ICONS] Processing element', index, ':', icon);\n            console.debug('[GIT-DIFF-ICONS] Element classes:', icon.classList.toString());\n\n            if (icon.classList.contains('git-diff-icon')) {\n                console.debug('[GIT-DIFF-ICONS] Setting display to inline for git-diff-icon');\n                icon.style.display = 'inline';\n                shownCount++;\n            } else {\n                console.debug('[GIT-DIFF-ICONS] Element is not a git-diff-icon, skipping');\n            }\n        });\n\n        console.debug('[GIT-DIFF-ICONS] Showed', shownCount, 'git diff icons for file:', filePath);\n    }\n\n    /**\n     * Show notification to user\n     * @param {string} message - Message to show\n     * @param {string} type - Type of notification (success, error, info)\n     */\n    showNotification(message, type = 'info') {\n        // Create notification element\n        const notification = document.createElement('div');\n        notification.className = `notification notification-${type}`;\n        notification.innerHTML = `\n            <span class=\"notification-icon\">${type === 'success' ? '✅' : type === 'error' ? '❌' : 'ℹ️'}</span>\n            <span class=\"notification-message\">${message}</span>\n        `;\n\n        // Style the notification\n        notification.style.cssText = `\n            position: fixed;\n            top: 20px;\n            right: 20px;\n            background: ${type === 'success' ? '#d4edda' : type === 'error' ? '#f8d7da' : '#d1ecf1'};\n            color: ${type === 'success' ? '#155724' : type === 'error' ? '#721c24' : '#0c5460'};\n            border: 1px solid ${type === 'success' ? '#c3e6cb' : type === 'error' ? '#f5c6cb' : '#bee5eb'};\n            border-radius: 6px;\n            padding: 12px 16px;\n            font-size: 14px;\n            font-weight: 500;\n            z-index: 2000;\n            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);\n            display: flex;\n            align-items: center;\n            gap: 8px;\n            max-width: 400px;\n            animation: slideIn 0.3s ease-out;\n        `;\n\n        // Add animation styles\n        const style = document.createElement('style');\n        style.textContent = `\n            @keyframes slideIn {\n                from { transform: translateX(100%); opacity: 0; }\n                to { transform: translateX(0); opacity: 1; }\n            }\n            @keyframes slideOut {\n                from { transform: translateX(0); opacity: 1; }\n                to { transform: translateX(100%); opacity: 0; }\n            }\n        `;\n        document.head.appendChild(style);\n\n        // Add to page\n        document.body.appendChild(notification);\n\n        // Remove after 5 seconds\n        setTimeout(() => {\n            notification.style.animation = 'slideOut 0.3s ease-in';\n            setTimeout(() => {\n                if (notification.parentNode) {\n                    notification.parentNode.removeChild(notification);\n                }\n                if (style.parentNode) {\n                    style.parentNode.removeChild(style);\n                }\n            }, 300);\n        }, 5000);\n    }\n\n    /**\n     * Show agent instance details for PM delegations\n     * @param {Object} instance - Agent instance from PM delegation\n     */\n    showAgentInstance(instance) {\n        if (!instance) {\n            this.showEmptyState();\n            return;\n        }\n\n        // Create a synthetic event object to work with existing showAgentSpecificDetails method\n        const syntheticEvent = {\n            type: 'pm_delegation',\n            subtype: instance.agentName,\n            agent_type: instance.agentName,\n            timestamp: instance.timestamp,\n            session_id: instance.sessionId,\n            metadata: {\n                delegation_type: 'explicit',\n                event_count: instance.agentEvents.length,\n                pm_call: instance.pmCall || null,\n                agent_events: instance.agentEvents\n            }\n        };\n\n        console.log('Showing PM delegation details:', instance);\n        this.showAgentSpecificDetails(syntheticEvent, 0);\n    }\n\n    /**\n     * Show implied agent details for agents without explicit PM delegation\n     * @param {Object} impliedInstance - Implied agent instance\n     */\n    showImpliedAgent(impliedInstance) {\n        if (!impliedInstance) {\n            this.showEmptyState();\n            return;\n        }\n\n        // Create a synthetic event object to work with existing showAgentSpecificDetails method\n        const syntheticEvent = {\n            type: 'implied_delegation',\n            subtype: impliedInstance.agentName,\n            agent_type: impliedInstance.agentName,\n            timestamp: impliedInstance.timestamp,\n            session_id: impliedInstance.sessionId,\n            metadata: {\n                delegation_type: 'implied',\n                event_count: impliedInstance.eventCount,\n                pm_call: null,\n                note: 'No explicit PM call found - inferred from agent activity'\n            }\n        };\n\n        console.log('Showing implied agent details:', impliedInstance);\n        this.showAgentSpecificDetails(syntheticEvent, 0);\n    }\n}\n\n// Export for global use\n// ES6 Module export\nexport { ModuleViewer };\nexport default ModuleViewer;\n\n// Backward compatibility - keep window export for non-module usage\nwindow.ModuleViewer = ModuleViewer;\n\n// Debug helper function for troubleshooting tool result display\nwindow.enableToolResultDebugging = function() {\n    window.DEBUG_TOOL_RESULTS = true;\n    console.log('🔧 Tool result debugging enabled. Click on tool events to see debug info.');\n};\n\nwindow.disableToolResultDebugging = function() {\n    window.DEBUG_TOOL_RESULTS = false;\n    console.log('🔧 Tool result debugging disabled.');\n};\n"],"names":["ModuleViewer","constructor","containerId","this","container","document","getElementById","dataContainer","jsonContainer","currentEvent","eventsByClass","Map","globalJsonExpanded","localStorage","getItem","keyboardListenerAdded","init","setupContainers","setupEventHandlers","showEmptyState","console","error","addEventListener","e","showEventDetails","detail","event","updateEventsByClass","events","innerHTML","renderStructuredData","renderJsonData","contextualHeader","createContextualHeader","structuredView","createEventStructuredView","collapsibleJsonSection","createCollapsibleJsonSection","initializeJsonToggle","ingest","eventData","Array","isArray","length","clear","forEach","eventClass","getEventClass","has","set","get","push","type","timestamp","formatTimestamp","data","headerText","toolName","extractToolName","agent","extractAgent","getHookDisplayName","agent_type","name","operation","subtype","fileName","extractFileName","eventCount","content","createEventDetailCard","createAgentStructuredView","tool_name","tool_parameters","subagent_type","createHookStructuredView","createTodoStructuredView","createMemoryStructuredView","createClaudeStructuredView","createSessionStructuredView","createGenericStructuredView","eventType","count","Date","toLocaleString","getEventIcon","createProperty","id","session_id","taskData","description","prompt","truncateText","working_directory","config","Object","keys","join","String","capabilities","result","filePath","extractFilePathFromHook","toolInfo","extractToolInfoFromHook","toolResultContent","createInlineToolResultContent","event_type","operation_type","duration_ms","resultSummary","result_summary","eventPhase","phase","isPostTool","includes","window","DEBUG_TOOL_RESULTS","log","hasResultSummary","eventSubtype","dataEventType","dataPhase","resultSummaryKeys","resultContent","has_output","output_preview","output_lines","has_error","error_preview","entries","filter","key","value","map","formatFieldName","createToolResultSection","statusIcon","statusClass","statusText","success","exit_code","escapeHtml","otherFields","trim","isWriteOperation","params","new_string","edits","edit_mode","toLowerCase","isReadOnlyOperation","opLower","todos","todo","status","getTodoStatusIcon","priority","getTodoPriorityIcon","namespace","metadata","message","response","tokens","model","git_branch","uniqueId","Math","random","toString","substr","jsonString","formatJSON","isExpanded","copyJsonToClipboard","rect","currentTarget","getBoundingClientRect","clickX","clientX","left","clickY","clientY","top","width","preElement","querySelector","navigator","clipboard","writeText","textContent","showNotification","err","stopPropagation","moduleViewer","setTimeout","updateAllJsonSections","target","classList","contains","toggleJsonSection","preventDefault","setItem","dispatchEvent","CustomEvent","expanded","allJsonContents","querySelectorAll","allArrows","allHeaders","jsonContent","index","style","display","setAttribute","firstVisible","scrollIntoView","behavior","block","displayValue","isFilePathProperty","createClickableFilePath","some","pathKey","strValue","displayPath","replace","icons","session","claude","hook","memory","connection","unknown","completed","in_progress","pending","cancelled","high","medium","low","hook_name","hookNames","user_prompt","pre_tool","post_tool","notification","stop","subagent_stop","startsWith","hookType","split","word","charAt","toUpperCase","slice","file_path","tool_input","notebook_path","text","maxLength","substring","formatOperationDetails","details","formattedDetails","parameters","command","toFixed","div","createElement","obj","JSON","stringify","toLocaleTimeString","hour","minute","second","hour12","fieldName","pattern","_agentName","_inference","agentName","agent_name","sessionParts","pathParts","filename","file","showToolCall","toolCall","toolCallKey","preEvent","pre_event","postEvent","post_event","extractToolTarget","duration","parts","todoContent","priorityIcon","toolCallData","searchPattern","searchPath","path","directory","searchType","glob","searchResultsContent","createToolResultFromToolCall","showFileOperations","fileData","pop","operations","lastOp","op","getOperationIcon","sessionId","checkAndShowTrackControl","checkAndShowGitDiffIcons","showErrorMessage","title","errorData","showAgentEvent","showAgentSpecificDetails","agentInference","dashboard","eventViewer","warn","inference","getInferredAgentForEvent","allEvents","agentEvents","getAgentSpecificEvents","agentData","extractAgentSpecificData","renderAgentSpecificView","totalEvents","toolsCalled","sessions","Set","firstSeen","lastSeen","eventTypes","add","hook_event_name","taskParams","existingIndex","findIndex","t","toolCallId","generateToolCallId","_preToolEvents","_postToolEvents","exitCode","sort","a","b","consolidateToolCalls","timeWindow","floor","getTime","paramKey","keyParams","url","preToolEvents","postToolEvents","consolidatedCalls","processedIds","consolidatedCall","determineToolCallStatus","getToolCallStatusIcon","completedAt","estimateTokenCount","wordCount","charBasedEstimate","ceil","max","trimPromptWhitespace","line","originalEvent","size","from","trimmedPrompt","round","tool","agentJsonData","mockData","inlineContent","altParameters","read","write","edit","multiedit","create","delete","move","copy","getCurrentEvent","socket","socketClient","workingDir","currentWorkingDir","footerDir","responsePromise","Promise","resolve","reject","responseHandler","off","on","Error","emit","working_dir","displayTrackingStatus","statusElementId","statusElement","is_tracked","trackFile","debug","showGitDiffIconsForFile","gitDiffIcons","shownCount","icon","className","cssText","head","appendChild","body","animation","parentNode","removeChild","showAgentInstance","instance","syntheticEvent","delegation_type","event_count","pm_call","pmCall","agent_events","showImpliedAgent","impliedInstance","note","enableToolResultDebugging","disableToolResultDebugging"],"mappings":"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"}