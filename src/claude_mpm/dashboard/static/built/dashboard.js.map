{"version":3,"file":"dashboard.js","sources":["../js/dashboard.js"],"sourcesContent":["/**\n * Refactored Dashboard Coordinator\n *\n * Main coordinator class that orchestrates all dashboard modules while maintaining\n * backward compatibility with the original dashboard interface.\n *\n * WHY: This refactored version breaks down the monolithic 4,133-line dashboard\n * into manageable, focused modules while preserving all existing functionality.\n * Each module handles a specific concern, improving maintainability and testability.\n *\n * DESIGN DECISION: Acts as a thin coordinator layer that initializes modules,\n * manages inter-module communication through events, and provides backward\n * compatibility for existing code that depends on the dashboard interface.\n */\n\n// ES6 Module imports\nimport { SocketManager } from '@components/socket-manager.js';\nimport { EventViewer } from '@components/event-viewer.js';\nimport { ModuleViewer } from '@components/module-viewer.js';\nimport { SessionManager } from '@components/session-manager.js';\nimport { AgentInference } from '@components/agent-inference.js';\nimport { UIStateManager } from '@components/ui-state-manager.js';\nimport { EventProcessor } from '@components/event-processor.js';\nimport { ExportManager } from '@components/export-manager.js';\nimport { WorkingDirectoryManager } from '@components/working-directory.js';\nimport { FileToolTracker } from '@components/file-tool-tracker.js';\nclass Dashboard {\n    constructor() {\n        // Core components (existing)\n        this.eventViewer = null;\n        this.moduleViewer = null;\n        this.sessionManager = null;\n\n        // New modular components\n        this.socketManager = null;\n        this.agentInference = null;\n        this.uiStateManager = null;\n        this.eventProcessor = null;\n        this.exportManager = null;\n        this.workingDirectoryManager = null;\n        this.fileToolTracker = null;\n\n        // Initialize the dashboard\n        this.init();\n    }\n\n    /**\n     * Initialize the dashboard and all modules\n     */\n    init() {\n        console.log('Initializing refactored Claude MPM Dashboard...');\n\n        // Initialize modules in dependency order\n        this.initializeSocketManager();\n        this.initializeCoreComponents();\n        this.initializeAgentInference();\n        this.initializeUIStateManager();\n        this.initializeWorkingDirectoryManager();\n        this.initializeFileToolTracker();\n        this.initializeEventProcessor();\n        this.initializeExportManager();\n\n        // Set up inter-module communication\n        this.setupModuleInteractions();\n\n        // Initialize from URL parameters\n        this.initializeFromURL();\n\n        console.log('Claude MPM Dashboard initialized successfully');\n    }\n\n    /**\n     * Initialize socket manager\n     */\n    initializeSocketManager() {\n        this.socketManager = new SocketManager();\n\n        // Set up connection controls\n        this.socketManager.setupConnectionControls();\n\n        // Backward compatibility\n        this.socketClient = this.socketManager.getSocketClient();\n        window.socketClient = this.socketClient;\n    }\n\n    /**\n     * Initialize core existing components\n     */\n    initializeCoreComponents() {\n        // Initialize existing components with socket client\n        this.eventViewer = new EventViewer('events-list', this.socketClient);\n        this.moduleViewer = new ModuleViewer();\n        this.sessionManager = new SessionManager(this.socketClient);\n\n        // Backward compatibility\n        window.eventViewer = this.eventViewer;\n        window.moduleViewer = this.moduleViewer;\n        window.sessionManager = this.sessionManager;\n    }\n\n    /**\n     * Initialize agent inference system\n     */\n    initializeAgentInference() {\n        this.agentInference = new AgentInference(this.eventViewer);\n        this.agentInference.initialize();\n    }\n\n    /**\n     * Initialize UI state manager\n     */\n    initializeUIStateManager() {\n        this.uiStateManager = new UIStateManager();\n        this.setupTabFilters(); // Set up filters after UI state manager\n    }\n\n    /**\n     * Initialize working directory manager\n     */\n    initializeWorkingDirectoryManager() {\n        this.workingDirectoryManager = new WorkingDirectoryManager(this.socketManager);\n    }\n\n    /**\n     * Initialize file-tool tracker\n     */\n    initializeFileToolTracker() {\n        this.fileToolTracker = new FileToolTracker(this.agentInference, this.workingDirectoryManager);\n    }\n\n    /**\n     * Initialize event processor\n     */\n    initializeEventProcessor() {\n        this.eventProcessor = new EventProcessor(this.eventViewer, this.agentInference);\n    }\n\n\n    /**\n     * Initialize export manager\n     */\n    initializeExportManager() {\n        this.exportManager = new ExportManager(this.eventViewer);\n    }\n\n    /**\n     * Set up interactions between modules\n     */\n    setupModuleInteractions() {\n        // Socket events to update file operations and tool calls\n        this.socketManager.onEventUpdate((events) => {\n            this.fileToolTracker.updateFileOperations(events);\n            this.fileToolTracker.updateToolCalls(events);\n\n            // Process agent inference for new events\n            this.agentInference.processAgentInference();\n\n            // Auto-scroll events list if on events tab\n            if (this.uiStateManager.getCurrentTab() === 'events') {\n                this.exportManager.scrollListToBottom('events-list');\n            }\n\n            // Re-render current tab\n            this.renderCurrentTab();\n        });\n\n        // Connection status changes\n        this.socketManager.onConnectionStatusChange((status, type) => {\n            // Set up git branch listener when connected\n            if (type === 'connected') {\n                this.workingDirectoryManager.updateGitBranch(\n                    this.workingDirectoryManager.getCurrentWorkingDir()\n                );\n            }\n        });\n\n        // Tab changes\n        document.addEventListener('tabChanged', (e) => {\n            this.renderCurrentTab();\n            this.uiStateManager.updateTabNavigationItems();\n        });\n\n        // Events clearing\n        document.addEventListener('eventsClearing', () => {\n            this.fileToolTracker.clear();\n            this.agentInference.initialize();\n        });\n\n        // Card details requests\n        document.addEventListener('showCardDetails', (e) => {\n            this.showCardDetails(e.detail.tabName, e.detail.index);\n        });\n\n        // Session changes\n        document.addEventListener('sessionFilterChanged', (e) => {\n            console.log('Session filter changed, re-rendering current tab:', this.uiStateManager.getCurrentTab());\n            this.renderCurrentTab();\n        });\n    }\n\n    /**\n     * Set up tab filters\n     */\n    setupTabFilters() {\n        // Agents tab filters\n        const agentsSearchInput = document.getElementById('agents-search-input');\n        const agentsTypeFilter = document.getElementById('agents-type-filter');\n\n        if (agentsSearchInput) {\n            agentsSearchInput.addEventListener('input', () => {\n                if (this.uiStateManager.getCurrentTab() === 'agents') this.renderCurrentTab();\n            });\n        }\n\n        if (agentsTypeFilter) {\n            agentsTypeFilter.addEventListener('change', () => {\n                if (this.uiStateManager.getCurrentTab() === 'agents') this.renderCurrentTab();\n            });\n        }\n\n        // Tools tab filters\n        const toolsSearchInput = document.getElementById('tools-search-input');\n        const toolsTypeFilter = document.getElementById('tools-type-filter');\n\n        if (toolsSearchInput) {\n            toolsSearchInput.addEventListener('input', () => {\n                if (this.uiStateManager.getCurrentTab() === 'tools') this.renderCurrentTab();\n            });\n        }\n\n        if (toolsTypeFilter) {\n            toolsTypeFilter.addEventListener('change', () => {\n                if (this.uiStateManager.getCurrentTab() === 'tools') this.renderCurrentTab();\n            });\n        }\n\n        // Files tab filters\n        const filesSearchInput = document.getElementById('files-search-input');\n        const filesTypeFilter = document.getElementById('files-type-filter');\n\n        if (filesSearchInput) {\n            filesSearchInput.addEventListener('input', () => {\n                if (this.uiStateManager.getCurrentTab() === 'files') this.renderCurrentTab();\n            });\n        }\n\n        if (filesTypeFilter) {\n            filesTypeFilter.addEventListener('change', () => {\n                if (this.uiStateManager.getCurrentTab() === 'files') this.renderCurrentTab();\n            });\n        }\n    }\n\n    /**\n     * Initialize from URL parameters\n     */\n    initializeFromURL() {\n        const params = new URLSearchParams(window.location.search);\n        this.socketManager.initializeFromURL(params);\n    }\n\n    /**\n     * Render current tab content\n     */\n    renderCurrentTab() {\n        const currentTab = this.uiStateManager.getCurrentTab();\n\n        switch (currentTab) {\n            case 'events':\n                // Events tab is handled by EventViewer\n                break;\n            case 'agents':\n                this.renderAgents();\n                break;\n            case 'tools':\n                this.renderTools();\n                break;\n            case 'files':\n                this.renderFiles();\n                break;\n        }\n\n        // Update selection UI if we have a selected card\n        const selectedCard = this.uiStateManager.getSelectedCard();\n        if (selectedCard.tab === currentTab) {\n            this.uiStateManager.updateCardSelectionUI();\n        }\n\n        // Update unified selection UI to maintain consistency\n        this.uiStateManager.updateUnifiedSelectionUI();\n    }\n\n    /**\n     * Render agents tab with unique instance view (one row per PM delegation)\n     */\n    renderAgents() {\n        const agentsList = document.getElementById('agents-list');\n        if (!agentsList) return;\n\n        // Process agent inference to get PM delegations\n        this.agentInference.processAgentInference();\n\n        // Generate HTML for unique agent instances\n        const events = this.eventProcessor.getFilteredEventsForTab('agents');\n        const agentHTML = this.eventProcessor.generateAgentHTML(events);\n\n        agentsList.innerHTML = agentHTML;\n        this.exportManager.scrollListToBottom('agents-list');\n\n        // Update filter dropdowns with unique instances\n        const uniqueInstances = this.agentInference.getUniqueAgentInstances();\n        this.updateAgentsFilterDropdowns(uniqueInstances);\n    }\n\n    /**\n     * Render tools tab with unique instance view (one row per unique tool call)\n     */\n    renderTools() {\n        const toolsList = document.getElementById('tools-list');\n        if (!toolsList) return;\n\n        const toolCalls = this.fileToolTracker.getToolCalls();\n        const toolCallsArray = Array.from(toolCalls.entries());\n        const uniqueToolInstances = this.eventProcessor.getUniqueToolInstances(toolCallsArray);\n        const toolHTML = this.eventProcessor.generateToolHTML(uniqueToolInstances);\n\n        toolsList.innerHTML = toolHTML;\n        this.exportManager.scrollListToBottom('tools-list');\n\n        // Update filter dropdowns\n        this.updateToolsFilterDropdowns(uniqueToolInstances);\n    }\n\n    /**\n     * Render files tab with unique instance view (one row per unique file)\n     */\n    renderFiles() {\n        const filesList = document.getElementById('files-list');\n        if (!filesList) return;\n\n        const fileOperations = this.fileToolTracker.getFileOperations();\n        const filesArray = Array.from(fileOperations.entries());\n        const uniqueFileInstances = this.eventProcessor.getUniqueFileInstances(filesArray);\n        const fileHTML = this.eventProcessor.generateFileHTML(uniqueFileInstances);\n\n        filesList.innerHTML = fileHTML;\n        this.exportManager.scrollListToBottom('files-list');\n\n        // Update filter dropdowns\n        this.updateFilesFilterDropdowns(filesArray);\n    }\n\n    /**\n     * Update agents filter dropdowns for unique instances\n     */\n    updateAgentsFilterDropdowns(uniqueInstances) {\n        const agentTypes = new Set();\n\n        // uniqueInstances is already an array of unique agent instances\n        uniqueInstances.forEach(instance => {\n            if (instance.agentName && instance.agentName !== 'Unknown') {\n                agentTypes.add(instance.agentName);\n            }\n        });\n\n        const sortedTypes = Array.from(agentTypes).filter(type => type && type.trim() !== '');\n        this.populateFilterDropdown('agents-type-filter', sortedTypes, 'All Agent Types');\n\n        // Debug log\n        if (sortedTypes.length > 0) {\n            console.log('Agent types found for filter:', sortedTypes);\n        } else {\n            console.log('No agent types found for filter. Instances:', uniqueInstances.length);\n        }\n    }\n\n    /**\n     * Update tools filter dropdowns\n     */\n    updateToolsFilterDropdowns(toolCallsArray) {\n        const toolNames = [...new Set(toolCallsArray.map(([key, toolCall]) => toolCall.tool_name))]\n            .filter(name => name);\n\n        this.populateFilterDropdown('tools-type-filter', toolNames, 'All Tools');\n    }\n\n    /**\n     * Update files filter dropdowns\n     */\n    updateFilesFilterDropdowns(filesArray) {\n        const operations = [...new Set(filesArray.flatMap(([path, data]) =>\n            data.operations.map(op => op.operation)\n        ))].filter(op => op);\n\n        this.populateFilterDropdown('files-type-filter', operations, 'All Operations');\n    }\n\n    /**\n     * Populate filter dropdown with values\n     */\n    populateFilterDropdown(selectId, values, allOption = 'All') {\n        const select = document.getElementById(selectId);\n        if (!select) return;\n\n        const currentValue = select.value;\n        const sortedValues = values.sort((a, b) => a.localeCompare(b));\n\n        // Clear existing options except the first \"All\" option\n        select.innerHTML = `<option value=\"\">${allOption}</option>`;\n\n        // Add sorted values\n        sortedValues.forEach(value => {\n            const option = document.createElement('option');\n            option.value = value;\n            option.textContent = value;\n            select.appendChild(option);\n        });\n\n        // Restore previous selection if it still exists\n        if (currentValue && sortedValues.includes(currentValue)) {\n            select.value = currentValue;\n        }\n    }\n\n    /**\n     * Show card details for specified tab and index\n     */\n    showCardDetails(tabName, index) {\n        switch (tabName) {\n            case 'events':\n                if (this.eventViewer) {\n                    this.eventViewer.showEventDetails(index);\n                }\n                break;\n            case 'agents':\n                this.showAgentDetailsByIndex(index);\n                break;\n            case 'tools':\n                this.showToolDetailsByIndex(index);\n                break;\n            case 'files':\n                this.showFileDetailsByIndex(index);\n                break;\n        }\n    }\n\n    /**\n     * Show agent details by index\n     */\n    showAgentDetailsByIndex(index) {\n        const events = this.eventProcessor.getFilteredEventsForTab('agents');\n\n        // Defensive checks\n        if (!events || !Array.isArray(events) || index < 0 || index >= events.length) {\n            console.warn('Dashboard: Invalid agent index or events array');\n            return;\n        }\n\n        const filteredSingleEvent = this.eventProcessor.applyAgentsFilters([events[index]]);\n\n        if (filteredSingleEvent.length > 0 && this.moduleViewer &&\n            typeof this.moduleViewer.showAgentEvent === 'function') {\n            const event = filteredSingleEvent[0];\n            this.moduleViewer.showAgentEvent(event, index);\n        }\n    }\n\n    /**\n     * Show agent instance details for unique instance view\n     * @param {string} instanceId - Agent instance ID\n     */\n    showAgentInstanceDetails(instanceId) {\n        const pmDelegations = this.agentInference.getPMDelegations();\n        const instance = pmDelegations.get(instanceId);\n\n        if (!instance) {\n            // Check if it's an implied delegation\n            const uniqueInstances = this.agentInference.getUniqueAgentInstances();\n            const impliedInstance = uniqueInstances.find(inst => inst.id === instanceId);\n\n            if (!impliedInstance) {\n                console.error('Agent instance not found:', instanceId);\n                return;\n            }\n\n            // For implied instances, show basic info\n            this.showImpliedAgentDetails(impliedInstance);\n            return;\n        }\n\n        // Show full PM delegation details\n        if (this.moduleViewer && typeof this.moduleViewer.showAgentInstance === 'function') {\n            this.moduleViewer.showAgentInstance(instance);\n        } else {\n            // Fallback: show in console or basic modal\n            console.log('Agent Instance Details:', {\n                id: instanceId,\n                agentName: instance.agentName,\n                type: 'PM Delegation',\n                eventCount: instance.agentEvents.length,\n                startTime: instance.timestamp,\n                pmCall: instance.pmCall\n            });\n        }\n    }\n\n    /**\n     * Show implied agent details (agents without explicit PM delegation)\n     * @param {Object} impliedInstance - Implied agent instance\n     */\n    showImpliedAgentDetails(impliedInstance) {\n        if (this.moduleViewer && typeof this.moduleViewer.showImpliedAgent === 'function') {\n            this.moduleViewer.showImpliedAgent(impliedInstance);\n        } else {\n            // Fallback: show in console or basic modal\n            console.log('Implied Agent Details:', {\n                id: impliedInstance.id,\n                agentName: impliedInstance.agentName,\n                type: 'Implied PM Delegation',\n                eventCount: impliedInstance.eventCount,\n                startTime: impliedInstance.timestamp,\n                note: 'No explicit PM call found - inferred from agent activity'\n            });\n        }\n    }\n\n    /**\n     * Show tool details by index\n     */\n    showToolDetailsByIndex(index) {\n        const toolCalls = this.fileToolTracker.getToolCalls();\n        const toolCallsArray = Array.from(toolCalls.entries());\n        const filteredToolCalls = this.eventProcessor.applyToolCallFilters(toolCallsArray);\n\n        if (index >= 0 && index < filteredToolCalls.length) {\n            const [toolCallKey] = filteredToolCalls[index];\n            this.showToolCallDetails(toolCallKey);\n        }\n    }\n\n    /**\n     * Show file details by index\n     */\n    showFileDetailsByIndex(index) {\n        const fileOperations = this.fileToolTracker.getFileOperations();\n        let filesArray = Array.from(fileOperations.entries());\n        filesArray = this.eventProcessor.applyFilesFilters(filesArray);\n\n        if (index >= 0 && index < filesArray.length) {\n            const [filePath] = filesArray[index];\n            this.showFileDetails(filePath);\n        }\n    }\n\n    /**\n     * Show tool call details\n     */\n    showToolCallDetails(toolCallKey) {\n        const toolCall = this.fileToolTracker.getToolCall(toolCallKey);\n        if (toolCall && this.moduleViewer) {\n            this.moduleViewer.showToolCall(toolCall, toolCallKey);\n        }\n    }\n\n    /**\n     * Show file details\n     */\n    showFileDetails(filePath) {\n        const fileData = this.fileToolTracker.getFileOperationsForFile(filePath);\n        if (fileData && this.moduleViewer) {\n            this.moduleViewer.showFileOperations(fileData, filePath);\n        }\n    }\n\n    // ====================================\n    // BACKWARD COMPATIBILITY METHODS\n    // ====================================\n\n    /**\n     * Switch tab (backward compatibility)\n     */\n    switchTab(tabName) {\n        this.uiStateManager.switchTab(tabName);\n    }\n\n    /**\n     * Select card (backward compatibility)\n     */\n    selectCard(tabName, index, type, data) {\n        this.uiStateManager.selectCard(tabName, index, type, data);\n    }\n\n    /**\n     * Clear events (backward compatibility)\n     */\n    clearEvents() {\n        this.exportManager.clearEvents();\n    }\n\n    /**\n     * Export events (backward compatibility)\n     */\n    exportEvents() {\n        this.exportManager.exportEvents();\n    }\n\n    /**\n     * Clear selection (backward compatibility)\n     */\n    clearSelection() {\n        this.uiStateManager.clearSelection();\n        if (this.eventViewer) {\n            this.eventViewer.clearSelection();\n        }\n        if (this.moduleViewer) {\n            this.moduleViewer.clear();\n        }\n    }\n\n\n    /**\n     * Get current working directory (backward compatibility)\n     */\n    get currentWorkingDir() {\n        return this.workingDirectoryManager.getCurrentWorkingDir();\n    }\n\n    /**\n     * Set current working directory (backward compatibility)\n     */\n    set currentWorkingDir(dir) {\n        this.workingDirectoryManager.setWorkingDirectory(dir);\n    }\n\n    /**\n     * Get current tab (backward compatibility)\n     */\n    get currentTab() {\n        return this.uiStateManager.getCurrentTab();\n    }\n\n    /**\n     * Get selected card (backward compatibility)\n     */\n    get selectedCard() {\n        return this.uiStateManager.getSelectedCard();\n    }\n\n    /**\n     * Get file operations (backward compatibility)\n     */\n    get fileOperations() {\n        return this.fileToolTracker.getFileOperations();\n    }\n\n    /**\n     * Get tool calls (backward compatibility)\n     */\n    get toolCalls() {\n        return this.fileToolTracker.getToolCalls();\n    }\n\n\n    /**\n     * Get tab navigation state (backward compatibility)\n     */\n    get tabNavigation() {\n        return this.uiStateManager ? this.uiStateManager.tabNavigation : null;\n    }\n}\n\n// Global functions for backward compatibility\nwindow.clearEvents = function() {\n    if (window.dashboard) {\n        window.dashboard.clearEvents();\n    }\n};\n\nwindow.exportEvents = function() {\n    if (window.dashboard) {\n        window.dashboard.exportEvents();\n    }\n};\n\nwindow.clearSelection = function() {\n    if (window.dashboard) {\n        window.dashboard.clearSelection();\n    }\n};\n\nwindow.switchTab = function(tabName) {\n    if (window.dashboard) {\n        window.dashboard.switchTab(tabName);\n    }\n};\n\n// File Viewer Modal Functions - REMOVED DUPLICATE (keeping the one at line 1553)\nwindow.showFileViewerModal = function(filePath, workingDir) {\n    // Use the dashboard's current working directory if not provided\n    if (!workingDir && window.dashboard && window.dashboard.currentWorkingDir) {\n        workingDir = window.dashboard.currentWorkingDir;\n    }\n\n    // Create modal if it doesn't exist\n    let modal = document.getElementById('file-viewer-modal');\n    if (!modal) {\n        modal = createFileViewerModal();\n        document.body.appendChild(modal);\n    }\n\n    // Update modal content\n    updateFileViewerModal(modal, filePath, workingDir);\n\n    // Show the modal as flex container\n    modal.style.display = 'flex';\n    document.body.style.overflow = 'hidden'; // Prevent background scrolling\n};\n\nwindow.hideFileViewerModal = function() {\n    const modal = document.getElementById('file-viewer-modal');\n    if (modal) {\n        modal.style.display = 'none';\n        document.body.style.overflow = ''; // Restore background scrolling\n    }\n};\n\nwindow.copyFileContent = function() {\n    const modal = document.getElementById('file-viewer-modal');\n    if (!modal) return;\n\n    const codeElement = modal.querySelector('.file-content-code');\n    if (!codeElement) return;\n\n    const text = codeElement.textContent;\n\n    if (navigator.clipboard && navigator.clipboard.writeText) {\n        navigator.clipboard.writeText(text).then(() => {\n            // Show brief feedback\n            const button = modal.querySelector('.file-content-copy');\n            const originalText = button.textContent;\n            button.textContent = '✅ Copied!';\n            setTimeout(() => {\n                button.textContent = originalText;\n            }, 2000);\n        }).catch(err => {\n            console.error('Failed to copy text:', err);\n        });\n    } else {\n        // Fallback for older browsers\n        const textarea = document.createElement('textarea');\n        textarea.value = text;\n        document.body.appendChild(textarea);\n        textarea.select();\n        document.execCommand('copy');\n        document.body.removeChild(textarea);\n\n        const button = modal.querySelector('.file-content-copy');\n        const originalText = button.textContent;\n        button.textContent = '✅ Copied!';\n        setTimeout(() => {\n            button.textContent = originalText;\n        }, 2000);\n    }\n};\n\nfunction createFileViewerModal() {\n    const modal = document.createElement('div');\n    modal.id = 'file-viewer-modal';\n    modal.className = 'modal file-viewer-modal';\n\n    modal.innerHTML = `\n        <div class=\"modal-content file-viewer-content\">\n            <div class=\"file-viewer-header\">\n                <h2 class=\"file-viewer-title\">\n                    <span class=\"file-viewer-icon\">📄</span>\n                    <span class=\"file-viewer-title-text\">File Viewer</span>\n                </h2>\n                <div class=\"file-viewer-meta\">\n                    <span class=\"file-viewer-file-path\"></span>\n                    <span class=\"file-viewer-file-size\"></span>\n                </div>\n                <button class=\"file-viewer-close\" onclick=\"hideFileViewerModal()\">\n                    <span>&times;</span>\n                </button>\n            </div>\n            <div class=\"file-viewer-body\">\n                <div class=\"file-viewer-loading\">\n                    <div class=\"loading-spinner\"></div>\n                    <span>Loading file content...</span>\n                </div>\n                <div class=\"file-viewer-error\" style=\"display: none;\">\n                    <div class=\"error-icon\">⚠️</div>\n                    <div class=\"error-message\"></div>\n                    <div class=\"error-suggestions\"></div>\n                </div>\n                <div class=\"file-viewer-content-area\" style=\"display: none;\">\n                    <div class=\"file-viewer-toolbar\">\n                        <div class=\"file-viewer-info\">\n                            <span class=\"file-extension\"></span>\n                            <span class=\"file-encoding\"></span>\n                        </div>\n                        <div class=\"file-viewer-actions\">\n                            <button class=\"file-content-copy\" onclick=\"copyFileContent()\">\n                                📋 Copy\n                            </button>\n                        </div>\n                    </div>\n                    <div class=\"file-viewer-scroll-wrapper\">\n                        <pre class=\"file-content-display\"><code class=\"file-content-code\"></code></pre>\n                    </div>\n                </div>\n            </div>\n        </div>\n    `;\n\n    // Close modal when clicking outside\n    modal.addEventListener('click', (e) => {\n        if (e.target === modal) {\n            hideFileViewerModal();\n        }\n    });\n\n    // Close modal with Escape key\n    document.addEventListener('keydown', (e) => {\n        if (e.key === 'Escape' && modal.style.display === 'flex') {\n            hideFileViewerModal();\n        }\n    });\n\n    return modal;\n}\n\nasync function updateFileViewerModal(modal, filePath, workingDir) {\n    // Update header info\n    const filePathElement = modal.querySelector('.file-viewer-file-path');\n    const fileSizeElement = modal.querySelector('.file-viewer-file-size');\n\n    filePathElement.textContent = filePath;\n    fileSizeElement.textContent = '';\n\n    // Show loading state\n    modal.querySelector('.file-viewer-loading').style.display = 'flex';\n    modal.querySelector('.file-viewer-error').style.display = 'none';\n    modal.querySelector('.file-viewer-content-area').style.display = 'none';\n\n    try {\n        // Get the Socket.IO client\n        const socket = window.socket || window.dashboard?.socketClient?.socket;\n        if (!socket) {\n            throw new Error('No socket connection available');\n        }\n\n        // Set up one-time listener for file content response\n        const responsePromise = new Promise((resolve, reject) => {\n            const responseHandler = (data) => {\n                if (data.file_path === filePath) {\n                    socket.off('file_content_response', responseHandler);\n                    if (data.success) {\n                        resolve(data);\n                    } else {\n                        reject(new Error(data.error || 'Failed to read file'));\n                    }\n                }\n            };\n\n            socket.on('file_content_response', responseHandler);\n\n            // Timeout after 10 seconds\n            setTimeout(() => {\n                socket.off('file_content_response', responseHandler);\n                reject(new Error('Request timeout'));\n            }, 10000);\n        });\n\n        // Send file read request\n        socket.emit('read_file', {\n            file_path: filePath,\n            working_dir: workingDir\n        });\n\n        console.log('📄 File viewer request sent:', {\n            filePath,\n            workingDir\n        });\n\n        // Wait for response\n        const result = await responsePromise;\n        console.log('📦 File content received:', result);\n\n        // Hide loading\n        modal.querySelector('.file-viewer-loading').style.display = 'none';\n\n        // Show successful content\n        displayFileContent(modal, result);\n\n    } catch (error) {\n        console.error('❌ Failed to fetch file content:', error);\n\n        modal.querySelector('.file-viewer-loading').style.display = 'none';\n\n        // Create detailed error message\n        let errorMessage = error.message || 'Unknown error occurred';\n        let suggestions = [];\n\n        if (error.message.includes('No socket connection')) {\n            errorMessage = 'Failed to connect to the monitoring server';\n            suggestions = [\n                'Check if the monitoring server is running',\n                'Verify the socket connection in the dashboard',\n                'Try refreshing the page and reconnecting'\n            ];\n        } else if (error.message.includes('timeout')) {\n            errorMessage = 'Request timed out';\n            suggestions = [\n                'The file may be too large to load quickly',\n                'Check your network connection',\n                'Try again in a few moments'\n            ];\n        } else if (error.message.includes('File does not exist')) {\n            errorMessage = 'File not found';\n            suggestions = [\n                'The file may have been moved or deleted',\n                'Check the file path spelling',\n                'Refresh the file list to see current files'\n            ];\n        } else if (error.message.includes('Access denied')) {\n            errorMessage = 'Access denied';\n            suggestions = [\n                'The file is outside the allowed directories',\n                'File access is restricted for security reasons'\n            ];\n        }\n\n        displayFileError(modal, {\n            error: errorMessage,\n            file_path: filePath,\n            working_dir: workingDir,\n            suggestions: suggestions\n        });\n    }\n}\n\nfunction displayFileContent(modal, result) {\n    console.log('📝 displayFileContent called with:', result);\n    const contentArea = modal.querySelector('.file-viewer-content-area');\n    const extensionElement = modal.querySelector('.file-extension');\n    const encodingElement = modal.querySelector('.file-encoding');\n    const fileSizeElement = modal.querySelector('.file-viewer-file-size');\n    const codeElement = modal.querySelector('.file-content-code');\n\n    // Update metadata\n    if (extensionElement) extensionElement.textContent = `Type: ${result.extension || 'unknown'}`;\n    if (encodingElement) encodingElement.textContent = `Encoding: ${result.encoding || 'unknown'}`;\n    if (fileSizeElement) fileSizeElement.textContent = `Size: ${formatFileSize(result.file_size)}`;\n\n    // Update content with basic syntax highlighting\n    if (codeElement && result.content) {\n        console.log('💡 Setting file content, length:', result.content.length);\n        codeElement.innerHTML = highlightCode(result.content, result.extension);\n\n        // Force scrolling to work by setting explicit heights\n        const wrapper = modal.querySelector('.file-viewer-scroll-wrapper');\n        if (wrapper) {\n            // Give it a moment for content to render\n            setTimeout(() => {\n                const modalContent = modal.querySelector('.modal-content');\n                const header = modal.querySelector('.file-viewer-header');\n                const toolbar = modal.querySelector('.file-viewer-toolbar');\n\n                const modalHeight = modalContent?.offsetHeight || 0;\n                const headerHeight = header?.offsetHeight || 0;\n                const toolbarHeight = toolbar?.offsetHeight || 0;\n\n                const availableHeight = modalHeight - headerHeight - toolbarHeight - 40; // 40px for padding\n\n                console.log('🎯 Setting file viewer scroll height:', {\n                    modalHeight,\n                    headerHeight,\n                    toolbarHeight,\n                    availableHeight\n                });\n\n                wrapper.style.maxHeight = `${availableHeight}px`;\n                wrapper.style.overflowY = 'auto';\n            }, 50);\n        }\n    } else {\n        console.warn('⚠️ Missing codeElement or file content');\n    }\n\n    // Show content area\n    if (contentArea) {\n        contentArea.style.display = 'block';\n        console.log('✅ File content area displayed');\n    }\n}\n\nfunction displayFileError(modal, result) {\n    const errorArea = modal.querySelector('.file-viewer-error');\n    const messageElement = modal.querySelector('.error-message');\n    const suggestionsElement = modal.querySelector('.error-suggestions');\n\n    let errorMessage = result.error || 'Unknown error occurred';\n\n    messageElement.innerHTML = `\n        <div class=\"error-main\">${errorMessage}</div>\n        ${result.file_path ? `<div class=\"error-file\">File: ${result.file_path}</div>` : ''}\n        ${result.working_dir ? `<div class=\"error-dir\">Working directory: ${result.working_dir}</div>` : ''}\n    `;\n\n    if (result.suggestions && result.suggestions.length > 0) {\n        suggestionsElement.innerHTML = `\n            <h4>Suggestions:</h4>\n            <ul>\n                ${result.suggestions.map(s => `<li>${s}</li>`).join('')}\n            </ul>\n        `;\n    } else {\n        suggestionsElement.innerHTML = '';\n    }\n\n    console.log('📋 Displaying file viewer error:', {\n        originalError: result.error,\n        processedMessage: errorMessage,\n        suggestions: result.suggestions\n    });\n\n    errorArea.style.display = 'block';\n}\n\nfunction highlightCode(code, extension) {\n    /**\n     * Apply basic syntax highlighting to code content\n     * WHY: Provides basic highlighting for common file types to improve readability.\n     * This is a simple implementation that can be enhanced with full syntax highlighting\n     * libraries like highlight.js or Prism.js if needed.\n     */\n\n    // Escape HTML entities first\n    const escaped = code\n        .replace(/&/g, '&amp;')\n        .replace(/</g, '&lt;')\n        .replace(/>/g, '&gt;');\n\n    // Basic highlighting based on file extension\n    switch (extension) {\n        case '.js':\n        case '.jsx':\n        case '.ts':\n        case '.tsx':\n            return highlightJavaScript(escaped);\n        case '.py':\n            return highlightPython(escaped);\n        case '.json':\n            return highlightJSON(escaped);\n        case '.css':\n            return highlightCSS(escaped);\n        case '.html':\n        case '.htm':\n            return highlightHTML(escaped);\n        case '.md':\n        case '.markdown':\n            return highlightMarkdown(escaped);\n        default:\n            // Return with line numbers for plain text\n            return addLineNumbers(escaped);\n    }\n}\n\nfunction highlightJavaScript(code) {\n    return addLineNumbers(code\n        .replace(/\\b(function|const|let|var|if|else|for|while|return|import|export|class|extends)\\b/g, '<span class=\"keyword\">$1</span>')\n        .replace(/(\\/\\*[\\s\\S]*?\\*\\/|\\/\\/.*)/g, '<span class=\"comment\">$1</span>')\n        .replace(/('[^']*'|\"[^\"]*\"|`[^`]*`)/g, '<span class=\"string\">$1</span>')\n        .replace(/\\b(\\d+)\\b/g, '<span class=\"number\">$1</span>'));\n}\n\nfunction highlightPython(code) {\n    return addLineNumbers(code\n        .replace(/\\b(def|class|if|elif|else|for|while|return|import|from|as|try|except|finally|with)\\b/g, '<span class=\"keyword\">$1</span>')\n        .replace(/(#.*)/g, '<span class=\"comment\">$1</span>')\n        .replace(/('[^']*'|\"[^\"]*\"|\"\"\"[\\s\\S]*?\"\"\")/g, '<span class=\"string\">$1</span>')\n        .replace(/\\b(\\d+)\\b/g, '<span class=\"number\">$1</span>'));\n}\n\nfunction highlightJSON(code) {\n    return addLineNumbers(code\n        .replace(/(\"[\\w\\s]*\")\\s*:/g, '<span class=\"property\">$1</span>:')\n        .replace(/:\\s*(\".*?\")/g, ': <span class=\"string\">$1</span>')\n        .replace(/:\\s*(\\d+)/g, ': <span class=\"number\">$1</span>')\n        .replace(/:\\s*(true|false|null)/g, ': <span class=\"keyword\">$1</span>'));\n}\n\nfunction highlightCSS(code) {\n    return addLineNumbers(code\n        .replace(/([.#]?[\\w-]+)\\s*\\{/g, '<span class=\"selector\">$1</span> {')\n        .replace(/([\\w-]+)\\s*:/g, '<span class=\"property\">$1</span>:')\n        .replace(/:\\s*([^;]+);/g, ': <span class=\"value\">$1</span>;')\n        .replace(/(\\/\\*[\\s\\S]*?\\*\\/)/g, '<span class=\"comment\">$1</span>'));\n}\n\nfunction highlightHTML(code) {\n    return addLineNumbers(code\n        .replace(/(&lt;\\/?[\\w-]+)/g, '<span class=\"tag\">$1</span>')\n        .replace(/([\\w-]+)=(['\"][^'\"]*['\"])/g, '<span class=\"attribute\">$1</span>=<span class=\"string\">$2</span>')\n        .replace(/(&lt;!--[\\s\\S]*?--&gt;)/g, '<span class=\"comment\">$1</span>'));\n}\n\nfunction highlightMarkdown(code) {\n    return addLineNumbers(code\n        .replace(/^(#{1,6})\\s+(.*)$/gm, '<span class=\"header\">$1</span> <span class=\"header-text\">$2</span>')\n        .replace(/\\*\\*(.*?)\\*\\*/g, '<span class=\"bold\">**$1**</span>')\n        .replace(/\\*(.*?)\\*/g, '<span class=\"italic\">*$1*</span>')\n        .replace(/`([^`]+)`/g, '<span class=\"code\">`$1`</span>')\n        .replace(/^\\s*[-*+]\\s+(.*)$/gm, '<span class=\"list-marker\">•</span> $1'));\n}\n\nfunction addLineNumbers(code) {\n    const lines = code.split('\\n');\n    return lines.map((line, index) =>\n        `<span class=\"line-number\">${String(index + 1).padStart(3, ' ')}</span> ${line || ' '}`\n    ).join('\\n');\n}\n\nfunction formatFileSize(bytes) {\n    if (!bytes) return '0 B';\n    const k = 1024;\n    const sizes = ['B', 'KB', 'MB', 'GB'];\n    const i = Math.floor(Math.log(bytes) / Math.log(k));\n    return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];\n}\n\n// Git Diff Modal Functions - restored from original dashboard\nwindow.showGitDiffModal = function(filePath, timestamp, workingDir) {\n    // Use the dashboard's current working directory if not provided\n    if (!workingDir && window.dashboard && window.dashboard.currentWorkingDir) {\n        workingDir = window.dashboard.currentWorkingDir;\n    }\n\n    // Create modal if it doesn't exist\n    let modal = document.getElementById('git-diff-modal');\n    if (!modal) {\n        modal = createGitDiffModal();\n        document.body.appendChild(modal);\n    }\n\n    // Update modal content\n    updateGitDiffModal(modal, filePath, timestamp, workingDir);\n\n    // Show the modal as flex container\n    modal.style.display = 'flex';\n    document.body.style.overflow = 'hidden'; // Prevent background scrolling\n};\n\nwindow.hideGitDiffModal = function() {\n    const modal = document.getElementById('git-diff-modal');\n    if (modal) {\n        modal.style.display = 'none';\n        document.body.style.overflow = ''; // Restore background scrolling\n    }\n};\n\nwindow.copyGitDiff = function() {\n    const modal = document.getElementById('git-diff-modal');\n    if (!modal) return;\n\n    const codeElement = modal.querySelector('.git-diff-code');\n    if (!codeElement) return;\n\n    const text = codeElement.textContent;\n\n    if (navigator.clipboard && navigator.clipboard.writeText) {\n        navigator.clipboard.writeText(text).then(() => {\n            // Show brief feedback\n            const button = modal.querySelector('.git-diff-copy');\n            const originalText = button.textContent;\n            button.textContent = '✅ Copied!';\n            setTimeout(() => {\n                button.textContent = originalText;\n            }, 2000);\n        }).catch(err => {\n            console.error('Failed to copy text:', err);\n        });\n    } else {\n        // Fallback for older browsers\n        const textarea = document.createElement('textarea');\n        textarea.value = text;\n        document.body.appendChild(textarea);\n        textarea.select();\n        document.execCommand('copy');\n        document.body.removeChild(textarea);\n\n        const button = modal.querySelector('.git-diff-copy');\n        const originalText = button.textContent;\n        button.textContent = '✅ Copied!';\n        setTimeout(() => {\n            button.textContent = originalText;\n        }, 2000);\n    }\n};\n\nfunction createGitDiffModal() {\n    const modal = document.createElement('div');\n    modal.id = 'git-diff-modal';\n    modal.className = 'modal git-diff-modal';\n\n    modal.innerHTML = `\n        <div class=\"modal-content git-diff-content\">\n            <div class=\"git-diff-header\">\n                <h2 class=\"git-diff-title\">\n                    <span class=\"git-diff-icon\">📋</span>\n                    <span class=\"git-diff-title-text\">Git Diff</span>\n                </h2>\n                <div class=\"git-diff-meta\">\n                    <span class=\"git-diff-file-path\"></span>\n                    <span class=\"git-diff-timestamp\"></span>\n                </div>\n                <button class=\"git-diff-close\" onclick=\"hideGitDiffModal()\">\n                    <span>&times;</span>\n                </button>\n            </div>\n            <div class=\"git-diff-body\">\n                <div class=\"git-diff-loading\">\n                    <div class=\"loading-spinner\"></div>\n                    <span>Loading git diff...</span>\n                </div>\n                <div class=\"git-diff-error\" style=\"display: none;\">\n                    <div class=\"error-icon\">⚠️</div>\n                    <div class=\"error-message\"></div>\n                    <div class=\"error-suggestions\"></div>\n                </div>\n                <div class=\"git-diff-content-area\" style=\"display: none;\">\n                    <div class=\"git-diff-toolbar\">\n                        <div class=\"git-diff-info\">\n                            <span class=\"commit-hash\"></span>\n                            <span class=\"diff-method\"></span>\n                        </div>\n                        <div class=\"git-diff-actions\">\n                            <button class=\"git-diff-copy\" onclick=\"copyGitDiff()\">\n                                📋 Copy\n                            </button>\n                        </div>\n                    </div>\n                    <div class=\"git-diff-scroll-wrapper\">\n                        <pre class=\"git-diff-display\"><code class=\"git-diff-code\"></code></pre>\n                    </div>\n                </div>\n            </div>\n        </div>\n    `;\n\n    // Close modal when clicking outside\n    modal.addEventListener('click', (e) => {\n        if (e.target === modal) {\n            hideGitDiffModal();\n        }\n    });\n\n    // Close modal with Escape key\n    document.addEventListener('keydown', (e) => {\n        if (e.key === 'Escape' && modal.style.display === 'flex') {\n            hideGitDiffModal();\n        }\n    });\n\n    return modal;\n}\n\nasync function updateGitDiffModal(modal, filePath, timestamp, workingDir) {\n    // Update header info\n    const filePathElement = modal.querySelector('.git-diff-file-path');\n    const timestampElement = modal.querySelector('.git-diff-timestamp');\n\n    filePathElement.textContent = filePath;\n    timestampElement.textContent = timestamp ? new Date(timestamp).toLocaleString() : 'Latest';\n\n    // Show loading state\n    modal.querySelector('.git-diff-loading').style.display = 'flex';\n    modal.querySelector('.git-diff-error').style.display = 'none';\n    modal.querySelector('.git-diff-content-area').style.display = 'none';\n\n    try {\n        // Get the Socket.IO server port with multiple fallbacks\n        let port = 8765; // Default fallback\n\n        // Try to get port from socketClient first\n        if (window.dashboard && window.dashboard.socketClient && window.dashboard.socketClient.port) {\n            port = window.dashboard.socketClient.port;\n        }\n        // Fallback to port input field if socketClient port is not available\n        else {\n            const portInput = document.getElementById('port-input');\n            if (portInput && portInput.value) {\n                port = portInput.value;\n            }\n        }\n\n        // Build URL parameters\n        const params = new URLSearchParams({\n            file: filePath\n        });\n\n        if (timestamp) {\n            params.append('timestamp', timestamp);\n        }\n        if (workingDir) {\n            params.append('working_dir', workingDir);\n        }\n\n        const requestUrl = `http://localhost:${port}/api/git-diff?${params}`;\n        console.log('🌐 Making git diff request to:', requestUrl);\n        console.log('📋 Git diff request parameters:', {\n            filePath,\n            timestamp,\n            workingDir,\n            urlParams: params.toString()\n        });\n\n        // Test server connectivity first\n        try {\n            const healthResponse = await fetch(`http://localhost:${port}/health`, {\n                method: 'GET',\n                headers: {\n                    'Accept': 'application/json',\n                    'Content-Type': 'application/json'\n                },\n                mode: 'cors'\n            });\n\n            if (!healthResponse.ok) {\n                throw new Error(`Server health check failed: ${healthResponse.status} ${healthResponse.statusText}`);\n            }\n\n            console.log('✅ Server health check passed');\n        } catch (healthError) {\n            throw new Error(`Cannot reach server at localhost:${port}. Health check failed: ${healthError.message}`);\n        }\n\n        // Make the actual git diff request\n        const response = await fetch(requestUrl, {\n            method: 'GET',\n            headers: {\n                'Accept': 'application/json',\n                'Content-Type': 'application/json'\n            },\n            mode: 'cors'\n        });\n\n        if (!response.ok) {\n            throw new Error(`HTTP ${response.status}: ${response.statusText}`);\n        }\n\n        const result = await response.json();\n        console.log('📦 Git diff response:', result);\n\n        // Hide loading\n        modal.querySelector('.git-diff-loading').style.display = 'none';\n\n        if (result.success) {\n            console.log('📊 Displaying successful git diff');\n            // Show successful diff\n            displayGitDiff(modal, result);\n        } else {\n            console.log('⚠️ Displaying git diff error:', result);\n            // Show error\n            displayGitDiffError(modal, result);\n        }\n\n    } catch (error) {\n        console.error('❌ Failed to fetch git diff:', error);\n        console.error('Error details:', {\n            name: error.name,\n            message: error.message,\n            stack: error.stack,\n            filePath,\n            timestamp,\n            workingDir\n        });\n\n        modal.querySelector('.git-diff-loading').style.display = 'none';\n\n        // Create detailed error message based on error type\n        let errorMessage = `Network error: ${error.message}`;\n        let suggestions = [];\n\n        if (error.message.includes('Failed to fetch')) {\n            errorMessage = 'Failed to connect to the monitoring server';\n            suggestions = [\n                'Check if the monitoring server is running on port 8765',\n                'Verify the port configuration in the dashboard',\n                'Check browser console for CORS or network errors',\n                'Try refreshing the page and reconnecting'\n            ];\n        } else if (error.message.includes('health check failed')) {\n            errorMessage = error.message;\n            suggestions = [\n                'The server may be starting up - try again in a few seconds',\n                'Check if another process is using port 8765',\n                'Restart the claude-mpm monitoring server'\n            ];\n        } else if (error.message.includes('HTTP')) {\n            errorMessage = `Server error: ${error.message}`;\n            suggestions = [\n                'The server encountered an internal error',\n                'Check the server logs for more details',\n                'Try with a different file or working directory'\n            ];\n        }\n\n        displayGitDiffError(modal, {\n            error: errorMessage,\n            file_path: filePath,\n            working_dir: workingDir,\n            suggestions: suggestions,\n            debug_info: {\n                error_type: error.name,\n                original_message: error.message,\n                port: window.dashboard?.socketClient?.port || document.getElementById('port-input')?.value || '8765',\n                timestamp: new Date().toISOString()\n            }\n        });\n    }\n}\n\nfunction highlightGitDiff(diffText) {\n    /**\n     * Apply basic syntax highlighting to git diff output\n     * WHY: Git diffs have a standard format that can be highlighted for better readability:\n     * - Lines starting with '+' are additions (green)\n     * - Lines starting with '-' are deletions (red)\n     * - Lines starting with '@@' are context headers (blue)\n     * - File headers and metadata get special formatting\n     */\n    return diffText\n        .split('\\n')\n        .map(line => {\n            // Escape HTML entities\n            const escaped = line\n                .replace(/&/g, '&amp;')\n                .replace(/</g, '&lt;')\n                .replace(/>/g, '&gt;');\n\n            // Apply diff highlighting\n            if (line.startsWith('+++') || line.startsWith('---')) {\n                return `<span class=\"diff-header\">${escaped}</span>`;\n            } else if (line.startsWith('@@')) {\n                return `<span class=\"diff-meta\">${escaped}</span>`;\n            } else if (line.startsWith('+')) {\n                return `<span class=\"diff-addition\">${escaped}</span>`;\n            } else if (line.startsWith('-')) {\n                return `<span class=\"diff-deletion\">${escaped}</span>`;\n            } else if (line.startsWith('commit ') || line.startsWith('Author:') || line.startsWith('Date:')) {\n                return `<span class=\"diff-header\">${escaped}</span>`;\n            } else {\n                return `<span class=\"diff-context\">${escaped}</span>`;\n            }\n        })\n        .join('\\n');\n}\n\nfunction displayGitDiff(modal, result) {\n    console.log('📝 displayGitDiff called with:', result);\n    const contentArea = modal.querySelector('.git-diff-content-area');\n    const commitHashElement = modal.querySelector('.commit-hash');\n    const methodElement = modal.querySelector('.diff-method');\n    const codeElement = modal.querySelector('.git-diff-code');\n\n    console.log('🔍 Elements found:', {\n        contentArea: !!contentArea,\n        commitHashElement: !!commitHashElement,\n        methodElement: !!methodElement,\n        codeElement: !!codeElement\n    });\n\n    // Update metadata\n    if (commitHashElement) commitHashElement.textContent = `Commit: ${result.commit_hash}`;\n    if (methodElement) methodElement.textContent = `Method: ${result.method}`;\n\n    // Update diff content with basic syntax highlighting\n    if (codeElement && result.diff) {\n        console.log('💡 Setting diff content, length:', result.diff.length);\n        codeElement.innerHTML = highlightGitDiff(result.diff);\n\n        // Force scrolling to work by setting explicit heights\n        const wrapper = modal.querySelector('.git-diff-scroll-wrapper');\n        if (wrapper) {\n            // Give it a moment for content to render\n            setTimeout(() => {\n                const modalContent = modal.querySelector('.modal-content');\n                const header = modal.querySelector('.git-diff-header');\n                const toolbar = modal.querySelector('.git-diff-toolbar');\n\n                const modalHeight = modalContent?.offsetHeight || 0;\n                const headerHeight = header?.offsetHeight || 0;\n                const toolbarHeight = toolbar?.offsetHeight || 0;\n\n                const availableHeight = modalHeight - headerHeight - toolbarHeight - 40; // 40px for padding\n\n                console.log('🎯 Setting explicit scroll height:', {\n                    modalHeight,\n                    headerHeight,\n                    toolbarHeight,\n                    availableHeight\n                });\n\n                wrapper.style.maxHeight = `${availableHeight}px`;\n                wrapper.style.overflowY = 'auto';\n            }, 50);\n        }\n    } else {\n        console.warn('⚠️ Missing codeElement or diff data');\n    }\n\n    // Show content area\n    if (contentArea) {\n        contentArea.style.display = 'block';\n        console.log('✅ Content area displayed');\n    }\n}\n\nfunction displayGitDiffError(modal, result) {\n    const errorArea = modal.querySelector('.git-diff-error');\n    const messageElement = modal.querySelector('.error-message');\n    const suggestionsElement = modal.querySelector('.error-suggestions');\n\n    // Create more user-friendly error messages\n    let errorMessage = result.error || 'Unknown error occurred';\n    let isUntracked = false;\n\n    if (errorMessage.includes('not tracked by git')) {\n        errorMessage = '📝 This file is not tracked by git yet';\n        isUntracked = true;\n    } else if (errorMessage.includes('No git history found')) {\n        errorMessage = '📋 No git history available for this file';\n    }\n\n    messageElement.innerHTML = `\n        <div class=\"error-main\">${errorMessage}</div>\n        ${result.file_path ? `<div class=\"error-file\">File: ${result.file_path}</div>` : ''}\n        ${result.working_dir ? `<div class=\"error-dir\">Working directory: ${result.working_dir}</div>` : ''}\n    `;\n\n    if (result.suggestions && result.suggestions.length > 0) {\n        const suggestionTitle = isUntracked ? 'How to track this file:' : 'Suggestions:';\n        suggestionsElement.innerHTML = `\n            <h4>${suggestionTitle}</h4>\n            <ul>\n                ${result.suggestions.map(s => `<li>${s}</li>`).join('')}\n            </ul>\n        `;\n    } else {\n        suggestionsElement.innerHTML = '';\n    }\n\n    console.log('📋 Displaying git diff error:', {\n        originalError: result.error,\n        processedMessage: errorMessage,\n        isUntracked,\n        suggestions: result.suggestions\n    });\n\n    errorArea.style.display = 'block';\n}\n\n// File Viewer Modal Functions\nwindow.showFileViewerModal = function(filePath) {\n    // Use the dashboard's current working directory\n    let workingDir = '';\n    if (window.dashboard && window.dashboard.currentWorkingDir) {\n        workingDir = window.dashboard.currentWorkingDir;\n    }\n\n    // Create modal if it doesn't exist\n    let modal = document.getElementById('file-viewer-modal');\n    if (!modal) {\n        modal = createFileViewerModal();\n        document.body.appendChild(modal);\n    }\n\n    // Update modal content\n    updateFileViewerModal(modal, filePath, workingDir);\n\n    // Show the modal as flex container\n    modal.style.display = 'flex';\n    document.body.style.overflow = 'hidden'; // Prevent background scrolling\n};\n\nwindow.hideFileViewerModal = function() {\n    const modal = document.getElementById('file-viewer-modal');\n    if (modal) {\n        modal.style.display = 'none';\n        document.body.style.overflow = ''; // Restore background scrolling\n    }\n};\n\nwindow.copyFileContent = function() {\n    const modal = document.getElementById('file-viewer-modal');\n    if (!modal) return;\n\n    const codeElement = modal.querySelector('.file-content-code');\n    if (!codeElement) return;\n\n    const text = codeElement.textContent;\n\n    if (navigator.clipboard && navigator.clipboard.writeText) {\n        navigator.clipboard.writeText(text).then(() => {\n            // Show brief feedback\n            const button = modal.querySelector('.file-content-copy');\n            const originalText = button.textContent;\n            button.textContent = '✅ Copied!';\n            setTimeout(() => {\n                button.textContent = originalText;\n            }, 2000);\n        }).catch(err => {\n            console.error('Failed to copy text:', err);\n        });\n    } else {\n        // Fallback for older browsers\n        const textarea = document.createElement('textarea');\n        textarea.value = text;\n        document.body.appendChild(textarea);\n        textarea.select();\n        document.execCommand('copy');\n        document.body.removeChild(textarea);\n\n        const button = modal.querySelector('.file-content-copy');\n        const originalText = button.textContent;\n        button.textContent = '✅ Copied!';\n        setTimeout(() => {\n            button.textContent = originalText;\n        }, 2000);\n    }\n};\n\n\n\n\nfunction displayFileContentError(modal, result) {\n    const errorArea = modal.querySelector('.file-viewer-error');\n    const messageElement = modal.querySelector('.error-message');\n    const suggestionsElement = modal.querySelector('.error-suggestions');\n\n    // Create user-friendly error messages\n    let errorMessage = result.error || 'Unknown error occurred';\n\n    if (errorMessage.includes('not found')) {\n        errorMessage = '📁 File not found or not accessible';\n    } else if (errorMessage.includes('permission')) {\n        errorMessage = '🔒 Permission denied accessing this file';\n    } else if (errorMessage.includes('too large')) {\n        errorMessage = '📏 File is too large to display';\n    } else if (!errorMessage.includes('📁') && !errorMessage.includes('🔒') && !errorMessage.includes('📏')) {\n        errorMessage = `⚠️ ${errorMessage}`;\n    }\n\n    messageElement.textContent = errorMessage;\n\n    // Add suggestions if available\n    if (result.suggestions && result.suggestions.length > 0) {\n        suggestionsElement.innerHTML = `\n            <h4>Suggestions:</h4>\n            <ul>\n                ${result.suggestions.map(suggestion => `<li>${suggestion}</li>`).join('')}\n            </ul>\n        `;\n    } else {\n        suggestionsElement.innerHTML = `\n            <h4>Try:</h4>\n            <ul>\n                <li>Check if the file exists and is readable</li>\n                <li>Verify file permissions</li>\n                <li>Ensure the monitoring server has access to this file</li>\n            </ul>\n        `;\n    }\n\n    console.log('📋 Displaying file content error:', {\n        originalError: result.error,\n        processedMessage: errorMessage,\n        suggestions: result.suggestions\n    });\n\n    errorArea.style.display = 'block';\n}\n\n// Search Viewer Modal Functions\nwindow.showSearchViewerModal = function(searchParams, searchResults) {\n    // Create modal if it doesn't exist\n    let modal = document.getElementById('search-viewer-modal');\n    if (!modal) {\n        modal = createSearchViewerModal();\n        document.body.appendChild(modal);\n    }\n\n    // Update modal content\n    updateSearchViewerModal(modal, searchParams, searchResults);\n\n    // Show the modal as flex container\n    modal.style.display = 'flex';\n    document.body.style.overflow = 'hidden'; // Prevent background scrolling\n};\n\nwindow.hideSearchViewerModal = function() {\n    const modal = document.getElementById('search-viewer-modal');\n    if (modal) {\n        modal.style.display = 'none';\n        document.body.style.overflow = ''; // Restore background scrolling\n    }\n};\n\nfunction createSearchViewerModal() {\n    const modal = document.createElement('div');\n    modal.id = 'search-viewer-modal';\n    modal.className = 'modal search-viewer-modal';\n\n    modal.innerHTML = `\n        <div class=\"modal-content search-viewer-content\">\n            <div class=\"search-viewer-header\">\n                <h2 class=\"search-viewer-title\">\n                    <span class=\"search-viewer-icon\">🔍</span>\n                    <span class=\"search-viewer-title-text\">Search Results</span>\n                </h2>\n                <button class=\"search-viewer-close\" onclick=\"hideSearchViewerModal()\">\n                    <span>&times;</span>\n                </button>\n            </div>\n            <div class=\"search-viewer-body\">\n                <div class=\"search-params-section\">\n                    <h3>Search Parameters</h3>\n                    <pre class=\"search-params-display\"></pre>\n                </div>\n                <div class=\"search-results-section\">\n                    <h3>Search Results</h3>\n                    <div class=\"search-results-display\"></div>\n                </div>\n            </div>\n        </div>\n    `;\n\n    // Close modal when clicking outside\n    modal.addEventListener('click', (e) => {\n        if (e.target === modal) {\n            hideSearchViewerModal();\n        }\n    });\n\n    // Close modal on Escape key\n    document.addEventListener('keydown', (e) => {\n        if (e.key === 'Escape' && modal.style.display === 'flex') {\n            hideSearchViewerModal();\n        }\n    });\n\n    return modal;\n}\n\nfunction updateSearchViewerModal(modal, searchParams, searchResults) {\n    const paramsDisplay = modal.querySelector('.search-params-display');\n    const resultsDisplay = modal.querySelector('.search-results-display');\n\n    // Display search parameters in formatted JSON\n    if (paramsDisplay && searchParams) {\n        paramsDisplay.textContent = JSON.stringify(searchParams, null, 2);\n    }\n\n    // Display search results\n    if (resultsDisplay && searchResults) {\n        let resultsHTML = '';\n        \n        if (typeof searchResults === 'string') {\n            // If results are a string, display as preformatted text\n            resultsHTML = `<pre class=\"search-results-text\">${escapeHtml(searchResults)}</pre>`;\n        } else if (Array.isArray(searchResults)) {\n            // If results are an array, display as a list\n            resultsHTML = '<ul class=\"search-results-list\">';\n            searchResults.forEach(result => {\n                if (typeof result === 'object') {\n                    resultsHTML += `<li><pre>${JSON.stringify(result, null, 2)}</pre></li>`;\n                } else {\n                    resultsHTML += `<li>${escapeHtml(String(result))}</li>`;\n                }\n            });\n            resultsHTML += '</ul>';\n        } else if (typeof searchResults === 'object') {\n            // If results are an object, display as formatted JSON\n            resultsHTML = `<pre class=\"search-results-json\">${JSON.stringify(searchResults, null, 2)}</pre>`;\n        } else {\n            // Fallback: display as text\n            resultsHTML = `<div class=\"search-results-text\">${escapeHtml(String(searchResults))}</div>`;\n        }\n        \n        resultsDisplay.innerHTML = resultsHTML;\n    }\n}\n\nfunction escapeHtml(text) {\n    const div = document.createElement('div');\n    div.textContent = text;\n    return div.innerHTML;\n}\n\n// Global window functions for backward compatibility\nwindow.showAgentInstanceDetails = function(instanceId) {\n    if (window.dashboard && typeof window.dashboard.showAgentInstanceDetails === 'function') {\n        window.dashboard.showAgentInstanceDetails(instanceId);\n    } else {\n        console.error('Dashboard not available or method not found');\n    }\n};\n\n// Initialize dashboard when page loads\ndocument.addEventListener('DOMContentLoaded', function() {\n    window.dashboard = new Dashboard();\n    console.log('Dashboard loaded and initialized');\n});\n\n// ES6 Module export\nexport { Dashboard };\nexport default Dashboard;\n"],"names":["Dashboard","constructor","this","eventViewer","moduleViewer","sessionManager","socketManager","agentInference","uiStateManager","eventProcessor","exportManager","workingDirectoryManager","fileToolTracker","init","console","log","initializeSocketManager","initializeCoreComponents","initializeAgentInference","initializeUIStateManager","initializeWorkingDirectoryManager","initializeFileToolTracker","initializeEventProcessor","initializeExportManager","setupModuleInteractions","initializeFromURL","SocketManager","setupConnectionControls","socketClient","getSocketClient","window","EventViewer","ModuleViewer","SessionManager","AgentInference","initialize","UIStateManager","setupTabFilters","WorkingDirectoryManager","FileToolTracker","EventProcessor","ExportManager","onEventUpdate","events","updateFileOperations","updateToolCalls","processAgentInference","getCurrentTab","scrollListToBottom","renderCurrentTab","onConnectionStatusChange","status","type","updateGitBranch","getCurrentWorkingDir","document","addEventListener","e","updateTabNavigationItems","clear","showCardDetails","detail","tabName","index","agentsSearchInput","getElementById","agentsTypeFilter","toolsSearchInput","toolsTypeFilter","filesSearchInput","filesTypeFilter","params","URLSearchParams","location","search","currentTab","renderAgents","renderTools","renderFiles","getSelectedCard","tab","updateCardSelectionUI","updateUnifiedSelectionUI","agentsList","getFilteredEventsForTab","agentHTML","generateAgentHTML","innerHTML","uniqueInstances","getUniqueAgentInstances","updateAgentsFilterDropdowns","toolsList","toolCalls","getToolCalls","toolCallsArray","Array","from","entries","uniqueToolInstances","getUniqueToolInstances","toolHTML","generateToolHTML","updateToolsFilterDropdowns","filesList","fileOperations","getFileOperations","filesArray","uniqueFileInstances","getUniqueFileInstances","fileHTML","generateFileHTML","updateFilesFilterDropdowns","agentTypes","Set","forEach","instance","agentName","add","sortedTypes","filter","trim","populateFilterDropdown","length","toolNames","map","key","toolCall","tool_name","name","operations","flatMap","path","data","op","operation","selectId","values","allOption","select","currentValue","value","sortedValues","sort","a","b","localeCompare","option","createElement","textContent","appendChild","includes","showEventDetails","showAgentDetailsByIndex","showToolDetailsByIndex","showFileDetailsByIndex","isArray","warn","filteredSingleEvent","applyAgentsFilters","showAgentEvent","event","showAgentInstanceDetails","instanceId","getPMDelegations","get","impliedInstance","find","inst","id","showImpliedAgentDetails","error","showAgentInstance","eventCount","agentEvents","startTime","timestamp","pmCall","showImpliedAgent","note","filteredToolCalls","applyToolCallFilters","toolCallKey","showToolCallDetails","applyFilesFilters","filePath","showFileDetails","getToolCall","showToolCall","fileData","getFileOperationsForFile","showFileOperations","switchTab","selectCard","clearEvents","exportEvents","clearSelection","currentWorkingDir","dir","setWorkingDirectory","selectedCard","tabNavigation","createFileViewerModal","modal","className","target","hideFileViewerModal","style","display","async","updateFileViewerModal","workingDir","filePathElement","querySelector","fileSizeElement","socket","dashboard","Error","responsePromise","Promise","resolve","reject","responseHandler","file_path","off","success","on","setTimeout","emit","working_dir","result","contentArea","extensionElement","encodingElement","codeElement","extension","encoding","bytes","k","sizes","i","Math","floor","parseFloat","pow","toFixed","formatFileSize","file_size","content","code","escaped","replace","addLineNumbers","highlightJavaScript","highlightPython","highlightJSON","highlightCSS","highlightHTML","highlightMarkdown","highlightCode","wrapper","modalContent","header","toolbar","modalHeight","offsetHeight","headerHeight","toolbarHeight","availableHeight","maxHeight","overflowY","displayFileContent","errorMessage","message","suggestions","errorArea","messageElement","suggestionsElement","s","join","originalError","processedMessage","displayFileError","split","line","String","padStart","displayGitDiffError","isUntracked","suggestionTitle","escapeHtml","text","div","showFileViewerModal","body","overflow","copyFileContent","navigator","clipboard","writeText","then","button","originalText","catch","err","textarea","execCommand","removeChild","showGitDiffModal","hideGitDiffModal","createGitDiffModal","timestampElement","Date","toLocaleString","port","portInput","file","append","requestUrl","urlParams","toString","healthResponse","fetch","method","headers","Accept","mode","ok","statusText","healthError","response","json","commitHashElement","methodElement","commit_hash","diff","startsWith","displayGitDiff","stack","debug_info","error_type","original_message","toISOString","updateGitDiffModal","copyGitDiff","showSearchViewerModal","searchParams","searchResults","hideSearchViewerModal","createSearchViewerModal","paramsDisplay","resultsDisplay","JSON","stringify","resultsHTML","updateSearchViewerModal"],"mappings":"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"}